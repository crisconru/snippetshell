
<!DOCTYPE html>

<html class="no-js" lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Apuntes de fácil acceso para distintas tecnologías." name="description"/>
<meta content="Cristóbal Contreras Rubio" name="author"/>
<link href="https://crisconru.github.io/sw/web/backend/django/avanzado/" rel="canonical"/>
<link href="../../../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-8.5.10" name="generator"/>
<title>Avanzado - Tips de Cristo</title>
<link href="../../../../../assets/stylesheets/main.472b142f.min.css" rel="stylesheet"/>
<link href="../../../../../assets/stylesheets/palette.08040f6c.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../../../../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="pink" data-md-color-primary="green" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#django-avanzado">
          Saltar a contenido
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--lifted" data-md-component="header">
<nav aria-label="Cabecera" class="md-header__inner md-grid">
<a aria-label="Tips de Cristo" class="md-header__button md-logo" data-md-component="logo" href="../../../../.." title="Tips de Cristo">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Tips de Cristo
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Avanzado
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Modo Oscuro" class="md-option" data-md-color-accent="pink" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="green" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Modo Oscuro">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg>
</label>
<input aria-label="Modo Claro" class="md-option" data-md-color-accent="pink" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="green" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Modo Claro">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Búsqueda" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Búsqueda" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"></path></svg>
</a>
<button aria-label="Limpiar" class="md-search__icon md-icon" tabindex="-1" title="Limpiar" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/crisconru/tips" title="Ir al repositorio">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</div>
<div class="md-source__repository">
    crisconru/tips
  </div>
</a>
</div>
</nav>
<nav aria-label="Pestañas" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../..">
      Índice
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="../../../../coding/python/python/">
        Software
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../hw/serie/">
        Hardware
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../iot/iot/">
        IoT
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../devops/git/git/">
        DevOps
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../linux/terminal/zsh/">
        Linux
      </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navegación" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Tips de Cristo" class="md-nav__button md-logo" data-md-component="logo" href="../../../../.." title="Tips de Cristo">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    Tips de Cristo
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/crisconru/tips" title="Ir al repositorio">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</div>
<div class="md-source__repository">
    crisconru/tips
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../..">
        Índice
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
          Software
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Software" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Software
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2_1" id="__nav_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1">
          Lenguajes
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Lenguajes" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_1">
<span class="md-nav__icon md-icon"></span>
          Lenguajes
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2_1_1" id="__nav_2_1_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1_1">
          Python
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Python" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_1_1">
<span class="md-nav__icon md-icon"></span>
          Python
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../coding/python/python/">
        Setup
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../coding/python/entornos_virtuales/">
        Entornos virtuales
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2_1_2" id="__nav_2_1_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1_2">
          JavaScript
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="JavaScript" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_1_2">
<span class="md-nav__icon md-icon"></span>
          JavaScript
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../coding/javascript/javascript/">
        VanillaJS
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2_1_2_2" id="__nav_2_1_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1_2_2">
          NodeJS
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="NodeJS" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_2_1_2_2">
<span class="md-nav__icon md-icon"></span>
          NodeJS
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../coding/javascript/nodejs/typescript/">
        TypeScript
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../coding/javascript/nodejs/tcp/">
        TCP
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2_2" id="__nav_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_2">
          IDEs
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="IDEs" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
          IDEs
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../coding/ides/vscode/vscode/">
        Visual Studio code
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" id="__nav_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3">
          Web
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Web" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
          Web
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2_3_1" id="__nav_2_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3_1">
          Frontend
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Frontend" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_3_1">
<span class="md-nav__icon md-icon"></span>
          Frontend
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../frontend/frontend/">
        Índice
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../frontend/html/html/">
        HTML
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../frontend/css/css/">
        CSS
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../frontend/js/javascript/">
        VanillaJS
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3_2" id="__nav_2_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3_2">
          Backend
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Backend" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_3_2">
<span class="md-nav__icon md-icon"></span>
          Backend
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3_2_1" id="__nav_2_3_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3_2_1">
          Django
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Django" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_2_3_2_1">
<span class="md-nav__icon md-icon"></span>
          Django
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../principiante/">
        Principiante
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../intermedio/">
        Intermedio
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Avanzado
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Avanzado
      </a>
<nav aria-label="Tabla de contenidos" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#incluir-una-plantilla-html-en-todas-las-plantillas-de-la-app">
    Incluir una plantilla html en todas las plantillas de la app
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#definir-estructuras-en-los-urlspattern">
    Definir estructuras en los urlspattern
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#vistas-basadas-en-clases">
    Vistas Basadas en Clases
  </a>
<nav aria-label="Vistas Basadas en Clases" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#listview">
    ListView
  </a>
<nav aria-label="ListView" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#paginacion">
    Paginación
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#detailview">
    DetailView
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#vistas-crud">
    Vistas CRUD
  </a>
<nav aria-label="Vistas CRUD" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#createview-vista-crud">
    CreateView - Vista CRUD
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#updateview-vista-crud">
    UpdateView - Vista CRUD
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deleteview-vista-crud">
    DeleteView - Vista CRUD
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#formularios-para-modelos">
    Formularios para Modelos
  </a>
<nav aria-label="Formularios para Modelos" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ckeditor-adaptativo">
    ckeditor adaptativo
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#usuarios-registrados">
    Usuarios registrados
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#usuarios-registrados-mixins-manual">
    Usuarios registrados - Mixins Manual
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#usuarios-registrados-mixins-decorado">
    Usuarios registrados - Mixins Decorado
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#auth-views">
    Auth Views
  </a>
<nav aria-label="Auth Views" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#loginview">
    LoginView
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#logoutview">
    LogoutView
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#registro-de-usuario">
    Registro de Usuario
  </a>
<nav aria-label="Registro de Usuario" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#customizar-el-registro">
    Customizar el registro
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#anadir-email-como-requisito">
    Añadir email como requisito
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recuperar-contrasena">
    Recuperar contraseña
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#perfil-de-usuario">
    Perfil de Usuario
  </a>
<nav aria-label="Perfil de Usuario" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#crear-perfil">
    Crear perfil
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#perfil-editable">
    Perfil editable
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#customizando-formulario-de-perfil">
    Customizando formulario de Perfil
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#email-editable">
    Email editable
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#contrasena-editable">
    Contraseña Editable
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#optimizar-guardado-de-avatar">
    Optimizar guardado de avatar
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#senales">
    Señales
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tdd">
    TDD
  </a>
<nav aria-label="TDD" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#tests-simples">
    Tests Simples
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ejemplo-de-test-con-senales">
    Ejemplo de Test con señales
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#model-manager">
    Model Manager
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#js-peticiones-asincronas">
    JS - Peticiones asíncronas
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deploy">
    Deploy
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#customizar-el-admin">
    Customizar el Admin
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
          Hardware
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Hardware" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Hardware
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../hw/serie/">
        Protocolos Serie
      </a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_3_2" id="__nav_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_2">
          Arduino
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Arduino" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_2">
<span class="md-nav__icon md-icon"></span>
          Arduino
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../hw/arduino/arduino/">
        Sobre Arduino
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../hw/arduino/stream/">
        Stream
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../hw/arduino/uart/">
        UART
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../hw/arduino/bluetooth/">
        Bluetooth
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../hw/platformio/platformio/">
        Platformio
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../hw/micropython/micropython/">
        Micropython
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4">
          IoT
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="IoT" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          IoT
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../iot/iot/">
        Que es el IoT
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../iot/mqtt/mqtt/">
        MQTT
      </a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_4_3" id="__nav_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3">
          Node-Red
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Node-Red" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
          Node-Red
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../iot/nodered/nodered/">
        Que es Node-Red
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../iot/nodered/custom-components/custom-components/">
        Crear Componentes
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5">
          DevOps
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="DevOps" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          DevOps
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_5_1" id="__nav_5_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1">
          Git
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Git" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_1">
<span class="md-nav__icon md-icon"></span>
          Git
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../devops/git/git/">
        Comandos
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../devops/git/gitflow/gitflow/">
        Git Flow
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_5_2" id="__nav_5_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_2">
          Docker
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Docker" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
          Docker
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../devops/docker/docker-aclaraciones/">
        Aclaraciones
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../devops/docker/docker-instalacion/">
        Instalación
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../devops/docker/docker-hub/">
        Docker Hub
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../devops/docker/docker-comandos/">
        Comandos docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../devops/docker/docker-contenedores/">
        Lanzar contenedores
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../devops/docker/docker-imagenes/">
        Crear imágenes
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../devops/docker/docker-dockerfile/">
        Dockerfile
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../devops/docker/docker-volumes/">
        Volumes
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../devops/docker/docker-network/">
        Network
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../devops/docker/docker-dockercompose/">
        Docker Compose
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../devops/ansible/ansible/">
        Ansible
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6">
          Linux
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Linux" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          Linux
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_6_1" id="__nav_6_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_1">
          Terminal
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Terminal" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_1">
<span class="md-nav__icon md-icon"></span>
          Terminal
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../linux/terminal/zsh/">
        ZSH
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_6_1_2" id="__nav_6_1_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_1_2">
          TMUX
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="TMUX" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_6_1_2">
<span class="md-nav__icon md-icon"></span>
          TMUX
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../linux/terminal/tmux/tmux-comandos/">
        Comandos
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../linux/terminal/tmux/tmux-customizar/">
        Customización
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../linux/terminal/terminal-bash/">
        Bash Scripting
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../linux/bluetooth/">
        Bluetooth
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_6_2" id="__nav_6_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_2">
          Comandos
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Comandos" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_2">
<span class="md-nav__icon md-icon"></span>
          Comandos
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../linux/comandos/linux-fecha-hora/">
        Fecha y Hora
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../linux/comandos/linux-ficheros/">
        Ficheros
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_6_3" id="__nav_6_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_3">
          Redes
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Redes" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_3">
<span class="md-nav__icon md-icon"></span>
          Redes
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../linux/redes/redes-linux/">
        Linux
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../linux/redes/redes-ssh/">
        SSH
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../linux/redes/redes-iptables/">
        iptables
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../linux/redes/redes-ipv6/">
        IPv6
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Tabla de contenidos" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#incluir-una-plantilla-html-en-todas-las-plantillas-de-la-app">
    Incluir una plantilla html en todas las plantillas de la app
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#definir-estructuras-en-los-urlspattern">
    Definir estructuras en los urlspattern
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#vistas-basadas-en-clases">
    Vistas Basadas en Clases
  </a>
<nav aria-label="Vistas Basadas en Clases" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#listview">
    ListView
  </a>
<nav aria-label="ListView" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#paginacion">
    Paginación
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#detailview">
    DetailView
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#vistas-crud">
    Vistas CRUD
  </a>
<nav aria-label="Vistas CRUD" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#createview-vista-crud">
    CreateView - Vista CRUD
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#updateview-vista-crud">
    UpdateView - Vista CRUD
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deleteview-vista-crud">
    DeleteView - Vista CRUD
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#formularios-para-modelos">
    Formularios para Modelos
  </a>
<nav aria-label="Formularios para Modelos" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ckeditor-adaptativo">
    ckeditor adaptativo
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#usuarios-registrados">
    Usuarios registrados
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#usuarios-registrados-mixins-manual">
    Usuarios registrados - Mixins Manual
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#usuarios-registrados-mixins-decorado">
    Usuarios registrados - Mixins Decorado
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#auth-views">
    Auth Views
  </a>
<nav aria-label="Auth Views" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#loginview">
    LoginView
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#logoutview">
    LogoutView
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#registro-de-usuario">
    Registro de Usuario
  </a>
<nav aria-label="Registro de Usuario" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#customizar-el-registro">
    Customizar el registro
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#anadir-email-como-requisito">
    Añadir email como requisito
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recuperar-contrasena">
    Recuperar contraseña
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#perfil-de-usuario">
    Perfil de Usuario
  </a>
<nav aria-label="Perfil de Usuario" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#crear-perfil">
    Crear perfil
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#perfil-editable">
    Perfil editable
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#customizando-formulario-de-perfil">
    Customizando formulario de Perfil
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#email-editable">
    Email editable
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#contrasena-editable">
    Contraseña Editable
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#optimizar-guardado-de-avatar">
    Optimizar guardado de avatar
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#senales">
    Señales
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tdd">
    TDD
  </a>
<nav aria-label="TDD" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#tests-simples">
    Tests Simples
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ejemplo-de-test-con-senales">
    Ejemplo de Test con señales
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#model-manager">
    Model Manager
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#js-peticiones-asincronas">
    JS - Peticiones asíncronas
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deploy">
    Deploy
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#customizar-el-admin">
    Customizar el Admin
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="django-avanzado">Django Avanzado<a class="headerlink" href="#django-avanzado" title="Permanent link">¶</a></h1>
<h2 id="incluir-una-plantilla-html-en-todas-las-plantillas-de-la-app">Incluir una plantilla html en todas las plantillas de la app<a class="headerlink" href="#incluir-una-plantilla-html-en-todas-las-plantillas-de-la-app" title="Permanent link">¶</a></h2>
<p>Si quieres que en todas las plantillas de la app aparezca cierto código html común, debes de:</p>
<ol>
<li>Crear el directorio <code>&lt;proyecto&gt;/&lt;app&gt;/templates/includes</code>.</li>
<li>Dentro de <code>includes</code> crear tu plantilla html común para los demás.</li>
<li>En cada plantilla html de tu app, en el dentro de tu <code>{% block content %}</code>, añadirla con <code>{% include '&lt;app&gt;/includes/&lt;template&gt;.html' %}</code></li>
</ol>
<h2 id="definir-estructuras-en-los-urlspattern">Definir estructuras en los urlspattern<a class="headerlink" href="#definir-estructuras-en-los-urlspattern" title="Permanent link">¶</a></h2>
<p>Suponte que tienes varias apps, donde hay una vista que se llama igual, por ejemplo <code>create</code>. En el <code>urls.py</code> le tienes puesto <code>name=&lt;app&gt;_create</code> para que no coincidan. Para no tener que hacer eso, se puede usar una reestructura de los urlpatterns.</p>
<p><code>&lt;app&gt;/urls.py</code> -&gt; Le pones el nombre que quieras al <code>urlpatterns</code>, pero ahora en vez de ser una lista como antes, va a ser una tupla, que tiene en su primer miembro el <code>urlpatterns</code>, y en el segundo un nombre de referencia. Ahora puedes asignar nombres genéricos en el <code>urlpatterns</code>, como es el caso de <code>create</code> que lo vas a usar en más <code>urls.py</code> de otras apps.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">PageListView</span><span class="p">,</span> <span class="n">PageDetailView</span><span class="p">,</span> <span class="n">PageCreate</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">pages_patterns</span> <span class="o">=</span> <span class="p">([</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><a href="#__codelineno-0-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">PageListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'pages'</span><span class="p">),</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><a href="#__codelineno-0-6"><span class="linenos" data-linenos="6 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'&lt;int:pk&gt;/&lt;slug:slug&gt;/'</span><span class="p">,</span> <span class="n">PageDetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'page'</span><span class="p">),</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><a href="#__codelineno-0-7"><span class="linenos" data-linenos="7 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'create/'</span><span class="p">,</span> <span class="n">PageCreate</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'create'</span><span class="p">),</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><a href="#__codelineno-0-8"><span class="linenos" data-linenos="8 "></span></a><span class="p">],</span> <span class="s1">'pages'</span><span class="p">)</span>
</code></pre></div>
<p><code>&lt;proyecto&gt;/&lt;proyecto&gt;/urls.py</code> -&gt; Importa tu <code>urlpatterns</code> tuneado (en este caso <code>pages_urlpatterns</code>), y lo incluyes directamente en la función <code>include()</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><a href="#__codelineno-1-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><a href="#__codelineno-1-3"><span class="linenos" data-linenos="3 "></span></a><span class="kn">from</span> <span class="nn">pages.urls</span> <span class="kn">import</span> <span class="n">pages_patterns</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><a href="#__codelineno-1-4"><span class="linenos" data-linenos="4 "></span></a>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><a href="#__codelineno-1-5"><span class="linenos" data-linenos="5 "></span></a><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><a href="#__codelineno-1-6"><span class="linenos" data-linenos="6 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">'core.urls'</span><span class="p">)),</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><a href="#__codelineno-1-7"><span class="linenos" data-linenos="7 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'pages/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">pages_patterns</span><span class="p">)),</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><a href="#__codelineno-1-8"><span class="linenos" data-linenos="8 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><a href="#__codelineno-1-9"><span class="linenos" data-linenos="9 "></span></a><span class="p">]</span>
</code></pre></div>
<p><code>&lt;..&gt;/template/&lt;..&gt;</code> -&gt; Lo único que te falta es que ahora, en todas las templates que lo enlazas con <code>{% urls '&lt;vista&gt;' ... %}</code> debes de poner <code>{% urls '&lt;urls de donde vengo&gt;:&lt;vista&gt;' ... %}</code>. En este ejemplo sería:</p>
<ol>
<li><code>{% urls 'pages:pages' ... %}</code> Cuando es un template fuera de la app, que enlaza desde el <code>urls.py</code> del proyecto a la app.</li>
<li><code>{% urls 'pages:create' ... %}</code> Cuando es un template dentro de la app, que enlaza desde el <code>urls.py</code> de la propia app.</li>
</ol>
<h2 id="vistas-basadas-en-clases">Vistas Basadas en Clases<a class="headerlink" href="#vistas-basadas-en-clases" title="Permanent link">¶</a></h2>
<p>En el <code>views.py</code> importo el modelo que quiera, por ejemplo <code>TemplateView</code>. Hago que hereden de mi modelo, defino su template, y modifico el contexto con la función <code>get_context_data()</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.base</span> <span class="kn">import</span> <span class="n">TemplateView</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">class</span> <span class="nc">HomePageView</span><span class="p">(</span><span class="n">TemplateView</span><span class="p">):</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><a href="#__codelineno-2-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'core/home.html'</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><a href="#__codelineno-2-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><a href="#__codelineno-2-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><a href="#__codelineno-2-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><a href="#__codelineno-2-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="n">context</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'Mi chachi web'</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><a href="#__codelineno-2-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="k">return</span> <span class="n">context</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><a href="#__codelineno-2-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><a href="#__codelineno-2-11"><span class="linenos" data-linenos="11 "></span></a><span class="k">class</span> <span class="nc">SamplePageView</span><span class="p">(</span><span class="n">TemplateView</span><span class="p">):</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><a href="#__codelineno-2-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'core/sample.html'</span>
</code></pre></div>
<p>En el <code>urls.py</code> importo las vistas y las llamo con la función <code>as_view()</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><a href="#__codelineno-3-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><a href="#__codelineno-3-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">HomePageView</span><span class="p">,</span> <span class="n">SamplePageView</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><a href="#__codelineno-3-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><a href="#__codelineno-3-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><a href="#__codelineno-3-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">HomePageView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"home"</span><span class="p">),</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><a href="#__codelineno-3-6"><span class="linenos" data-linenos="6 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'sample/'</span><span class="p">,</span> <span class="n">SamplePageView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"sample"</span><span class="p">),</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><a href="#__codelineno-3-7"><span class="linenos" data-linenos="7 "></span></a><span class="p">]</span>
</code></pre></div>
<p>Si la modificación en el contexto es poca, podría hacer en el <code>views.py</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><a href="#__codelineno-4-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.base</span> <span class="kn">import</span> <span class="n">TemplateView</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><a href="#__codelineno-4-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><a href="#__codelineno-4-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><a href="#__codelineno-4-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">class</span> <span class="nc">HomePageView</span><span class="p">(</span><span class="n">TemplateView</span><span class="p">):</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><a href="#__codelineno-4-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'core/home.html'</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><a href="#__codelineno-4-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><a href="#__codelineno-4-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><a href="#__codelineno-4-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><a href="#__codelineno-4-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'title'</span><span class="p">:</span> <span class="s1">'Mi chachi web'</span><span class="p">}</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><a href="#__codelineno-4-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_name</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></div>
<h3 id="listview">ListView<a class="headerlink" href="#listview" title="Permanent link">¶</a></h3>
<p>Cuando tenemos un modelo, y queremos ver listados varios objetos, una buena opción es usar una <code>ListView</code>. Si solo quisieramos ver uno en detalle, deberías de optar por <code>DetailView</code>.</p>
<p><code>views.py</code> -&gt; Tendremos que importar <code>ListView</code>, dentro de la clase definirle que modelo de la bbdd vamos a usar.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><a href="#__codelineno-5-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.list</span> <span class="kn">import</span> <span class="n">ListView</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><a href="#__codelineno-5-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Page</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><a href="#__codelineno-5-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><a href="#__codelineno-5-4"><span class="linenos" data-linenos="4 "></span></a>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><a href="#__codelineno-5-5"><span class="linenos" data-linenos="5 "></span></a><span class="c1"># Create your views here.</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><a href="#__codelineno-5-6"><span class="linenos" data-linenos="6 "></span></a><span class="k">class</span> <span class="nc">PageListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><a href="#__codelineno-5-7"><span class="linenos" data-linenos="7 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
</code></pre></div>
<p><code>urls.py</code> -&gt; Modificar las urls</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><a href="#__codelineno-6-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><a href="#__codelineno-6-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">PageListView</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><a href="#__codelineno-6-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><a href="#__codelineno-6-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><a href="#__codelineno-6-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">PageListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'pages'</span><span class="p">),</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><a href="#__codelineno-6-6"><span class="linenos" data-linenos="6 "></span></a><span class="p">]</span>
</code></pre></div>
<p><code>templates/&lt;app&gt;/&lt;modelo&gt;_list.html</code> -&gt; Veremos que si arrancamos el server da un error, y es porque esta vista usa un template llamado <code>&lt;modelo&gt;_list.html</code>. Así que en nuestra carpeta de templates, deberemos de llamar así a su template html. Además, donde tengamos el <code>for</code> para mostrar todos los elementos, debemos de usar el objeto <code>object</code> o el nombre del modelo (en este caso <code>page</code>)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><a href="#__codelineno-7-1"><span class="linenos" data-linenos="1 "></span></a># Este sería el genérico
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><a href="#__codelineno-7-2"><span class="linenos" data-linenos="2 "></span></a>{% for page in object_list %}
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><a href="#__codelineno-7-3"><span class="linenos" data-linenos="3 "></span></a># Este sería más específico, pero para el caso es igual
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><a href="#__codelineno-7-4"><span class="linenos" data-linenos="4 "></span></a>{% for page in page_list %}
</code></pre></div>
<h4 id="paginacion">Paginación<a class="headerlink" href="#paginacion" title="Permanent link">¶</a></h4>
<p>En las <code>ListView</code> puedes mostrar solo cierto número de objetos en lugar de todo a la vez, y poner un índice típico de</p>
<p>&lt;- Anterior <strong>1</strong>, 2, ... Siguiente -&gt;</p>
<p><code>&lt;app&gt;/views.py</code> -&gt; Donde tengas la <code>ListView</code> tienes que añadirle el campo <code>paginated_by</code> y ponerle un número. Por ejemplo, <code>paginated_by = 3</code> son 3 elementos por página.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><a href="#__codelineno-8-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.list</span> <span class="kn">import</span> <span class="n">ListView</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><a href="#__codelineno-8-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">from</span> <span class="nn">registration.models</span> <span class="kn">import</span> <span class="n">Profile</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><a href="#__codelineno-8-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><a href="#__codelineno-8-4"><span class="linenos" data-linenos="4 "></span></a>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><a href="#__codelineno-8-5"><span class="linenos" data-linenos="5 "></span></a><span class="c1"># Create your views here.</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><a href="#__codelineno-8-6"><span class="linenos" data-linenos="6 "></span></a><span class="k">class</span> <span class="nc">ProfileListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><a href="#__codelineno-8-7"><span class="linenos" data-linenos="7 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Profile</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><a href="#__codelineno-8-8"><span class="linenos" data-linenos="8 "></span></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'profiles/profile_list.html'</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><a href="#__codelineno-8-9"><span class="linenos" data-linenos="9 "></span></a>    <span class="n">paginate_by</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre></div>
<p><code>&lt;app&gt;/templates/&lt;app&gt;/&lt;template_name&gt;</code> -&gt; En el template tienes que hacerle el menú para navegar entre páginas. En el ejemplo se adjunta uno hecho con bootstrap.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><a href="#__codelineno-9-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="cm">&lt;!-- Menú de paginación --&gt;</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><a href="#__codelineno-9-2"><span class="linenos" data-linenos=" 2 "></span></a>{% if is_paginated %}
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><a href="#__codelineno-9-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="p">&lt;</span><span class="nt">nav</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">"Page navigation"</span><span class="p">&gt;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><a href="#__codelineno-9-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">"pagination justify-content-center"</span><span class="p">&gt;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><a href="#__codelineno-9-5"><span class="linenos" data-linenos=" 5 "></span></a>        {% if page_obj.has_previous %}
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><a href="#__codelineno-9-6"><span class="linenos" data-linenos=" 6 "></span></a>        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">"page-item "</span><span class="p">&gt;</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><a href="#__codelineno-9-7"><span class="linenos" data-linenos=" 7 "></span></a>            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">"page-link"</span> <span class="na">href</span><span class="o">=</span><span class="s">"?page={{ page_obj.previous_page_number }}"</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><a href="#__codelineno-9-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a><a href="#__codelineno-9-9"><span class="linenos" data-linenos=" 9 "></span></a>        {% else %}
<a id="__codelineno-9-10" name="__codelineno-9-10"></a><a href="#__codelineno-9-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">"page-item disabled"</span><span class="p">&gt;</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a><a href="#__codelineno-9-11"><span class="linenos" data-linenos="11 "></span></a>            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">"page-link"</span> <span class="na">href</span><span class="o">=</span><span class="s">"#"</span> <span class="na">tabindex</span><span class="o">=</span><span class="s">"-1"</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a><a href="#__codelineno-9-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a><a href="#__codelineno-9-13"><span class="linenos" data-linenos="13 "></span></a>        {% endif %}
<a id="__codelineno-9-14" name="__codelineno-9-14"></a><a href="#__codelineno-9-14"><span class="linenos" data-linenos="14 "></span></a>        {% for i in paginator.page_range %}
<a id="__codelineno-9-15" name="__codelineno-9-15"></a><a href="#__codelineno-9-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">"page-item {% if page_obj.number == i %}active{% endif %}"</span><span class="p">&gt;</span>
<a id="__codelineno-9-16" name="__codelineno-9-16"></a><a href="#__codelineno-9-16"><span class="linenos" data-linenos="16 "></span></a>            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">"page-link"</span> <span class="na">href</span><span class="o">=</span><span class="s">"?page={{ i }}"</span><span class="p">&gt;</span>{{ i }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a id="__codelineno-9-17" name="__codelineno-9-17"></a><a href="#__codelineno-9-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-9-18" name="__codelineno-9-18"></a><a href="#__codelineno-9-18"><span class="linenos" data-linenos="18 "></span></a>        {% endfor %}
<a id="__codelineno-9-19" name="__codelineno-9-19"></a><a href="#__codelineno-9-19"><span class="linenos" data-linenos="19 "></span></a>        {% if page_obj.has_next %}
<a id="__codelineno-9-20" name="__codelineno-9-20"></a><a href="#__codelineno-9-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">"page-item "</span><span class="p">&gt;</span>
<a id="__codelineno-9-21" name="__codelineno-9-21"></a><a href="#__codelineno-9-21"><span class="linenos" data-linenos="21 "></span></a>            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">"page-link"</span> <span class="na">href</span><span class="o">=</span><span class="s">"?page={{ page_obj.next_page_number }}"</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a id="__codelineno-9-22" name="__codelineno-9-22"></a><a href="#__codelineno-9-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-9-23" name="__codelineno-9-23"></a><a href="#__codelineno-9-23"><span class="linenos" data-linenos="23 "></span></a>        {% else %}
<a id="__codelineno-9-24" name="__codelineno-9-24"></a><a href="#__codelineno-9-24"><span class="linenos" data-linenos="24 "></span></a>        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">"page-item disabled"</span><span class="p">&gt;</span>
<a id="__codelineno-9-25" name="__codelineno-9-25"></a><a href="#__codelineno-9-25"><span class="linenos" data-linenos="25 "></span></a>            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">"page-link"</span> <span class="na">href</span><span class="o">=</span><span class="s">"#"</span> <span class="na">tabindex</span><span class="o">=</span><span class="s">"-1"</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a id="__codelineno-9-26" name="__codelineno-9-26"></a><a href="#__codelineno-9-26"><span class="linenos" data-linenos="26 "></span></a>        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-9-27" name="__codelineno-9-27"></a><a href="#__codelineno-9-27"><span class="linenos" data-linenos="27 "></span></a>        {% endif %}
<a id="__codelineno-9-28" name="__codelineno-9-28"></a><a href="#__codelineno-9-28"><span class="linenos" data-linenos="28 "></span></a>    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<a id="__codelineno-9-29" name="__codelineno-9-29"></a><a href="#__codelineno-9-29"><span class="linenos" data-linenos="29 "></span></a><span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
<a id="__codelineno-9-30" name="__codelineno-9-30"></a><a href="#__codelineno-9-30"><span class="linenos" data-linenos="30 "></span></a>{% endif %}
</code></pre></div>
<p>En este ejemplo te saldrá un warning diciendo que no están ordenados. Para que no salga, te vas al <code>models.py</code> de la app donde usas ese modelo de la <code>ListView</code>, le creas una clase <code>Meta</code> y le pones el atributo <code>ordering</code> indicandole en una lista porque que campos los ordenas.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><a href="#__codelineno-10-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">class</span> <span class="nc">Profile</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><a href="#__codelineno-10-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><a href="#__codelineno-10-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="n">avatar</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="n">custom_upload_to</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><a href="#__codelineno-10-4"><span class="linenos" data-linenos="4 "></span></a>                               <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><a href="#__codelineno-10-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="n">bio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><a href="#__codelineno-10-6"><span class="linenos" data-linenos="6 "></span></a>    <span class="n">link</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><a href="#__codelineno-10-7"><span class="linenos" data-linenos="7 "></span></a>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><a href="#__codelineno-10-8"><span class="linenos" data-linenos="8 "></span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><a href="#__codelineno-10-9"><span class="linenos" data-linenos="9 "></span></a>        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'user__username'</span><span class="p">]</span>
</code></pre></div>
<h3 id="detailview">DetailView<a class="headerlink" href="#detailview" title="Permanent link">¶</a></h3>
<p>Para ver en detalle un único elemento de la bbdd, se suele usar <code>DetailView</code></p>
<p><code>views.py</code> -&gt; Importar <code>DetailView</code>, así como el objeto del modelo de la bbdd y definirlo dentro de la clase.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><a href="#__codelineno-11-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.list</span> <span class="kn">import</span> <span class="n">ListView</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><a href="#__codelineno-11-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.detail</span> <span class="kn">import</span> <span class="n">DetailView</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><a href="#__codelineno-11-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Page</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><a href="#__codelineno-11-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><a href="#__codelineno-11-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><a href="#__codelineno-11-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="c1"># Create your views here.</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><a href="#__codelineno-11-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">class</span> <span class="nc">PageListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><a href="#__codelineno-11-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><a href="#__codelineno-11-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><a href="#__codelineno-11-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><a href="#__codelineno-11-11"><span class="linenos" data-linenos="11 "></span></a><span class="k">class</span> <span class="nc">PageDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><a href="#__codelineno-11-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
</code></pre></div>
<p><code>urls.py</code> -&gt; Ojo en el pattern, que usa <code>pk</code> como índice.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><a href="#__codelineno-12-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><a href="#__codelineno-12-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">PageListView</span><span class="p">,</span> <span class="n">PageDetailView</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><a href="#__codelineno-12-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><a href="#__codelineno-12-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><a href="#__codelineno-12-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">PageListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'pages'</span><span class="p">),</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><a href="#__codelineno-12-6"><span class="linenos" data-linenos="6 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'&lt;int:pk&gt;/&lt;slug:slug&gt;/'</span><span class="p">,</span> <span class="n">PageDetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'page'</span><span class="p">),</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><a href="#__codelineno-12-7"><span class="linenos" data-linenos="7 "></span></a><span class="p">]</span>
</code></pre></div>
<p><code>template/&lt;app&gt;/&lt;modelo&gt;_detail.html</code> -&gt; <code>DetailView</code> usa un template html llamado <code>&lt;modelo&gt;_detail.html</code>, así que debemos nombrar así al nuestro para que lo lea. De nuevo, tenemos que usar <code>object</code> dentro del template o el nombre del modelo (<code>page</code> en este caso).</p>
<h2 id="vistas-crud">Vistas CRUD<a class="headerlink" href="#vistas-crud" title="Permanent link">¶</a></h2>
<p>Son un tipo de vistas basadas en clases, que están pensadas para interactuar con la bbdd.</p>
<p>Create Read Update Delete</p>
<h3 id="createview-vista-crud">CreateView - Vista CRUD<a class="headerlink" href="#createview-vista-crud" title="Permanent link">¶</a></h3>
<p>Sirve para poder crear una página donde un admin pueda editar / crear un objeto de la bbdd.</p>
<p><code>views.py</code> -&gt; Importa <code>CreateView</code>, añade el modelo de la bbdd así como los campos a editar. El campo <code>sucess_url</code> es la vista que se pondrá cuando hayas completado el formulario</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><a href="#__codelineno-13-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">get_list_or_404</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><a href="#__codelineno-13-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.list</span> <span class="kn">import</span> <span class="n">ListView</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><a href="#__codelineno-13-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.detail</span> <span class="kn">import</span> <span class="n">DetailView</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><a href="#__codelineno-13-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.edit</span> <span class="kn">import</span> <span class="n">CreateView</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><a href="#__codelineno-13-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse_lazy</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><a href="#__codelineno-13-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Page</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><a href="#__codelineno-13-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><a href="#__codelineno-13-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><a href="#__codelineno-13-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="c1"># Create your views here.</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a><a href="#__codelineno-13-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">class</span> <span class="nc">PageListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a><a href="#__codelineno-13-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a><a href="#__codelineno-13-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a><a href="#__codelineno-13-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a><a href="#__codelineno-13-14"><span class="linenos" data-linenos="14 "></span></a><span class="k">class</span> <span class="nc">PageDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a><a href="#__codelineno-13-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a><a href="#__codelineno-13-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a><a href="#__codelineno-13-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a><a href="#__codelineno-13-18"><span class="linenos" data-linenos="18 "></span></a><span class="k">class</span> <span class="nc">PageCreate</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a><a href="#__codelineno-13-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-13-20" name="__codelineno-13-20"></a><a href="#__codelineno-13-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'content'</span><span class="p">,</span> <span class="s1">'order'</span><span class="p">]</span>
<a id="__codelineno-13-21" name="__codelineno-13-21"></a><a href="#__codelineno-13-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:pages'</span><span class="p">)</span>
</code></pre></div>
<p><code>urls.py</code> -&gt; Importa la vista.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><a href="#__codelineno-14-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><a href="#__codelineno-14-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">PageListView</span><span class="p">,</span> <span class="n">PageDetailView</span><span class="p">,</span> <span class="n">PageCreate</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><a href="#__codelineno-14-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><a href="#__codelineno-14-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">pages_patterns</span> <span class="o">=</span> <span class="p">([</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><a href="#__codelineno-14-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">PageListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'pages'</span><span class="p">),</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><a href="#__codelineno-14-6"><span class="linenos" data-linenos="6 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'&lt;int:pk&gt;/&lt;slug:slug&gt;/'</span><span class="p">,</span> <span class="n">PageDetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'page'</span><span class="p">),</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><a href="#__codelineno-14-7"><span class="linenos" data-linenos="7 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'create/'</span><span class="p">,</span> <span class="n">PageCreate</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'create'</span><span class="p">),</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><a href="#__codelineno-14-8"><span class="linenos" data-linenos="8 "></span></a><span class="p">],</span> <span class="s1">'pages'</span><span class="p">)</span>
</code></pre></div>
<p><code>template/&lt;app&gt;/&lt;modelo&gt;_form.html</code> -&gt; <code>CreateView</code> usa una plantilla llamada <code>&lt;modelo&gt;_form.html</code>, así que debes de renombrar así la tuya.</p>
<h3 id="updateview-vista-crud">UpdateView - Vista CRUD<a class="headerlink" href="#updateview-vista-crud" title="Permanent link">¶</a></h3>
<p>Es muy parecida a la anterior, pero ahora lo que vas a hacer es actualizar en lugar de crear.</p>
<p><code>views.py</code> -&gt; La importas y solo necesitas pasarle 3 atributos, el modelo, los campos y por último el <code>template_name_suffix</code>. Con este campo se le indica que archivo tiene que leer cuando se ejecute (por defecto se pone <code>_update_form</code>). Para que devuelva una página al ser actualizado, habría que usar como antes el atributo <code>succes_url</code>. Si quieres que vuelva al mismo sitio (como en el ejemplo), sobreescribes la función <code>get_success_url</code> y devuelves el mismo objeto (si le añades algún parámetro, luego en el template puedes hacer que le indique al usuario que la actualización ha sido correcta).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><a href="#__codelineno-15-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.list</span> <span class="kn">import</span> <span class="n">ListView</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><a href="#__codelineno-15-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.detail</span> <span class="kn">import</span> <span class="n">DetailView</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><a href="#__codelineno-15-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.edit</span> <span class="kn">import</span> <span class="n">CreateView</span><span class="p">,</span> <span class="n">UpdateView</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><a href="#__codelineno-15-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse_lazy</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><a href="#__codelineno-15-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Page</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><a href="#__codelineno-15-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><a href="#__codelineno-15-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><a href="#__codelineno-15-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="c1"># Create your views here.</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><a href="#__codelineno-15-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="k">class</span> <span class="nc">PageListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><a href="#__codelineno-15-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><a href="#__codelineno-15-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><a href="#__codelineno-15-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><a href="#__codelineno-15-13"><span class="linenos" data-linenos="13 "></span></a><span class="k">class</span> <span class="nc">PageDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><a href="#__codelineno-15-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><a href="#__codelineno-15-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><a href="#__codelineno-15-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a><a href="#__codelineno-15-17"><span class="linenos" data-linenos="17 "></span></a><span class="k">class</span> <span class="nc">PageCreateView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a><a href="#__codelineno-15-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a><a href="#__codelineno-15-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'content'</span><span class="p">,</span> <span class="s1">'order'</span><span class="p">]</span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a><a href="#__codelineno-15-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:pages'</span><span class="p">)</span>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a><a href="#__codelineno-15-21"><span class="linenos" data-linenos="21 "></span></a>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a><a href="#__codelineno-15-22"><span class="linenos" data-linenos="22 "></span></a><span class="k">class</span> <span class="nc">PageUpdateView</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a><a href="#__codelineno-15-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-15-24" name="__codelineno-15-24"></a><a href="#__codelineno-15-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'content'</span><span class="p">,</span> <span class="s1">'order'</span><span class="p">]</span>
<a id="__codelineno-15-25" name="__codelineno-15-25"></a><a href="#__codelineno-15-25"><span class="linenos" data-linenos="25 "></span></a>    <span class="n">template_name_suffix</span> <span class="o">=</span> <span class="s1">'_update_form'</span>
<a id="__codelineno-15-26" name="__codelineno-15-26"></a><a href="#__codelineno-15-26"><span class="linenos" data-linenos="26 "></span></a>
<a id="__codelineno-15-27" name="__codelineno-15-27"></a><a href="#__codelineno-15-27"><span class="linenos" data-linenos="27 "></span></a>    <span class="k">def</span> <span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-15-28" name="__codelineno-15-28"></a><a href="#__codelineno-15-28"><span class="linenos" data-linenos="28 "></span></a>        <span class="k">return</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:update'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">id</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'?ok'</span>
</code></pre></div>
<p><code>urls.py</code> -&gt; Debes de pasarle un <code>pk</code> para poder saber cual objeto editar.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><a href="#__codelineno-16-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><a href="#__codelineno-16-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">PageListView</span><span class="p">,</span> <span class="n">PageDetailView</span><span class="p">,</span> <span class="n">PageCreateView</span><span class="p">,</span> <span class="n">PageUpdateView</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><a href="#__codelineno-16-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><a href="#__codelineno-16-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">pages_patterns</span> <span class="o">=</span> <span class="p">([</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><a href="#__codelineno-16-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">PageListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'pages'</span><span class="p">),</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><a href="#__codelineno-16-6"><span class="linenos" data-linenos="6 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'&lt;int:pk&gt;/&lt;slug:slug&gt;/'</span><span class="p">,</span> <span class="n">PageDetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'page'</span><span class="p">),</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><a href="#__codelineno-16-7"><span class="linenos" data-linenos="7 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'create/'</span><span class="p">,</span> <span class="n">PageCreateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'create'</span><span class="p">),</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><a href="#__codelineno-16-8"><span class="linenos" data-linenos="8 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'update/&lt;int:pk&gt;/'</span><span class="p">,</span> <span class="n">PageUpdateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'update'</span><span class="p">),</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><a href="#__codelineno-16-9"><span class="linenos" data-linenos="9 "></span></a><span class="p">],</span> <span class="s1">'pages'</span><span class="p">)</span>
</code></pre></div>
<p><code>template/&lt;app&gt;/&lt;modelo&gt;_update_form</code> -&gt; Por último, el template que usa esta vista es <code>&lt;modelo&gt;_update_form</code>, que se lo has definido en el <code>views.py</code>.</p>
<h3 id="deleteview-vista-crud">DeleteView - Vista CRUD<a class="headerlink" href="#deleteview-vista-crud" title="Permanent link">¶</a></h3>
<p>Vista para borrar un objeto.</p>
<p><code>views.py</code> -&gt; Importar la clase <code>DeleteView</code> y pasarle el modelo así como la url para cuando el borrado se haya completado.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><a href="#__codelineno-17-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.list</span> <span class="kn">import</span> <span class="n">ListView</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><a href="#__codelineno-17-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.detail</span> <span class="kn">import</span> <span class="n">DetailView</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><a href="#__codelineno-17-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.edit</span> <span class="kn">import</span> <span class="n">CreateView</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">,</span> <span class="n">DeleteView</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><a href="#__codelineno-17-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse_lazy</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><a href="#__codelineno-17-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Page</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><a href="#__codelineno-17-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><a href="#__codelineno-17-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><a href="#__codelineno-17-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="c1"># Create your views here.</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><a href="#__codelineno-17-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="k">class</span> <span class="nc">PageListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><a href="#__codelineno-17-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><a href="#__codelineno-17-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><a href="#__codelineno-17-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><a href="#__codelineno-17-13"><span class="linenos" data-linenos="13 "></span></a><span class="k">class</span> <span class="nc">PageDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a><a href="#__codelineno-17-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><a href="#__codelineno-17-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a><a href="#__codelineno-17-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a><a href="#__codelineno-17-17"><span class="linenos" data-linenos="17 "></span></a><span class="k">class</span> <span class="nc">PageCreateView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a><a href="#__codelineno-17-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a><a href="#__codelineno-17-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'content'</span><span class="p">,</span> <span class="s1">'order'</span><span class="p">]</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a><a href="#__codelineno-17-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:pages'</span><span class="p">)</span>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a><a href="#__codelineno-17-21"><span class="linenos" data-linenos="21 "></span></a>
<a id="__codelineno-17-22" name="__codelineno-17-22"></a><a href="#__codelineno-17-22"><span class="linenos" data-linenos="22 "></span></a><span class="k">class</span> <span class="nc">PageUpdateView</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>
<a id="__codelineno-17-23" name="__codelineno-17-23"></a><a href="#__codelineno-17-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-17-24" name="__codelineno-17-24"></a><a href="#__codelineno-17-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'content'</span><span class="p">,</span> <span class="s1">'order'</span><span class="p">]</span>
<a id="__codelineno-17-25" name="__codelineno-17-25"></a><a href="#__codelineno-17-25"><span class="linenos" data-linenos="25 "></span></a>    <span class="n">template_name_suffix</span> <span class="o">=</span> <span class="s1">'_update_form'</span>
<a id="__codelineno-17-26" name="__codelineno-17-26"></a><a href="#__codelineno-17-26"><span class="linenos" data-linenos="26 "></span></a>
<a id="__codelineno-17-27" name="__codelineno-17-27"></a><a href="#__codelineno-17-27"><span class="linenos" data-linenos="27 "></span></a>    <span class="k">def</span> <span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-28" name="__codelineno-17-28"></a><a href="#__codelineno-17-28"><span class="linenos" data-linenos="28 "></span></a>        <span class="k">return</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:update'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">id</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'?ok'</span>
<a id="__codelineno-17-29" name="__codelineno-17-29"></a><a href="#__codelineno-17-29"><span class="linenos" data-linenos="29 "></span></a>
<a id="__codelineno-17-30" name="__codelineno-17-30"></a><a href="#__codelineno-17-30"><span class="linenos" data-linenos="30 "></span></a><span class="k">class</span> <span class="nc">PageDeleteView</span><span class="p">(</span><span class="n">DeleteView</span><span class="p">):</span>
<a id="__codelineno-17-31" name="__codelineno-17-31"></a><a href="#__codelineno-17-31"><span class="linenos" data-linenos="31 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-17-32" name="__codelineno-17-32"></a><a href="#__codelineno-17-32"><span class="linenos" data-linenos="32 "></span></a>    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:pages'</span><span class="p">)</span>
</code></pre></div>
<p><code>urls.py</code> -&gt; Tienes que pasarle un pk o un slug para borrar el elemento.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><a href="#__codelineno-18-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><a href="#__codelineno-18-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">PageListView</span><span class="p">,</span> <span class="n">PageDetailView</span><span class="p">,</span> <span class="n">PageCreateView</span><span class="p">,</span> \
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><a href="#__codelineno-18-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="n">PageUpdateView</span><span class="p">,</span> <span class="n">PageDeleteView</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><a href="#__codelineno-18-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><a href="#__codelineno-18-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">pages_patterns</span> <span class="o">=</span> <span class="p">([</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><a href="#__codelineno-18-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">PageListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'pages'</span><span class="p">),</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><a href="#__codelineno-18-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'&lt;int:pk&gt;/&lt;slug:slug&gt;/'</span><span class="p">,</span> <span class="n">PageDetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'page'</span><span class="p">),</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><a href="#__codelineno-18-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'create/'</span><span class="p">,</span> <span class="n">PageCreateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'create'</span><span class="p">),</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><a href="#__codelineno-18-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'update/&lt;int:pk&gt;/'</span><span class="p">,</span> <span class="n">PageUpdateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'update'</span><span class="p">),</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><a href="#__codelineno-18-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'delete/&lt;int:pk&gt;/'</span><span class="p">,</span> <span class="n">PageDeleteView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'delete'</span><span class="p">),</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><a href="#__codelineno-18-11"><span class="linenos" data-linenos="11 "></span></a><span class="p">],</span> <span class="s1">'pages'</span><span class="p">)</span>
</code></pre></div>
<p><code>template/&lt;app&gt;/&lt;modelo&gt;_confirm_delete.html</code> -&gt; Por último tienes que crear el formulario de borrado en una template que se llame <code>&lt;modelo&gt;_confirm_delete.html</code></p>
<h2 id="formularios-para-modelos">Formularios para Modelos<a class="headerlink" href="#formularios-para-modelos" title="Permanent link">¶</a></h2>
<p>Dentro de tu app, creas un fichero llamado <code>forms.py</code> e importas <code>from django import forms</code>, para crear la estructura de los campos. Al enlazarle un modelo al formulario, este se genera automáticamente.</p>
<p><code>forms.py</code> -&gt; Importas el módulo <code>forms</code> y usas su clase <code>ModelForm</code>. Ahora debes de crear una clase <code>Meta</code> dentro, con el modelo y los campos. Con el atributo <code>widgets</code> le indicas que tipo de elemento html va a ser y dentro le pones los css que va a usar con el <code>attrs</code> y su diccionario. Con <code>labels</code> puedes cambiarle el texto del título del campo, quitándolo (como en el ejemplo) o poniéndole otro.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><a href="#__codelineno-19-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><a href="#__codelineno-19-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Page</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><a href="#__codelineno-19-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><a href="#__codelineno-19-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">class</span> <span class="nc">PageForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><a href="#__codelineno-19-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><a href="#__codelineno-19-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><a href="#__codelineno-19-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><a href="#__codelineno-19-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'content'</span><span class="p">,</span> <span class="s1">'order'</span><span class="p">]</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><a href="#__codelineno-19-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a><a href="#__codelineno-19-10"><span class="linenos" data-linenos="10 "></span></a>            <span class="s1">'title'</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control'</span><span class="p">,</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><a href="#__codelineno-19-11"><span class="linenos" data-linenos="11 "></span></a>                                            <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Título'</span><span class="p">}),</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a><a href="#__codelineno-19-12"><span class="linenos" data-linenos="12 "></span></a>            <span class="s1">'content'</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Textarea</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control'</span><span class="p">,</span>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a><a href="#__codelineno-19-13"><span class="linenos" data-linenos="13 "></span></a>                                            <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Contenido'</span><span class="p">}),</span>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a><a href="#__codelineno-19-14"><span class="linenos" data-linenos="14 "></span></a>            <span class="s1">'order'</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">NumberInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control'</span><span class="p">,</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><a href="#__codelineno-19-15"><span class="linenos" data-linenos="15 "></span></a>                                            <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Orden'</span><span class="p">})</span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a><a href="#__codelineno-19-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="p">}</span>
<a id="__codelineno-19-17" name="__codelineno-19-17"></a><a href="#__codelineno-19-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'title'</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'content'</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'order'</span><span class="p">:</span> <span class="s1">''</span><span class="p">}</span>
</code></pre></div>
<p><code>views.py</code> -&gt; Importas el formulario y lo metes dentro de su vista. Ahora el campo <code>fields</code> no es necesario porque va en el formulario.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><a href="#__codelineno-20-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.edit</span> <span class="kn">import</span> <span class="n">CreateView</span><span class="p">,</span> <span class="n">UpdateView</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><a href="#__codelineno-20-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse_lazy</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><a href="#__codelineno-20-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Page</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><a href="#__codelineno-20-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">PageForm</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><a href="#__codelineno-20-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><a href="#__codelineno-20-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><a href="#__codelineno-20-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">class</span> <span class="nc">PageCreateView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><a href="#__codelineno-20-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><a href="#__codelineno-20-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">PageForm</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><a href="#__codelineno-20-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:pages'</span><span class="p">)</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><a href="#__codelineno-20-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><a href="#__codelineno-20-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><a href="#__codelineno-20-13"><span class="linenos" data-linenos="13 "></span></a><span class="k">class</span> <span class="nc">PageUpdateView</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><a href="#__codelineno-20-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><a href="#__codelineno-20-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">PageForm</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a><a href="#__codelineno-20-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">template_name_suffix</span> <span class="o">=</span> <span class="s1">'_update_form'</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a><a href="#__codelineno-20-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a><a href="#__codelineno-20-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="k">def</span> <span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a><a href="#__codelineno-20-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="k">return</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:update'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">id</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'?ok'</span>
</code></pre></div>
<h3 id="ckeditor-adaptativo">ckeditor adaptativo<a class="headerlink" href="#ckeditor-adaptativo" title="Permanent link">¶</a></h3>
<p>Para añadir y hacer adaptativo el ckeditor tienes que hacer lo siguiente:</p>
<p><code>&lt;app&gt;/static/&lt;app&gt;/css/custom_ckeditor.css</code> -&gt; Creas un fichero css donde editas los estilos del ckeditor.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><a href="#__codelineno-21-1"><span class="linenos" data-linenos="1 "></span></a><span class="p">.</span><span class="nc">django-ckeditor-widget</span><span class="o">,</span><span class="w"> </span><span class="p">.</span><span class="nc">cke_editor_id_content</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><a href="#__codelineno-21-2"><span class="linenos" data-linenos="2 "></span></a><span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="w"> </span><span class="cp">!important</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><a href="#__codelineno-21-3"><span class="linenos" data-linenos="3 "></span></a><span class="w">    </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">821</span><span class="kt">px</span><span class="w"> </span><span class="cp">!important</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><a href="#__codelineno-21-4"><span class="linenos" data-linenos="4 "></span></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>En el template que uses común para todos los demás templates, importalo y añade el link al css donde lo has a tuneado.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><a href="#__codelineno-22-1"><span class="linenos" data-linenos="1 "></span></a>{% load static %}
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><a href="#__codelineno-22-2"><span class="linenos" data-linenos="2 "></span></a><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/javascript"</span> <span class="na">src</span><span class="o">=</span><span class="s">"{% static "</span><span class="na">ckeditor</span><span class="err">/</span><span class="na">ckeditor-init</span><span class="err">.</span><span class="na">js</span><span class="err">"</span> <span class="err">%}"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><a href="#__codelineno-22-3"><span class="linenos" data-linenos="3 "></span></a><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/javascript"</span> <span class="na">src</span><span class="o">=</span><span class="s">"{% static "</span><span class="na">ckeditor</span><span class="err">/</span><span class="na">ckeditor</span><span class="err">/</span><span class="na">ckeditor</span><span class="err">.</span><span class="na">js</span><span class="err">"</span> <span class="err">%}"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><a href="#__codelineno-22-4"><span class="linenos" data-linenos="4 "></span></a><span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">"{% static 'pages/css/custom_ckeditor.css' %}"</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span><span class="p">&gt;</span>
</code></pre></div>
<h3 id="usuarios-registrados">Usuarios registrados<a class="headerlink" href="#usuarios-registrados" title="Permanent link">¶</a></h3>
<p>Es probable que muchos de los formularios solo quieras que los puedan usar usuarios admin o registrados. Siempre que no seas un usuario loggeado, Django te detecta como usuario anónimo, <code>AnonymousUser</code>.</p>
<p><code>views.py</code> -&gt; Para que en tu vista puedas detectar si el usuario está logeado, debes de reescribir el método <code>dispatch</code> de la clase. En él miras si el usuario está dentro del staff, y si no, lo rediriges donde quieras (por ejemplo, al login del admin).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><a href="#__codelineno-23-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.edit</span> <span class="kn">import</span> <span class="n">CreateView</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><a href="#__codelineno-23-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse_lazy</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><a href="#__codelineno-23-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Page</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><a href="#__codelineno-23-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">PageForm</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><a href="#__codelineno-23-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><a href="#__codelineno-23-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><a href="#__codelineno-23-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><a href="#__codelineno-23-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="c1"># Create your views here.</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><a href="#__codelineno-23-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="k">class</span> <span class="nc">PageCreateView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><a href="#__codelineno-23-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><a href="#__codelineno-23-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">PageForm</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a><a href="#__codelineno-23-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:pages'</span><span class="p">)</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><a href="#__codelineno-23-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a><a href="#__codelineno-23-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><a href="#__codelineno-23-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a><a href="#__codelineno-23-16"><span class="linenos" data-linenos="16 "></span></a>            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'admin:login'</span><span class="p">))</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a><a href="#__codelineno-23-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">PageCreateView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
<h3 id="usuarios-registrados-mixins-manual">Usuarios registrados - Mixins Manual<a class="headerlink" href="#usuarios-registrados-mixins-manual" title="Permanent link">¶</a></h3>
<p>Si quieres que esa reedireción de antes se use en más vistas, no hace falta que copias ese método en cada vista. Existe un mecanismo llamado <code>Mixin</code> que permite escribirlo una vez y usarlo en todas.</p>
<p><code>views.py</code> -&gt; Creas una clase, que herede de <code>object</code> (en Python 3, por defecto, todas las clases heredan de <code>object</code>) y le pones el método <code>dispatch</code> de antes. Luego en cada vista haces que herede primero de esta nueva clase y luego de su modelo de vista.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><a href="#__codelineno-24-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.edit</span> <span class="kn">import</span> <span class="n">CreateView</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">,</span> <span class="n">DeleteView</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><a href="#__codelineno-24-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse_lazy</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a><a href="#__codelineno-24-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Page</span>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><a href="#__codelineno-24-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">PageForm</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><a href="#__codelineno-24-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><a href="#__codelineno-24-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a><a href="#__codelineno-24-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a><a href="#__codelineno-24-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="c1"># Create your views here.</span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a><a href="#__codelineno-24-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="k">class</span> <span class="nc">StaffRequiredMixin</span><span class="p">():</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a><a href="#__codelineno-24-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a><a href="#__codelineno-24-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a><a href="#__codelineno-24-12"><span class="linenos" data-linenos="12 "></span></a>            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'admin:login'</span><span class="p">))</span>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a><a href="#__codelineno-24-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">StaffRequiredMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-24-14" name="__codelineno-24-14"></a><a href="#__codelineno-24-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-24-15" name="__codelineno-24-15"></a><a href="#__codelineno-24-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-24-16" name="__codelineno-24-16"></a><a href="#__codelineno-24-16"><span class="linenos" data-linenos="16 "></span></a><span class="k">class</span> <span class="nc">PageCreateView</span><span class="p">(</span><span class="n">StaffRequiredMixin</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">):</span>
<a id="__codelineno-24-17" name="__codelineno-24-17"></a><a href="#__codelineno-24-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-24-18" name="__codelineno-24-18"></a><a href="#__codelineno-24-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">PageForm</span>
<a id="__codelineno-24-19" name="__codelineno-24-19"></a><a href="#__codelineno-24-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:pages'</span><span class="p">)</span>
<a id="__codelineno-24-20" name="__codelineno-24-20"></a><a href="#__codelineno-24-20"><span class="linenos" data-linenos="20 "></span></a>
<a id="__codelineno-24-21" name="__codelineno-24-21"></a><a href="#__codelineno-24-21"><span class="linenos" data-linenos="21 "></span></a>
<a id="__codelineno-24-22" name="__codelineno-24-22"></a><a href="#__codelineno-24-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-24-23" name="__codelineno-24-23"></a><a href="#__codelineno-24-23"><span class="linenos" data-linenos="23 "></span></a><span class="k">class</span> <span class="nc">PageUpdateView</span><span class="p">(</span><span class="n">StaffRequiredMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>
<a id="__codelineno-24-24" name="__codelineno-24-24"></a><a href="#__codelineno-24-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-24-25" name="__codelineno-24-25"></a><a href="#__codelineno-24-25"><span class="linenos" data-linenos="25 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">PageForm</span>
<a id="__codelineno-24-26" name="__codelineno-24-26"></a><a href="#__codelineno-24-26"><span class="linenos" data-linenos="26 "></span></a>    <span class="n">template_name_suffix</span> <span class="o">=</span> <span class="s1">'_update_form'</span>
<a id="__codelineno-24-27" name="__codelineno-24-27"></a><a href="#__codelineno-24-27"><span class="linenos" data-linenos="27 "></span></a>
<a id="__codelineno-24-28" name="__codelineno-24-28"></a><a href="#__codelineno-24-28"><span class="linenos" data-linenos="28 "></span></a>    <span class="k">def</span> <span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-24-29" name="__codelineno-24-29"></a><a href="#__codelineno-24-29"><span class="linenos" data-linenos="29 "></span></a>        <span class="k">return</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:update'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">id</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'?ok'</span>
<a id="__codelineno-24-30" name="__codelineno-24-30"></a><a href="#__codelineno-24-30"><span class="linenos" data-linenos="30 "></span></a>
<a id="__codelineno-24-31" name="__codelineno-24-31"></a><a href="#__codelineno-24-31"><span class="linenos" data-linenos="31 "></span></a>
<a id="__codelineno-24-32" name="__codelineno-24-32"></a><a href="#__codelineno-24-32"><span class="linenos" data-linenos="32 "></span></a><span class="k">class</span> <span class="nc">PageDeleteView</span><span class="p">(</span><span class="n">StaffRequiredMixin</span><span class="p">,</span> <span class="n">DeleteView</span><span class="p">):</span>
<a id="__codelineno-24-33" name="__codelineno-24-33"></a><a href="#__codelineno-24-33"><span class="linenos" data-linenos="33 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-24-34" name="__codelineno-24-34"></a><a href="#__codelineno-24-34"><span class="linenos" data-linenos="34 "></span></a>    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:pages'</span><span class="p">)</span>
</code></pre></div>
<h3 id="usuarios-registrados-mixins-decorado">Usuarios registrados - Mixins Decorado<a class="headerlink" href="#usuarios-registrados-mixins-decorado" title="Permanent link">¶</a></h3>
<p>El punto anterior ya se ha automatizado en Django usando decoradores.</p>
<p><code>views.py</code> -&gt; Tienes que importar por un lado el <code>method_decorator</code>, que permite usar decoradores de Django, y por otro el decorador <code>staff_member_required</code>. Ahora en el método <code>dispatch</code> puedes quitar el <code>if</code> con la redirección, ya que se va a hacer sola. Ahora en la url al entrar, incluso te dirá donde debe de ir despues de loguearse.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><a href="#__codelineno-25-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.edit</span> <span class="kn">import</span> <span class="n">CreateView</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">,</span> <span class="n">DeleteView</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><a href="#__codelineno-25-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse_lazy</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><a href="#__codelineno-25-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Page</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><a href="#__codelineno-25-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">PageForm</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><a href="#__codelineno-25-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><a href="#__codelineno-25-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="kn">from</span> <span class="nn">django.utils.decorators</span> <span class="kn">import</span> <span class="n">method_decorator</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><a href="#__codelineno-25-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.admin.views.decorators</span> <span class="kn">import</span> <span class="n">staff_member_required</span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><a href="#__codelineno-25-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a><a href="#__codelineno-25-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="c1"># Create your views here.</span>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><a href="#__codelineno-25-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">class</span> <span class="nc">StaffRequiredMixin</span><span class="p">():</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><a href="#__codelineno-25-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-25-12" name="__codelineno-25-12"></a><a href="#__codelineno-25-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="nd">@method_decorator</span><span class="p">(</span><span class="n">staff_member_required</span><span class="p">)</span>
<a id="__codelineno-25-13" name="__codelineno-25-13"></a><a href="#__codelineno-25-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-25-14" name="__codelineno-25-14"></a><a href="#__codelineno-25-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">StaffRequiredMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-25-15" name="__codelineno-25-15"></a><a href="#__codelineno-25-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-25-16" name="__codelineno-25-16"></a><a href="#__codelineno-25-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-25-17" name="__codelineno-25-17"></a><a href="#__codelineno-25-17"><span class="linenos" data-linenos="17 "></span></a><span class="k">class</span> <span class="nc">PageCreateView</span><span class="p">(</span><span class="n">StaffRequiredMixin</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">):</span>
<a id="__codelineno-25-18" name="__codelineno-25-18"></a><a href="#__codelineno-25-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-25-19" name="__codelineno-25-19"></a><a href="#__codelineno-25-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">PageForm</span>
<a id="__codelineno-25-20" name="__codelineno-25-20"></a><a href="#__codelineno-25-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:pages'</span><span class="p">)</span>
<a id="__codelineno-25-21" name="__codelineno-25-21"></a><a href="#__codelineno-25-21"><span class="linenos" data-linenos="21 "></span></a>
<a id="__codelineno-25-22" name="__codelineno-25-22"></a><a href="#__codelineno-25-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-25-23" name="__codelineno-25-23"></a><a href="#__codelineno-25-23"><span class="linenos" data-linenos="23 "></span></a><span class="k">class</span> <span class="nc">PageUpdateView</span><span class="p">(</span><span class="n">StaffRequiredMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>
<a id="__codelineno-25-24" name="__codelineno-25-24"></a><a href="#__codelineno-25-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-25-25" name="__codelineno-25-25"></a><a href="#__codelineno-25-25"><span class="linenos" data-linenos="25 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">PageForm</span>
<a id="__codelineno-25-26" name="__codelineno-25-26"></a><a href="#__codelineno-25-26"><span class="linenos" data-linenos="26 "></span></a>    <span class="n">template_name_suffix</span> <span class="o">=</span> <span class="s1">'_update_form'</span>
<a id="__codelineno-25-27" name="__codelineno-25-27"></a><a href="#__codelineno-25-27"><span class="linenos" data-linenos="27 "></span></a>
<a id="__codelineno-25-28" name="__codelineno-25-28"></a><a href="#__codelineno-25-28"><span class="linenos" data-linenos="28 "></span></a>    <span class="k">def</span> <span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-25-29" name="__codelineno-25-29"></a><a href="#__codelineno-25-29"><span class="linenos" data-linenos="29 "></span></a>        <span class="k">return</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:update'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">id</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'?ok'</span>
<a id="__codelineno-25-30" name="__codelineno-25-30"></a><a href="#__codelineno-25-30"><span class="linenos" data-linenos="30 "></span></a>
<a id="__codelineno-25-31" name="__codelineno-25-31"></a><a href="#__codelineno-25-31"><span class="linenos" data-linenos="31 "></span></a>
<a id="__codelineno-25-32" name="__codelineno-25-32"></a><a href="#__codelineno-25-32"><span class="linenos" data-linenos="32 "></span></a><span class="k">class</span> <span class="nc">PageDeleteView</span><span class="p">(</span><span class="n">StaffRequiredMixin</span><span class="p">,</span> <span class="n">DeleteView</span><span class="p">):</span>
<a id="__codelineno-25-33" name="__codelineno-25-33"></a><a href="#__codelineno-25-33"><span class="linenos" data-linenos="33 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-25-34" name="__codelineno-25-34"></a><a href="#__codelineno-25-34"><span class="linenos" data-linenos="34 "></span></a>    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:pages'</span><span class="p">)</span>
</code></pre></div>
<p>Pero tener una clase solo para eso no tiene sentido, así que se puede usar el decorador en las propias vistas usando el <code>method_decorator</code> y pasándole el decorador, así como el método a decorar</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><a href="#__codelineno-26-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.edit</span> <span class="kn">import</span> <span class="n">CreateView</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">,</span> <span class="n">DeleteView</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><a href="#__codelineno-26-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse_lazy</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><a href="#__codelineno-26-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Page</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><a href="#__codelineno-26-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">PageForm</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><a href="#__codelineno-26-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><a href="#__codelineno-26-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="kn">from</span> <span class="nn">django.utils.decorators</span> <span class="kn">import</span> <span class="n">method_decorator</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><a href="#__codelineno-26-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.admin.views.decorators</span> <span class="kn">import</span> <span class="n">staff_member_required</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><a href="#__codelineno-26-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a><a href="#__codelineno-26-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a><a href="#__codelineno-26-10"><span class="linenos" data-linenos="10 "></span></a><span class="c1"># Create your views here.</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a><a href="#__codelineno-26-11"><span class="linenos" data-linenos="11 "></span></a><span class="nd">@method_decorator</span><span class="p">(</span><span class="n">staff_member_required</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"dispatch"</span><span class="p">)</span>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a><a href="#__codelineno-26-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">class</span> <span class="nc">PageCreateView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a><a href="#__codelineno-26-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a><a href="#__codelineno-26-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">PageForm</span>
<a id="__codelineno-26-15" name="__codelineno-26-15"></a><a href="#__codelineno-26-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:pages'</span><span class="p">)</span>
<a id="__codelineno-26-16" name="__codelineno-26-16"></a><a href="#__codelineno-26-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-26-17" name="__codelineno-26-17"></a><a href="#__codelineno-26-17"><span class="linenos" data-linenos="17 "></span></a><span class="nd">@method_decorator</span><span class="p">(</span><span class="n">staff_member_required</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"dispatch"</span><span class="p">)</span>
<a id="__codelineno-26-18" name="__codelineno-26-18"></a><a href="#__codelineno-26-18"><span class="linenos" data-linenos="18 "></span></a><span class="k">class</span> <span class="nc">PageUpdateView</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>
<a id="__codelineno-26-19" name="__codelineno-26-19"></a><a href="#__codelineno-26-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-26-20" name="__codelineno-26-20"></a><a href="#__codelineno-26-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">PageForm</span>
<a id="__codelineno-26-21" name="__codelineno-26-21"></a><a href="#__codelineno-26-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="n">template_name_suffix</span> <span class="o">=</span> <span class="s1">'_update_form'</span>
<a id="__codelineno-26-22" name="__codelineno-26-22"></a><a href="#__codelineno-26-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-26-23" name="__codelineno-26-23"></a><a href="#__codelineno-26-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="k">def</span> <span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-26-24" name="__codelineno-26-24"></a><a href="#__codelineno-26-24"><span class="linenos" data-linenos="24 "></span></a>        <span class="k">return</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:update'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">id</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'?ok'</span>
<a id="__codelineno-26-25" name="__codelineno-26-25"></a><a href="#__codelineno-26-25"><span class="linenos" data-linenos="25 "></span></a>
<a id="__codelineno-26-26" name="__codelineno-26-26"></a><a href="#__codelineno-26-26"><span class="linenos" data-linenos="26 "></span></a>
<a id="__codelineno-26-27" name="__codelineno-26-27"></a><a href="#__codelineno-26-27"><span class="linenos" data-linenos="27 "></span></a><span class="nd">@method_decorator</span><span class="p">(</span><span class="n">staff_member_required</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"dispatch"</span><span class="p">)</span>
<a id="__codelineno-26-28" name="__codelineno-26-28"></a><a href="#__codelineno-26-28"><span class="linenos" data-linenos="28 "></span></a><span class="k">class</span> <span class="nc">PageDeleteView</span><span class="p">(</span><span class="n">DeleteView</span><span class="p">):</span>
<a id="__codelineno-26-29" name="__codelineno-26-29"></a><a href="#__codelineno-26-29"><span class="linenos" data-linenos="29 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Page</span>
<a id="__codelineno-26-30" name="__codelineno-26-30"></a><a href="#__codelineno-26-30"><span class="linenos" data-linenos="30 "></span></a>    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'pages:pages'</span><span class="p">)</span>
</code></pre></div>
<p>Existen <strong>2 decoradores más</strong> que son interesantes: <code>login_required</code> y <code>permission_required</code>.</p>
<h2 id="auth-views">Auth Views<a class="headerlink" href="#auth-views" title="Permanent link">¶</a></h2>
<p>Django tiene vistas de autenticación ya creadas: login, logout, ... No hace falta crearlas, él las genera.</p>
<p><code>&lt;proyecto&gt;/&lt;proyecto&gt;/urls.py</code> -&gt; Generar las urls para las vistas desde <code>accounts</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><a href="#__codelineno-27-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><a href="#__codelineno-27-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><a href="#__codelineno-27-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">pages.urls</span> <span class="kn">import</span> <span class="n">pages_patterns</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><a href="#__codelineno-27-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><a href="#__codelineno-27-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a><a href="#__codelineno-27-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">'core.urls'</span><span class="p">)),</span>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a><a href="#__codelineno-27-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'pages/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">pages_patterns</span><span class="p">)),</span>
<a id="__codelineno-27-8" name="__codelineno-27-8"></a><a href="#__codelineno-27-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
<a id="__codelineno-27-9" name="__codelineno-27-9"></a><a href="#__codelineno-27-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="c1"># Paths de Auth</span>
<a id="__codelineno-27-10" name="__codelineno-27-10"></a><a href="#__codelineno-27-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'accounts/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">'django.contrib.auth.urls'</span><span class="p">)),</span>
<a id="__codelineno-27-11" name="__codelineno-27-11"></a><a href="#__codelineno-27-11"><span class="linenos" data-linenos="11 "></span></a><span class="p">]</span>
</code></pre></div>
<p>Si abres la url <a href="http://127.0.0.1:8000/accounts/">accounts</a> te dice todos las urls que hay, como <code>accounts/login</code>.</p>
<h3 id="loginview">LoginView<a class="headerlink" href="#loginview" title="Permanent link">¶</a></h3>
<p>Si abres <code>accounts/login</code> da error de template. Busca el template <code>&lt;app&gt;/login.html</code>, así que hay que crearlo.</p>
<p><code>&lt;app&gt;/templates/&lt;app&gt;/login.html</code></p>
<p><code>settings.py</code> -&gt; En el settings del proyecto tendremos que añadir la app al principio de todo, ya que muchos formularios pueden estar con conflicto con otras aplicaciones. También debemos de crear al final las redirecciones con la variable <code>LOGIN_REDIRECT_URL</code> donde se le indica donde ir al loguearse.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><a href="#__codelineno-28-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1"># ...</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><a href="#__codelineno-28-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><a href="#__codelineno-28-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><a href="#__codelineno-28-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="s1">'registration.apps.RegistrationConfig'</span><span class="p">,</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><a href="#__codelineno-28-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="s1">'django.contrib.admin'</span><span class="p">,</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a><a href="#__codelineno-28-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="s1">'django.contrib.auth'</span><span class="p">,</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a><a href="#__codelineno-28-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="s1">'django.contrib.contenttypes'</span><span class="p">,</span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a><a href="#__codelineno-28-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="s1">'django.contrib.sessions'</span><span class="p">,</span>
<a id="__codelineno-28-9" name="__codelineno-28-9"></a><a href="#__codelineno-28-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="s1">'django.contrib.messages'</span><span class="p">,</span>
<a id="__codelineno-28-10" name="__codelineno-28-10"></a><a href="#__codelineno-28-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="s1">'django.contrib.staticfiles'</span><span class="p">,</span>
<a id="__codelineno-28-11" name="__codelineno-28-11"></a><a href="#__codelineno-28-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="s1">'ckeditor'</span><span class="p">,</span>
<a id="__codelineno-28-12" name="__codelineno-28-12"></a><a href="#__codelineno-28-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="s1">'core.apps.CoreConfig'</span><span class="p">,</span>
<a id="__codelineno-28-13" name="__codelineno-28-13"></a><a href="#__codelineno-28-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="s1">'pages.apps.PagesConfig'</span><span class="p">,</span>
<a id="__codelineno-28-14" name="__codelineno-28-14"></a><a href="#__codelineno-28-14"><span class="linenos" data-linenos="14 "></span></a><span class="p">]</span>
<a id="__codelineno-28-15" name="__codelineno-28-15"></a><a href="#__codelineno-28-15"><span class="linenos" data-linenos="15 "></span></a><span class="c1"># ...</span>
<a id="__codelineno-28-16" name="__codelineno-28-16"></a><a href="#__codelineno-28-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-28-17" name="__codelineno-28-17"></a><a href="#__codelineno-28-17"><span class="linenos" data-linenos="17 "></span></a><span class="c1"># Auth redirects</span>
<a id="__codelineno-28-18" name="__codelineno-28-18"></a><a href="#__codelineno-28-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">LOGIN_REDIRECT_URL</span> <span class="o">=</span> <span class="s1">'home'</span>
</code></pre></div>
<p>Luego en el template donde lo vayas a usar simplemente usa <code>{% url 'login' %}</code></p>
<h3 id="logoutview">LogoutView<a class="headerlink" href="#logoutview" title="Permanent link">¶</a></h3>
<p>Es parecido al anterior. En este caso solo tienes que definir la variable <code>LOGOUT_REDIRECT_URL</code> en el <code>settings</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><a href="#__codelineno-29-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># Auth redirects</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><a href="#__codelineno-29-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">LOGIN_REDIRECT_URL</span> <span class="o">=</span> <span class="s1">'pages:pages'</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><a href="#__codelineno-29-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">LOGOUT_REDIRECT_URL</span> <span class="o">=</span> <span class="s1">'home'</span>
</code></pre></div>
<p>Y luego en algún template puedes enlazar la acción con <code>{% url 'logout' %}</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><a href="#__codelineno-30-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">"navbar-nav"</span><span class="p">&gt;</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><a href="#__codelineno-30-2"><span class="linenos" data-linenos=" 2 "></span></a>    {% if not request.user.is_authenticated %}
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><a href="#__codelineno-30-3"><span class="linenos" data-linenos=" 3 "></span></a>        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">"nav-item"</span><span class="p">&gt;</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><a href="#__codelineno-30-4"><span class="linenos" data-linenos=" 4 "></span></a>            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">"nav-link"</span> <span class="na">href</span><span class="o">=</span><span class="s">"{% url 'login' %}"</span><span class="p">&gt;</span>Acceder<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a><a href="#__codelineno-30-5"><span class="linenos" data-linenos=" 5 "></span></a>        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a><a href="#__codelineno-30-6"><span class="linenos" data-linenos=" 6 "></span></a>    {% else %}
<a id="__codelineno-30-7" name="__codelineno-30-7"></a><a href="#__codelineno-30-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">"nav-item"</span><span class="p">&gt;</span>
<a id="__codelineno-30-8" name="__codelineno-30-8"></a><a href="#__codelineno-30-8"><span class="linenos" data-linenos=" 8 "></span></a>            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">"nav-link"</span> <span class="na">href</span><span class="o">=</span><span class="s">"{% url 'logout' %}"</span><span class="p">&gt;</span>Salir<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a id="__codelineno-30-9" name="__codelineno-30-9"></a><a href="#__codelineno-30-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-30-10" name="__codelineno-30-10"></a><a href="#__codelineno-30-10"><span class="linenos" data-linenos="10 "></span></a>    {% endif %}
<a id="__codelineno-30-11" name="__codelineno-30-11"></a><a href="#__codelineno-30-11"><span class="linenos" data-linenos="11 "></span></a><span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre></div>
<h2 id="registro-de-usuario">Registro de Usuario<a class="headerlink" href="#registro-de-usuario" title="Permanent link">¶</a></h2>
<p>Se suele hacer en una app aparte (<code>registration</code> por ejemplo).</p>
<p><code>&lt;app&gt;/views.py</code> -&gt; Importa el formulario de creación de usuario <code>UserCreationForm</code> y una vista genérica de creación como <code>CreateView</code>. Dentro de esta se le pasa el formulario en el atributo <code>form_class</code> así como su template. También debes de devolver la redirección con algún parámetro que permita saber que todo ha ido correcto.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><a href="#__codelineno-31-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><a href="#__codelineno-31-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">CreateView</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><a href="#__codelineno-31-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse_lazy</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><a href="#__codelineno-31-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a><a href="#__codelineno-31-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><a href="#__codelineno-31-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="c1"># Create your views here.</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a><a href="#__codelineno-31-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">class</span> <span class="nc">SignUpView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a><a href="#__codelineno-31-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">UserCreationForm</span>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a><a href="#__codelineno-31-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'registration/signup.html'</span>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a><a href="#__codelineno-31-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-31-11" name="__codelineno-31-11"></a><a href="#__codelineno-31-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="k">def</span> <span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-31-12" name="__codelineno-31-12"></a><a href="#__codelineno-31-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="k">return</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'login'</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'?register'</span>
</code></pre></div>
<p><code>&lt;app&gt;/urls.py</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><a href="#__codelineno-32-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><a href="#__codelineno-32-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">SignUpView</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><a href="#__codelineno-32-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><a href="#__codelineno-32-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><a href="#__codelineno-32-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'signup/'</span><span class="p">,</span> <span class="n">SignUpView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'signup'</span><span class="p">),</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><a href="#__codelineno-32-6"><span class="linenos" data-linenos="6 "></span></a><span class="p">]</span>
</code></pre></div>
<p><code>&lt;proyecto&gt;/urls.py</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><a href="#__codelineno-33-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a><a href="#__codelineno-33-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><a href="#__codelineno-33-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">pages.urls</span> <span class="kn">import</span> <span class="n">pages_patterns</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><a href="#__codelineno-33-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><a href="#__codelineno-33-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><a href="#__codelineno-33-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">'core.urls'</span><span class="p">)),</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a><a href="#__codelineno-33-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'pages/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">pages_patterns</span><span class="p">)),</span>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a><a href="#__codelineno-33-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a><a href="#__codelineno-33-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="c1"># Paths de Auth</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a><a href="#__codelineno-33-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'accounts/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">'django.contrib.auth.urls'</span><span class="p">)),</span>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a><a href="#__codelineno-33-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'accounts/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">'registration.urls'</span><span class="p">)),</span>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a><a href="#__codelineno-33-12"><span class="linenos" data-linenos="12 "></span></a><span class="p">]</span>
</code></pre></div>
<p><code>&lt;app&gt;/templates/&lt;app&gt;/&lt;template_name&gt;</code> -&gt; Es un formulario normal y corriente.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><a href="#__codelineno-34-1"><span class="linenos" data-linenos=" 1 "></span></a>{% extends 'core/base.html' %}
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><a href="#__codelineno-34-2"><span class="linenos" data-linenos=" 2 "></span></a>{% load static %}
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><a href="#__codelineno-34-3"><span class="linenos" data-linenos=" 3 "></span></a>{% block title %}Registro{% endblock %}
<a id="__codelineno-34-4" name="__codelineno-34-4"></a><a href="#__codelineno-34-4"><span class="linenos" data-linenos=" 4 "></span></a>{% block content %}
<a id="__codelineno-34-5" name="__codelineno-34-5"></a><a href="#__codelineno-34-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;.</span><span class="nc">errorlist</span><span class="p">{</span><span class="k">color</span><span class="p">:</span><span class="kc">red</span><span class="p">;}&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a><a href="#__codelineno-34-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="p">&lt;</span><span class="nt">main</span> <span class="na">role</span><span class="o">=</span><span class="s">"main"</span><span class="p">&gt;</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a><a href="#__codelineno-34-7"><span class="linenos" data-linenos=" 7 "></span></a>  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"container"</span><span class="p">&gt;</span>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a><a href="#__codelineno-34-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"row mt-3"</span><span class="p">&gt;</span>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a><a href="#__codelineno-34-9"><span class="linenos" data-linenos=" 9 "></span></a>      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"col-md-9 mx-auto mb-5"</span><span class="p">&gt;</span>
<a id="__codelineno-34-10" name="__codelineno-34-10"></a><a href="#__codelineno-34-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">""</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span><span class="p">&gt;</span>{% csrf_token %}
<a id="__codelineno-34-11" name="__codelineno-34-11"></a><a href="#__codelineno-34-11"><span class="linenos" data-linenos="11 "></span></a>          <span class="p">&lt;</span><span class="nt">h3</span> <span class="na">class</span><span class="o">=</span><span class="s">"mb-4"</span><span class="p">&gt;</span>Registro<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<a id="__codelineno-34-12" name="__codelineno-34-12"></a><a href="#__codelineno-34-12"><span class="linenos" data-linenos="12 "></span></a>          {{form.as_p}}
<a id="__codelineno-34-13" name="__codelineno-34-13"></a><a href="#__codelineno-34-13"><span class="linenos" data-linenos="13 "></span></a>          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">class</span><span class="o">=</span><span class="s">"btn btn-primary btn-block"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Confirmar"</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-34-14" name="__codelineno-34-14"></a><a href="#__codelineno-34-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<a id="__codelineno-34-15" name="__codelineno-34-15"></a><a href="#__codelineno-34-15"><span class="linenos" data-linenos="15 "></span></a>      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-34-16" name="__codelineno-34-16"></a><a href="#__codelineno-34-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-34-17" name="__codelineno-34-17"></a><a href="#__codelineno-34-17"><span class="linenos" data-linenos="17 "></span></a>  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-34-18" name="__codelineno-34-18"></a><a href="#__codelineno-34-18"><span class="linenos" data-linenos="18 "></span></a><span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>
<a id="__codelineno-34-19" name="__codelineno-34-19"></a><a href="#__codelineno-34-19"><span class="linenos" data-linenos="19 "></span></a>{% endblock %}
</code></pre></div>
<p><code>&lt;app&gt;/templates/&lt;app&gt;/&lt;success_url&gt;</code> -&gt; Para poder ver si te ha ido bien podrías añadir</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><a href="#__codelineno-35-1"><span class="linenos" data-linenos="1 "></span></a>{% if 'register' in request.GET %}
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><a href="#__codelineno-35-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">style</span><span class="o">=</span><span class="s">"color:green;"</span><span class="p">&gt;</span>Usuario registrado correctamente, ya puedes loguearte.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a><a href="#__codelineno-35-3"><span class="linenos" data-linenos="3 "></span></a>{% endif %}
</code></pre></div>
<h3 id="customizar-el-registro">Customizar el registro<a class="headerlink" href="#customizar-el-registro" title="Permanent link">¶</a></h3>
<p>Para customizar el formulario de registro debes de trastearlo en tiempo de ejecución para no perder el que ya hay hecho.</p>
<p><code>&lt;app&gt;/views.py</code> -&gt; Tienes que sobreescribir el método <code>get_form()</code>, modificando sus campos, que son: <code>username</code>, <code>password1</code> y <code>password2</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><a href="#__codelineno-36-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a><a href="#__codelineno-36-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">CreateView</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><a href="#__codelineno-36-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse_lazy</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><a href="#__codelineno-36-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><a href="#__codelineno-36-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a><a href="#__codelineno-36-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a><a href="#__codelineno-36-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="c1"># Create your views here.</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a><a href="#__codelineno-36-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="k">class</span> <span class="nc">SignUpView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a><a href="#__codelineno-36-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">UserCreationForm</span>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a><a href="#__codelineno-36-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'registration/signup.html'</span>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a><a href="#__codelineno-36-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-36-12" name="__codelineno-36-12"></a><a href="#__codelineno-36-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="k">def</span> <span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-36-13" name="__codelineno-36-13"></a><a href="#__codelineno-36-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="k">return</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'login'</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'?register'</span>
<a id="__codelineno-36-14" name="__codelineno-36-14"></a><a href="#__codelineno-36-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-36-15" name="__codelineno-36-15"></a><a href="#__codelineno-36-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="k">def</span> <span class="nf">get_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-36-16" name="__codelineno-36-16"></a><a href="#__codelineno-36-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="n">form</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SignUpView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_form</span><span class="p">()</span>
<a id="__codelineno-36-17" name="__codelineno-36-17"></a><a href="#__codelineno-36-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="c1"># Customización en tiempo real</span>
<a id="__codelineno-36-18" name="__codelineno-36-18"></a><a href="#__codelineno-36-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span>
<a id="__codelineno-36-19" name="__codelineno-36-19"></a><a href="#__codelineno-36-19"><span class="linenos" data-linenos="19 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-36-20" name="__codelineno-36-20"></a><a href="#__codelineno-36-20"><span class="linenos" data-linenos="20 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Nombre de usuario'</span><span class="p">})</span>
<a id="__codelineno-36-21" name="__codelineno-36-21"></a><a href="#__codelineno-36-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'password1'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">(</span>
<a id="__codelineno-36-22" name="__codelineno-36-22"></a><a href="#__codelineno-36-22"><span class="linenos" data-linenos="22 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-36-23" name="__codelineno-36-23"></a><a href="#__codelineno-36-23"><span class="linenos" data-linenos="23 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Contraseña'</span><span class="p">})</span>
<a id="__codelineno-36-24" name="__codelineno-36-24"></a><a href="#__codelineno-36-24"><span class="linenos" data-linenos="24 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'password2'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">(</span>
<a id="__codelineno-36-25" name="__codelineno-36-25"></a><a href="#__codelineno-36-25"><span class="linenos" data-linenos="25 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-36-26" name="__codelineno-36-26"></a><a href="#__codelineno-36-26"><span class="linenos" data-linenos="26 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Repite la contraseña'</span><span class="p">})</span>
<a id="__codelineno-36-27" name="__codelineno-36-27"></a><a href="#__codelineno-36-27"><span class="linenos" data-linenos="27 "></span></a>        <span class="k">return</span> <span class="n">form</span>
</code></pre></div>
<p><code>&lt;app&gt;/templates/&lt;app&gt;/&lt;template_name&gt;</code> -&gt; Si quieres quitar todos los <code>labels</code>, lo puedes hacer desde el fichero anterior o simplemente en tu template pones</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><a href="#__codelineno-37-1"><span class="linenos" data-linenos="1 "></span></a><span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span><span class="nt">label</span><span class="p">{</span><span class="k">display</span><span class="p">:</span><span class="kc">none</span><span class="p">}&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</code></pre></div>
<h3 id="anadir-email-como-requisito">Añadir email como requisito<a class="headerlink" href="#anadir-email-como-requisito" title="Permanent link">¶</a></h3>
<p>Para que añadas un email al registro lo mejor es extender el formulario ya existente en Django.</p>
<p><code>&lt;app&gt;/forms.py</code> -&gt; Crea este fichero para extender el formulario. Añades el atributo <code>email</code>. En la clase <code>Meta</code> añades el atributo. con el método <code>clean_&lt;field&gt;</code> haces una validación, en este caso <code>clean_email</code> lo haces para que el <code>email</code> sea único para cada usuario (no puede haber dos usuarios con el mismo email) Si el email no existe, puede registrarse, sino, lanza un error de validación.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><a href="#__codelineno-38-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a><a href="#__codelineno-38-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><a href="#__codelineno-38-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a><a href="#__codelineno-38-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a><a href="#__codelineno-38-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">class</span> <span class="nc">UserCreationFormWithEmail</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="p">):</span>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a><a href="#__codelineno-38-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="n">email</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a><a href="#__codelineno-38-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-38-8" name="__codelineno-38-8"></a><a href="#__codelineno-38-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="n">help_text</span><span class="o">=</span><span class="s1">'Requerido, 254 caracteres como máximo y que sea válido'</span><span class="p">)</span>
<a id="__codelineno-38-9" name="__codelineno-38-9"></a><a href="#__codelineno-38-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-38-10" name="__codelineno-38-10"></a><a href="#__codelineno-38-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<a id="__codelineno-38-11" name="__codelineno-38-11"></a><a href="#__codelineno-38-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
<a id="__codelineno-38-12" name="__codelineno-38-12"></a><a href="#__codelineno-38-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'username'</span><span class="p">,</span> <span class="s1">'email'</span><span class="p">,</span> <span class="s1">'password1'</span><span class="p">,</span> <span class="s1">'password2'</span><span class="p">)</span>
<a id="__codelineno-38-13" name="__codelineno-38-13"></a><a href="#__codelineno-38-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-38-14" name="__codelineno-38-14"></a><a href="#__codelineno-38-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="k">def</span> <span class="nf">clean_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-38-15" name="__codelineno-38-15"></a><a href="#__codelineno-38-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="n">email</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">'email'</span><span class="p">]</span>
<a id="__codelineno-38-16" name="__codelineno-38-16"></a><a href="#__codelineno-38-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="k">if</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-38-17" name="__codelineno-38-17"></a><a href="#__codelineno-38-17"><span class="linenos" data-linenos="17 "></span></a>            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">'El email ya existe, usa otro.'</span><span class="p">)</span>
<a id="__codelineno-38-18" name="__codelineno-38-18"></a><a href="#__codelineno-38-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="k">return</span> <span class="n">email</span>
</code></pre></div>
<p><code>&lt;app&gt;/views.py</code> -&gt; Cambiar el formulario anterior por el nuevo extendido, así como las modificaciones de su campo.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><a href="#__codelineno-39-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">UserCreationFormWithEmail</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><a href="#__codelineno-39-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">CreateView</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a><a href="#__codelineno-39-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse_lazy</span>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a><a href="#__codelineno-39-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a><a href="#__codelineno-39-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-39-6" name="__codelineno-39-6"></a><a href="#__codelineno-39-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-39-7" name="__codelineno-39-7"></a><a href="#__codelineno-39-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="c1"># Create your views here.</span>
<a id="__codelineno-39-8" name="__codelineno-39-8"></a><a href="#__codelineno-39-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="k">class</span> <span class="nc">SignUpView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
<a id="__codelineno-39-9" name="__codelineno-39-9"></a><a href="#__codelineno-39-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">UserCreationFormWithEmail</span>
<a id="__codelineno-39-10" name="__codelineno-39-10"></a><a href="#__codelineno-39-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'registration/signup.html'</span>
<a id="__codelineno-39-11" name="__codelineno-39-11"></a><a href="#__codelineno-39-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-39-12" name="__codelineno-39-12"></a><a href="#__codelineno-39-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="k">def</span> <span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-39-13" name="__codelineno-39-13"></a><a href="#__codelineno-39-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="k">return</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'login'</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'?register'</span>
<a id="__codelineno-39-14" name="__codelineno-39-14"></a><a href="#__codelineno-39-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-39-15" name="__codelineno-39-15"></a><a href="#__codelineno-39-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="k">def</span> <span class="nf">get_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-39-16" name="__codelineno-39-16"></a><a href="#__codelineno-39-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="n">form</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SignUpView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_form</span><span class="p">()</span>
<a id="__codelineno-39-17" name="__codelineno-39-17"></a><a href="#__codelineno-39-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="c1"># Customización en tiempo real</span>
<a id="__codelineno-39-18" name="__codelineno-39-18"></a><a href="#__codelineno-39-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span>
<a id="__codelineno-39-19" name="__codelineno-39-19"></a><a href="#__codelineno-39-19"><span class="linenos" data-linenos="19 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-39-20" name="__codelineno-39-20"></a><a href="#__codelineno-39-20"><span class="linenos" data-linenos="20 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Nombre de usuario'</span><span class="p">})</span>
<a id="__codelineno-39-21" name="__codelineno-39-21"></a><a href="#__codelineno-39-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'email'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailInput</span><span class="p">(</span>
<a id="__codelineno-39-22" name="__codelineno-39-22"></a><a href="#__codelineno-39-22"><span class="linenos" data-linenos="22 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-39-23" name="__codelineno-39-23"></a><a href="#__codelineno-39-23"><span class="linenos" data-linenos="23 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Email'</span><span class="p">})</span>
<a id="__codelineno-39-24" name="__codelineno-39-24"></a><a href="#__codelineno-39-24"><span class="linenos" data-linenos="24 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'password1'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">(</span>
<a id="__codelineno-39-25" name="__codelineno-39-25"></a><a href="#__codelineno-39-25"><span class="linenos" data-linenos="25 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-39-26" name="__codelineno-39-26"></a><a href="#__codelineno-39-26"><span class="linenos" data-linenos="26 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Contraseña'</span><span class="p">})</span>
<a id="__codelineno-39-27" name="__codelineno-39-27"></a><a href="#__codelineno-39-27"><span class="linenos" data-linenos="27 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'password2'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">(</span>
<a id="__codelineno-39-28" name="__codelineno-39-28"></a><a href="#__codelineno-39-28"><span class="linenos" data-linenos="28 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-39-29" name="__codelineno-39-29"></a><a href="#__codelineno-39-29"><span class="linenos" data-linenos="29 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Repite la contraseña'</span><span class="p">})</span>
<a id="__codelineno-39-30" name="__codelineno-39-30"></a><a href="#__codelineno-39-30"><span class="linenos" data-linenos="30 "></span></a>        <span class="k">return</span> <span class="n">form</span>
</code></pre></div>
<h3 id="recuperar-contrasena">Recuperar contraseña<a class="headerlink" href="#recuperar-contrasena" title="Permanent link">¶</a></h3>
<p>Existen diferentes opciones, pero una típica es tener un servidor de correo SMTP que manda email con el link para el proceso de recuperación de contraseña. Aquí vas a hacer un truco para debug, que es tener un fichero local donde almacenas las credenciales.</p>
<p><code>&lt;proyecto&gt;/settings.py</code> -&gt; Añades lo siguiente al final. Con <code>EMAIL_BACKEND</code> le estas diciendo que use un backend de ficheros de prueba para el email. Con <code>EMAIL_FILE_PATH</code> le indicas donde guardar ese fichero.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><a href="#__codelineno-40-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># Email</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><a href="#__codelineno-40-2"><span class="linenos" data-linenos="2 "></span></a><span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><a href="#__codelineno-40-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="n">EMAIL_BACKEND</span> <span class="o">=</span> <span class="s2">"django.core.mail.backends.filebased.EmailBackend"</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><a href="#__codelineno-40-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="n">EMAIL_FILE_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">'sent_emails'</span><span class="p">)</span>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a><a href="#__codelineno-40-5"><span class="linenos" data-linenos="5 "></span></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-40-6" name="__codelineno-40-6"></a><a href="#__codelineno-40-6"><span class="linenos" data-linenos="6 "></span></a>    <span class="c1"># Configuración del servidor de correo SMTP real de producción</span>
<a id="__codelineno-40-7" name="__codelineno-40-7"></a><a href="#__codelineno-40-7"><span class="linenos" data-linenos="7 "></span></a>    <span class="k">pass</span>
</code></pre></div>
<p>Ahora te va a tocar sobreescribir los 4 templates que Django usa para recuperar la contraseña, ya que los que él ofrece son de forma admin, y tu quieres verlo como un usuario que ve el frontend. Los templates que debes crear son:</p>
<ul>
<li><code>password_reset_form.html</code> -&gt; Pedir nueva contraseña.</li>
<li><code>password_reset_done.html</code> -&gt; Email con instrucciones enviado.</li>
<li><code>password_reset_confirm.html</code> -&gt; Definir nueva contraseña.</li>
<li><code>password_reset_complete.html</code> -&gt; Contraseña cambiada.</li>
</ul>
<p>Por último, en el template login deberías de añadir la típica línea para si has olvidado la contraseña</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><a href="#__codelineno-41-1"><span class="linenos" data-linenos="1 "></span></a><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><a href="#__codelineno-41-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"{% url 'password_reset' %}"</span><span class="p">&gt;</span>He olvidado mi contraseña<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><a href="#__codelineno-41-3"><span class="linenos" data-linenos="3 "></span></a><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></div>
<p>Para ver todos los templates de Django para cuentas puedes verlo en</p>
<h2 id="perfil-de-usuario">Perfil de Usuario<a class="headerlink" href="#perfil-de-usuario" title="Permanent link">¶</a></h2>
<h3 id="crear-perfil">Crear perfil<a class="headerlink" href="#crear-perfil" title="Permanent link">¶</a></h3>
<p><code>&lt;app&gt;/models.py</code> -&gt; Creamos un modelo <code>Profile</code>, que tiene que tener una relación 1-1 con un usuario, una foto, biografía, web.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><a href="#__codelineno-42-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><a href="#__codelineno-42-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a><a href="#__codelineno-42-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a><a href="#__codelineno-42-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-42-5" name="__codelineno-42-5"></a><a href="#__codelineno-42-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="c1"># Create your models here.</span>
<a id="__codelineno-42-6" name="__codelineno-42-6"></a><a href="#__codelineno-42-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="k">class</span> <span class="nc">Profile</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-42-7" name="__codelineno-42-7"></a><a href="#__codelineno-42-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
<a id="__codelineno-42-8" name="__codelineno-42-8"></a><a href="#__codelineno-42-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">avatar</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s1">'profiles'</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-42-9" name="__codelineno-42-9"></a><a href="#__codelineno-42-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">bio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-42-10" name="__codelineno-42-10"></a><a href="#__codelineno-42-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">link</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p><code>settings.py</code> -&gt; Hay que despachar los ficheros media del avatar y no tocar la redirección del login.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><a href="#__codelineno-43-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># Auth redirects</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><a href="#__codelineno-43-2"><span class="linenos" data-linenos="2 "></span></a><span class="c1">#LOGIN_REDIRECT_URL = 'pages:pages'</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><a href="#__codelineno-43-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">LOGOUT_REDIRECT_URL</span> <span class="o">=</span> <span class="s1">'home'</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><a href="#__codelineno-43-4"><span class="linenos" data-linenos="4 "></span></a>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a><a href="#__codelineno-43-5"><span class="linenos" data-linenos="5 "></span></a>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a><a href="#__codelineno-43-6"><span class="linenos" data-linenos="6 "></span></a><span class="c1"># Media Files</span>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a><a href="#__codelineno-43-7"><span class="linenos" data-linenos="7 "></span></a><span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s1">'/media/'</span>
<a id="__codelineno-43-8" name="__codelineno-43-8"></a><a href="#__codelineno-43-8"><span class="linenos" data-linenos="8 "></span></a><span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">'media'</span><span class="p">)</span>
</code></pre></div>
<p><code>urls.py</code> -&gt; Añadir al <code>urlpatterns</code> del proyecto donde se despachan los ficheros media.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><a href="#__codelineno-44-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><a href="#__codelineno-44-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><a href="#__codelineno-44-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">pages.urls</span> <span class="kn">import</span> <span class="n">pages_patterns</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><a href="#__codelineno-44-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a><a href="#__codelineno-44-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-44-6" name="__codelineno-44-6"></a><a href="#__codelineno-44-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-44-7" name="__codelineno-44-7"></a><a href="#__codelineno-44-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-44-8" name="__codelineno-44-8"></a><a href="#__codelineno-44-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">'core.urls'</span><span class="p">)),</span>
<a id="__codelineno-44-9" name="__codelineno-44-9"></a><a href="#__codelineno-44-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'pages/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">pages_patterns</span><span class="p">)),</span>
<a id="__codelineno-44-10" name="__codelineno-44-10"></a><a href="#__codelineno-44-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
<a id="__codelineno-44-11" name="__codelineno-44-11"></a><a href="#__codelineno-44-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="c1"># Paths de Auth</span>
<a id="__codelineno-44-12" name="__codelineno-44-12"></a><a href="#__codelineno-44-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'accounts/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">'django.contrib.auth.urls'</span><span class="p">)),</span>
<a id="__codelineno-44-13" name="__codelineno-44-13"></a><a href="#__codelineno-44-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'accounts/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">'registration.urls'</span><span class="p">)),</span>
<a id="__codelineno-44-14" name="__codelineno-44-14"></a><a href="#__codelineno-44-14"><span class="linenos" data-linenos="14 "></span></a><span class="p">]</span>
<a id="__codelineno-44-15" name="__codelineno-44-15"></a><a href="#__codelineno-44-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-44-16" name="__codelineno-44-16"></a><a href="#__codelineno-44-16"><span class="linenos" data-linenos="16 "></span></a><span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
<a id="__codelineno-44-17" name="__codelineno-44-17"></a><a href="#__codelineno-44-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="kn">from</span> <span class="nn">django.conf.urls.static</span> <span class="kn">import</span> <span class="n">static</span>
<a id="__codelineno-44-18" name="__codelineno-44-18"></a><a href="#__codelineno-44-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">static</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_URL</span><span class="p">,</span> <span class="n">document_root</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_ROOT</span><span class="p">)</span>
</code></pre></div>
<p><code>&lt;app&gt;/views.py</code> -&gt; Crear su vista, con el decorador <code>login_required</code> para cuando estés logueado.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><a href="#__codelineno-45-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">UserCreationFormWithEmail</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a><a href="#__codelineno-45-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">CreateView</span>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a><a href="#__codelineno-45-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse_lazy</span>
<a id="__codelineno-45-4" name="__codelineno-45-4"></a><a href="#__codelineno-45-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<a id="__codelineno-45-5" name="__codelineno-45-5"></a><a href="#__codelineno-45-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.base</span> <span class="kn">import</span> <span class="n">TemplateView</span>
<a id="__codelineno-45-6" name="__codelineno-45-6"></a><a href="#__codelineno-45-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="kn">from</span> <span class="nn">django.utils.decorators</span> <span class="kn">import</span> <span class="n">method_decorator</span>
<a id="__codelineno-45-7" name="__codelineno-45-7"></a><a href="#__codelineno-45-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
<a id="__codelineno-45-8" name="__codelineno-45-8"></a><a href="#__codelineno-45-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-45-9" name="__codelineno-45-9"></a><a href="#__codelineno-45-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-45-10" name="__codelineno-45-10"></a><a href="#__codelineno-45-10"><span class="linenos" data-linenos="10 "></span></a><span class="c1"># Create your views here.</span>
<a id="__codelineno-45-11" name="__codelineno-45-11"></a><a href="#__codelineno-45-11"><span class="linenos" data-linenos="11 "></span></a><span class="k">class</span> <span class="nc">SignUpView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
<a id="__codelineno-45-12" name="__codelineno-45-12"></a><a href="#__codelineno-45-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">UserCreationFormWithEmail</span>
<a id="__codelineno-45-13" name="__codelineno-45-13"></a><a href="#__codelineno-45-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'registration/signup.html'</span>
<a id="__codelineno-45-14" name="__codelineno-45-14"></a><a href="#__codelineno-45-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-45-15" name="__codelineno-45-15"></a><a href="#__codelineno-45-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="k">def</span> <span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-45-16" name="__codelineno-45-16"></a><a href="#__codelineno-45-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="k">return</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'login'</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'?register'</span>
<a id="__codelineno-45-17" name="__codelineno-45-17"></a><a href="#__codelineno-45-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-45-18" name="__codelineno-45-18"></a><a href="#__codelineno-45-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="k">def</span> <span class="nf">get_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-45-19" name="__codelineno-45-19"></a><a href="#__codelineno-45-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="n">form</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SignUpView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_form</span><span class="p">()</span>
<a id="__codelineno-45-20" name="__codelineno-45-20"></a><a href="#__codelineno-45-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="c1"># Customización en tiempo real</span>
<a id="__codelineno-45-21" name="__codelineno-45-21"></a><a href="#__codelineno-45-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span>
<a id="__codelineno-45-22" name="__codelineno-45-22"></a><a href="#__codelineno-45-22"><span class="linenos" data-linenos="22 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-45-23" name="__codelineno-45-23"></a><a href="#__codelineno-45-23"><span class="linenos" data-linenos="23 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Nombre de usuario'</span><span class="p">})</span>
<a id="__codelineno-45-24" name="__codelineno-45-24"></a><a href="#__codelineno-45-24"><span class="linenos" data-linenos="24 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'email'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailInput</span><span class="p">(</span>
<a id="__codelineno-45-25" name="__codelineno-45-25"></a><a href="#__codelineno-45-25"><span class="linenos" data-linenos="25 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-45-26" name="__codelineno-45-26"></a><a href="#__codelineno-45-26"><span class="linenos" data-linenos="26 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Email'</span><span class="p">})</span>
<a id="__codelineno-45-27" name="__codelineno-45-27"></a><a href="#__codelineno-45-27"><span class="linenos" data-linenos="27 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'password1'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">(</span>
<a id="__codelineno-45-28" name="__codelineno-45-28"></a><a href="#__codelineno-45-28"><span class="linenos" data-linenos="28 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-45-29" name="__codelineno-45-29"></a><a href="#__codelineno-45-29"><span class="linenos" data-linenos="29 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Contraseña'</span><span class="p">})</span>
<a id="__codelineno-45-30" name="__codelineno-45-30"></a><a href="#__codelineno-45-30"><span class="linenos" data-linenos="30 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'password2'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">(</span>
<a id="__codelineno-45-31" name="__codelineno-45-31"></a><a href="#__codelineno-45-31"><span class="linenos" data-linenos="31 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-45-32" name="__codelineno-45-32"></a><a href="#__codelineno-45-32"><span class="linenos" data-linenos="32 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Repite la contraseña'</span><span class="p">})</span>
<a id="__codelineno-45-33" name="__codelineno-45-33"></a><a href="#__codelineno-45-33"><span class="linenos" data-linenos="33 "></span></a>        <span class="k">return</span> <span class="n">form</span>
<a id="__codelineno-45-34" name="__codelineno-45-34"></a><a href="#__codelineno-45-34"><span class="linenos" data-linenos="34 "></span></a>
<a id="__codelineno-45-35" name="__codelineno-45-35"></a><a href="#__codelineno-45-35"><span class="linenos" data-linenos="35 "></span></a>
<a id="__codelineno-45-36" name="__codelineno-45-36"></a><a href="#__codelineno-45-36"><span class="linenos" data-linenos="36 "></span></a><span class="nd">@method_decorator</span><span class="p">(</span><span class="n">login_required</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'dispatch'</span><span class="p">)</span>
<a id="__codelineno-45-37" name="__codelineno-45-37"></a><a href="#__codelineno-45-37"><span class="linenos" data-linenos="37 "></span></a><span class="k">class</span> <span class="nc">ProfileUpdate</span><span class="p">(</span><span class="n">TemplateView</span><span class="p">):</span>
<a id="__codelineno-45-38" name="__codelineno-45-38"></a><a href="#__codelineno-45-38"><span class="linenos" data-linenos="38 "></span></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'registration/profile_form.html'</span>
</code></pre></div>
<p><code>&lt;app&gt;/templates/&lt;app&gt;/&lt;template_name&gt;</code> -&gt; Crear su template.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><a href="#__codelineno-46-1"><span class="linenos" data-linenos=" 1 "></span></a>{% extends 'core/base.html' %}
<a id="__codelineno-46-2" name="__codelineno-46-2"></a><a href="#__codelineno-46-2"><span class="linenos" data-linenos=" 2 "></span></a>{% load static %}
<a id="__codelineno-46-3" name="__codelineno-46-3"></a><a href="#__codelineno-46-3"><span class="linenos" data-linenos=" 3 "></span></a>{% block title %}Perfil{% endblock %}
<a id="__codelineno-46-4" name="__codelineno-46-4"></a><a href="#__codelineno-46-4"><span class="linenos" data-linenos=" 4 "></span></a>{% block content %}
<a id="__codelineno-46-5" name="__codelineno-46-5"></a><a href="#__codelineno-46-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="p">&lt;</span><span class="nt">main</span> <span class="na">role</span><span class="o">=</span><span class="s">"main"</span><span class="p">&gt;</span>
<a id="__codelineno-46-6" name="__codelineno-46-6"></a><a href="#__codelineno-46-6"><span class="linenos" data-linenos=" 6 "></span></a>  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"container"</span><span class="p">&gt;</span>
<a id="__codelineno-46-7" name="__codelineno-46-7"></a><a href="#__codelineno-46-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"row mt-3 mb-5"</span><span class="p">&gt;</span>
<a id="__codelineno-46-8" name="__codelineno-46-8"></a><a href="#__codelineno-46-8"><span class="linenos" data-linenos=" 8 "></span></a>      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"col-md-9 mx-auto"</span><span class="p">&gt;</span>
<a id="__codelineno-46-9" name="__codelineno-46-9"></a><a href="#__codelineno-46-9"><span class="linenos" data-linenos=" 9 "></span></a>          <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Perfil<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<a id="__codelineno-46-10" name="__codelineno-46-10"></a><a href="#__codelineno-46-10"><span class="linenos" data-linenos="10 "></span></a>          <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">""</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span><span class="p">&gt;</span>{% csrf_token %}
<a id="__codelineno-46-11" name="__codelineno-46-11"></a><a href="#__codelineno-46-11"><span class="linenos" data-linenos="11 "></span></a>            {{ form.as_p }}
<a id="__codelineno-46-12" name="__codelineno-46-12"></a><a href="#__codelineno-46-12"><span class="linenos" data-linenos="12 "></span></a>            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"text-center"</span><span class="p">&gt;</span>
<a id="__codelineno-46-13" name="__codelineno-46-13"></a><a href="#__codelineno-46-13"><span class="linenos" data-linenos="13 "></span></a>              <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">class</span><span class="o">=</span><span class="s">"btn btn-primary btn-block"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Actualizar"</span> <span class="p">/&gt;</span>
<a id="__codelineno-46-14" name="__codelineno-46-14"></a><a href="#__codelineno-46-14"><span class="linenos" data-linenos="14 "></span></a>            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-46-15" name="__codelineno-46-15"></a><a href="#__codelineno-46-15"><span class="linenos" data-linenos="15 "></span></a>          <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<a id="__codelineno-46-16" name="__codelineno-46-16"></a><a href="#__codelineno-46-16"><span class="linenos" data-linenos="16 "></span></a>      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-46-17" name="__codelineno-46-17"></a><a href="#__codelineno-46-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-46-18" name="__codelineno-46-18"></a><a href="#__codelineno-46-18"><span class="linenos" data-linenos="18 "></span></a>  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-46-19" name="__codelineno-46-19"></a><a href="#__codelineno-46-19"><span class="linenos" data-linenos="19 "></span></a><span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>
<a id="__codelineno-46-20" name="__codelineno-46-20"></a><a href="#__codelineno-46-20"><span class="linenos" data-linenos="20 "></span></a>{% endblock %}
</code></pre></div>
<p><code>&lt;app&gt;/urls.py</code> -&gt; Redireccionarla en la urls.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><a href="#__codelineno-47-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a><a href="#__codelineno-47-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">SignUpView</span><span class="p">,</span> <span class="n">ProfileUpdate</span>
<a id="__codelineno-47-3" name="__codelineno-47-3"></a><a href="#__codelineno-47-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-47-4" name="__codelineno-47-4"></a><a href="#__codelineno-47-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-47-5" name="__codelineno-47-5"></a><a href="#__codelineno-47-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'signup/'</span><span class="p">,</span> <span class="n">SignUpView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'signup'</span><span class="p">),</span>
<a id="__codelineno-47-6" name="__codelineno-47-6"></a><a href="#__codelineno-47-6"><span class="linenos" data-linenos="6 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'profile/'</span><span class="p">,</span> <span class="n">ProfileUpdate</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'profile'</span><span class="p">),</span>
<a id="__codelineno-47-7" name="__codelineno-47-7"></a><a href="#__codelineno-47-7"><span class="linenos" data-linenos="7 "></span></a><span class="p">]</span>
</code></pre></div>
<p><code>core/templates/base.html</code> -&gt; Añadir un enlace.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><a href="#__codelineno-48-1"><span class="linenos" data-linenos="1 "></span></a><span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">"nav-item"</span><span class="p">&gt;</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a><a href="#__codelineno-48-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">"nav-link"</span> <span class="na">href</span><span class="o">=</span><span class="s">"{% url 'profile' %}"</span><span class="p">&gt;</span>Perfil<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a><a href="#__codelineno-48-3"><span class="linenos" data-linenos="3 "></span></a><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</code></pre></div>
<p>Por último hacemos las migraciones.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><a href="#__codelineno-49-1"><span class="linenos" data-linenos="1 "></span></a>python manage.py makemigrations &lt;app&gt;
<a id="__codelineno-49-2" name="__codelineno-49-2"></a><a href="#__codelineno-49-2"><span class="linenos" data-linenos="2 "></span></a>python manage.py migrate &lt;app&gt;
</code></pre></div>
<h3 id="perfil-editable">Perfil editable<a class="headerlink" href="#perfil-editable" title="Permanent link">¶</a></h3>
<p><code>&lt;app&gt;views.py</code> -&gt; Tienes que hacer que la vista herede de <code>UpdateView</code> (poniéndole su modelo y que campos son editables). Para que no de error a la hora de editar, se debe sobreescribir el método <code>get_object</code>, donde hay que obtener el usuario de la propia <code>request</code> para poder usarlo en la vista. Al obtener el usuario, si este no existe, la queryset puede petar, así que por eso hay que usar <code>get_or_create</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><a href="#__codelineno-50-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">UserCreationFormWithEmail</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a><a href="#__codelineno-50-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">CreateView</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a><a href="#__codelineno-50-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse_lazy</span>
<a id="__codelineno-50-4" name="__codelineno-50-4"></a><a href="#__codelineno-50-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<a id="__codelineno-50-5" name="__codelineno-50-5"></a><a href="#__codelineno-50-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">from</span> <span class="nn">django.utils.decorators</span> <span class="kn">import</span> <span class="n">method_decorator</span>
<a id="__codelineno-50-6" name="__codelineno-50-6"></a><a href="#__codelineno-50-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
<a id="__codelineno-50-7" name="__codelineno-50-7"></a><a href="#__codelineno-50-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.edit</span> <span class="kn">import</span> <span class="n">UpdateView</span>
<a id="__codelineno-50-8" name="__codelineno-50-8"></a><a href="#__codelineno-50-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Profile</span>
<a id="__codelineno-50-9" name="__codelineno-50-9"></a><a href="#__codelineno-50-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-50-10" name="__codelineno-50-10"></a><a href="#__codelineno-50-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-50-11" name="__codelineno-50-11"></a><a href="#__codelineno-50-11"><span class="linenos" data-linenos="11 "></span></a><span class="c1"># Create your views here.</span>
<a id="__codelineno-50-12" name="__codelineno-50-12"></a><a href="#__codelineno-50-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">class</span> <span class="nc">SignUpView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
<a id="__codelineno-50-13" name="__codelineno-50-13"></a><a href="#__codelineno-50-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">UserCreationFormWithEmail</span>
<a id="__codelineno-50-14" name="__codelineno-50-14"></a><a href="#__codelineno-50-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'registration/signup.html'</span>
<a id="__codelineno-50-15" name="__codelineno-50-15"></a><a href="#__codelineno-50-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-50-16" name="__codelineno-50-16"></a><a href="#__codelineno-50-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="k">def</span> <span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-50-17" name="__codelineno-50-17"></a><a href="#__codelineno-50-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="k">return</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'login'</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'?register'</span>
<a id="__codelineno-50-18" name="__codelineno-50-18"></a><a href="#__codelineno-50-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-50-19" name="__codelineno-50-19"></a><a href="#__codelineno-50-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="k">def</span> <span class="nf">get_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-50-20" name="__codelineno-50-20"></a><a href="#__codelineno-50-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="n">form</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SignUpView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_form</span><span class="p">()</span>
<a id="__codelineno-50-21" name="__codelineno-50-21"></a><a href="#__codelineno-50-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="c1"># Customización en tiempo real</span>
<a id="__codelineno-50-22" name="__codelineno-50-22"></a><a href="#__codelineno-50-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span>
<a id="__codelineno-50-23" name="__codelineno-50-23"></a><a href="#__codelineno-50-23"><span class="linenos" data-linenos="23 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-50-24" name="__codelineno-50-24"></a><a href="#__codelineno-50-24"><span class="linenos" data-linenos="24 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Nombre de usuario'</span><span class="p">})</span>
<a id="__codelineno-50-25" name="__codelineno-50-25"></a><a href="#__codelineno-50-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'email'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailInput</span><span class="p">(</span>
<a id="__codelineno-50-26" name="__codelineno-50-26"></a><a href="#__codelineno-50-26"><span class="linenos" data-linenos="26 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-50-27" name="__codelineno-50-27"></a><a href="#__codelineno-50-27"><span class="linenos" data-linenos="27 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Email'</span><span class="p">})</span>
<a id="__codelineno-50-28" name="__codelineno-50-28"></a><a href="#__codelineno-50-28"><span class="linenos" data-linenos="28 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'password1'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">(</span>
<a id="__codelineno-50-29" name="__codelineno-50-29"></a><a href="#__codelineno-50-29"><span class="linenos" data-linenos="29 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-50-30" name="__codelineno-50-30"></a><a href="#__codelineno-50-30"><span class="linenos" data-linenos="30 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Contraseña'</span><span class="p">})</span>
<a id="__codelineno-50-31" name="__codelineno-50-31"></a><a href="#__codelineno-50-31"><span class="linenos" data-linenos="31 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'password2'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">(</span>
<a id="__codelineno-50-32" name="__codelineno-50-32"></a><a href="#__codelineno-50-32"><span class="linenos" data-linenos="32 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-50-33" name="__codelineno-50-33"></a><a href="#__codelineno-50-33"><span class="linenos" data-linenos="33 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Repite la contraseña'</span><span class="p">})</span>
<a id="__codelineno-50-34" name="__codelineno-50-34"></a><a href="#__codelineno-50-34"><span class="linenos" data-linenos="34 "></span></a>        <span class="k">return</span> <span class="n">form</span>
<a id="__codelineno-50-35" name="__codelineno-50-35"></a><a href="#__codelineno-50-35"><span class="linenos" data-linenos="35 "></span></a>
<a id="__codelineno-50-36" name="__codelineno-50-36"></a><a href="#__codelineno-50-36"><span class="linenos" data-linenos="36 "></span></a>
<a id="__codelineno-50-37" name="__codelineno-50-37"></a><a href="#__codelineno-50-37"><span class="linenos" data-linenos="37 "></span></a><span class="nd">@method_decorator</span><span class="p">(</span><span class="n">login_required</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'dispatch'</span><span class="p">)</span>
<a id="__codelineno-50-38" name="__codelineno-50-38"></a><a href="#__codelineno-50-38"><span class="linenos" data-linenos="38 "></span></a><span class="k">class</span> <span class="nc">ProfileUpdate</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>
<a id="__codelineno-50-39" name="__codelineno-50-39"></a><a href="#__codelineno-50-39"><span class="linenos" data-linenos="39 "></span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Profile</span>
<a id="__codelineno-50-40" name="__codelineno-50-40"></a><a href="#__codelineno-50-40"><span class="linenos" data-linenos="40 "></span></a>    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'avatar'</span><span class="p">,</span> <span class="s1">'bio'</span><span class="p">,</span> <span class="s1">'link'</span><span class="p">]</span>
<a id="__codelineno-50-41" name="__codelineno-50-41"></a><a href="#__codelineno-50-41"><span class="linenos" data-linenos="41 "></span></a>    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'profile'</span><span class="p">)</span>
<a id="__codelineno-50-42" name="__codelineno-50-42"></a><a href="#__codelineno-50-42"><span class="linenos" data-linenos="42 "></span></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'registration/profile_form.html'</span>
<a id="__codelineno-50-43" name="__codelineno-50-43"></a><a href="#__codelineno-50-43"><span class="linenos" data-linenos="43 "></span></a>
<a id="__codelineno-50-44" name="__codelineno-50-44"></a><a href="#__codelineno-50-44"><span class="linenos" data-linenos="44 "></span></a>    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-50-45" name="__codelineno-50-45"></a><a href="#__codelineno-50-45"><span class="linenos" data-linenos="45 "></span></a>        <span class="c1"># Obtener (o crear si no existe) el objeto a editar</span>
<a id="__codelineno-50-46" name="__codelineno-50-46"></a><a href="#__codelineno-50-46"><span class="linenos" data-linenos="46 "></span></a>        <span class="n">profile</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">Profile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
<a id="__codelineno-50-47" name="__codelineno-50-47"></a><a href="#__codelineno-50-47"><span class="linenos" data-linenos="47 "></span></a>        <span class="k">return</span> <span class="n">profile</span>
</code></pre></div>
<p>En el template, para poder ver el url de la imagen del avatar tienes que usar esto en el formulario</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><a href="#__codelineno-51-1"><span class="linenos" data-linenos="1 "></span></a> <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">""</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span> <span class="na">enctype</span><span class="o">=</span><span class="s">"multipart/form-data"</span><span class="p">&gt;</span>{% csrf_token %}
</code></pre></div>
<h3 id="customizando-formulario-de-perfil">Customizando formulario de Perfil<a class="headerlink" href="#customizando-formulario-de-perfil" title="Permanent link">¶</a></h3>
<p><code>&lt;app&gt;/forms.py</code> -&gt; Debes de importar el modelo. Crear un formulario que herede de <code>forms.ModelForm</code>. Dentro crear su clase <code>Meta</code> con el modelo, los campos y sus widgets para modificarlos.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><a href="#__codelineno-52-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a><a href="#__codelineno-52-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span>
<a id="__codelineno-52-3" name="__codelineno-52-3"></a><a href="#__codelineno-52-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<a id="__codelineno-52-4" name="__codelineno-52-4"></a><a href="#__codelineno-52-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Profile</span>
<a id="__codelineno-52-5" name="__codelineno-52-5"></a><a href="#__codelineno-52-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-52-6" name="__codelineno-52-6"></a><a href="#__codelineno-52-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-52-7" name="__codelineno-52-7"></a><a href="#__codelineno-52-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">class</span> <span class="nc">UserCreationFormWithEmail</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="p">):</span>
<a id="__codelineno-52-8" name="__codelineno-52-8"></a><a href="#__codelineno-52-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">email</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span>
<a id="__codelineno-52-9" name="__codelineno-52-9"></a><a href="#__codelineno-52-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-52-10" name="__codelineno-52-10"></a><a href="#__codelineno-52-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="n">help_text</span><span class="o">=</span><span class="s1">'Requerido, 254 caracteres como máximo y que sea válido'</span><span class="p">)</span>
<a id="__codelineno-52-11" name="__codelineno-52-11"></a><a href="#__codelineno-52-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-52-12" name="__codelineno-52-12"></a><a href="#__codelineno-52-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<a id="__codelineno-52-13" name="__codelineno-52-13"></a><a href="#__codelineno-52-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
<a id="__codelineno-52-14" name="__codelineno-52-14"></a><a href="#__codelineno-52-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'username'</span><span class="p">,</span> <span class="s1">'email'</span><span class="p">,</span> <span class="s1">'password1'</span><span class="p">,</span> <span class="s1">'password2'</span><span class="p">)</span>
<a id="__codelineno-52-15" name="__codelineno-52-15"></a><a href="#__codelineno-52-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-52-16" name="__codelineno-52-16"></a><a href="#__codelineno-52-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="k">def</span> <span class="nf">clean_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-52-17" name="__codelineno-52-17"></a><a href="#__codelineno-52-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="n">email</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">'email'</span><span class="p">]</span>
<a id="__codelineno-52-18" name="__codelineno-52-18"></a><a href="#__codelineno-52-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="k">if</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-52-19" name="__codelineno-52-19"></a><a href="#__codelineno-52-19"><span class="linenos" data-linenos="19 "></span></a>            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">'El email ya existe, usa otro.'</span><span class="p">)</span>
<a id="__codelineno-52-20" name="__codelineno-52-20"></a><a href="#__codelineno-52-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="k">return</span> <span class="n">email</span>
<a id="__codelineno-52-21" name="__codelineno-52-21"></a><a href="#__codelineno-52-21"><span class="linenos" data-linenos="21 "></span></a>
<a id="__codelineno-52-22" name="__codelineno-52-22"></a><a href="#__codelineno-52-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-52-23" name="__codelineno-52-23"></a><a href="#__codelineno-52-23"><span class="linenos" data-linenos="23 "></span></a><span class="k">class</span> <span class="nc">ProfileForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
<a id="__codelineno-52-24" name="__codelineno-52-24"></a><a href="#__codelineno-52-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<a id="__codelineno-52-25" name="__codelineno-52-25"></a><a href="#__codelineno-52-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">Profile</span>
<a id="__codelineno-52-26" name="__codelineno-52-26"></a><a href="#__codelineno-52-26"><span class="linenos" data-linenos="26 "></span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'avatar'</span><span class="p">,</span> <span class="s1">'bio'</span><span class="p">,</span> <span class="s1">'link'</span><span class="p">]</span>
<a id="__codelineno-52-27" name="__codelineno-52-27"></a><a href="#__codelineno-52-27"><span class="linenos" data-linenos="27 "></span></a>        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-52-28" name="__codelineno-52-28"></a><a href="#__codelineno-52-28"><span class="linenos" data-linenos="28 "></span></a>            <span class="s1">'avatar'</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">ClearableFileInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-52-29" name="__codelineno-52-29"></a><a href="#__codelineno-52-29"><span class="linenos" data-linenos="29 "></span></a>                <span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control-file mt-3'</span>
<a id="__codelineno-52-30" name="__codelineno-52-30"></a><a href="#__codelineno-52-30"><span class="linenos" data-linenos="30 "></span></a>            <span class="p">}),</span>
<a id="__codelineno-52-31" name="__codelineno-52-31"></a><a href="#__codelineno-52-31"><span class="linenos" data-linenos="31 "></span></a>            <span class="s1">'bio'</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Textarea</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-52-32" name="__codelineno-52-32"></a><a href="#__codelineno-52-32"><span class="linenos" data-linenos="32 "></span></a>                <span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mt-3'</span><span class="p">,</span>
<a id="__codelineno-52-33" name="__codelineno-52-33"></a><a href="#__codelineno-52-33"><span class="linenos" data-linenos="33 "></span></a>                <span class="s1">'rows'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-52-34" name="__codelineno-52-34"></a><a href="#__codelineno-52-34"><span class="linenos" data-linenos="34 "></span></a>                <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Biografia'</span>
<a id="__codelineno-52-35" name="__codelineno-52-35"></a><a href="#__codelineno-52-35"><span class="linenos" data-linenos="35 "></span></a>            <span class="p">}),</span>
<a id="__codelineno-52-36" name="__codelineno-52-36"></a><a href="#__codelineno-52-36"><span class="linenos" data-linenos="36 "></span></a>            <span class="s1">'link'</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">URLInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-52-37" name="__codelineno-52-37"></a><a href="#__codelineno-52-37"><span class="linenos" data-linenos="37 "></span></a>                <span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mt-3'</span><span class="p">,</span>
<a id="__codelineno-52-38" name="__codelineno-52-38"></a><a href="#__codelineno-52-38"><span class="linenos" data-linenos="38 "></span></a>                <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Enlace'</span>
<a id="__codelineno-52-39" name="__codelineno-52-39"></a><a href="#__codelineno-52-39"><span class="linenos" data-linenos="39 "></span></a>            <span class="p">}),</span>
<a id="__codelineno-52-40" name="__codelineno-52-40"></a><a href="#__codelineno-52-40"><span class="linenos" data-linenos="40 "></span></a>        <span class="p">}</span>
</code></pre></div>
<p><code>&lt;app&gt;/views.py</code> -&gt; Importa el formulario nuevo y cambia el atributo <code>model</code> por el de <code>form_class</code>, poniendole el formulario. El campo <code>fields</code> ya no es necesario pues está en el formulario.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><a href="#__codelineno-53-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">UserCreationFormWithEmail</span><span class="p">,</span> <span class="n">ProfileForm</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a><a href="#__codelineno-53-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-53-3" name="__codelineno-53-3"></a><a href="#__codelineno-53-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="c1"># ...</span>
<a id="__codelineno-53-4" name="__codelineno-53-4"></a><a href="#__codelineno-53-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-53-5" name="__codelineno-53-5"></a><a href="#__codelineno-53-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="nd">@method_decorator</span><span class="p">(</span><span class="n">login_required</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'dispatch'</span><span class="p">)</span>
<a id="__codelineno-53-6" name="__codelineno-53-6"></a><a href="#__codelineno-53-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="k">class</span> <span class="nc">ProfileUpdate</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>
<a id="__codelineno-53-7" name="__codelineno-53-7"></a><a href="#__codelineno-53-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">ProfileForm</span>
<a id="__codelineno-53-8" name="__codelineno-53-8"></a><a href="#__codelineno-53-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'profile'</span><span class="p">)</span>
<a id="__codelineno-53-9" name="__codelineno-53-9"></a><a href="#__codelineno-53-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'registration/profile_form.html'</span>
<a id="__codelineno-53-10" name="__codelineno-53-10"></a><a href="#__codelineno-53-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-53-11" name="__codelineno-53-11"></a><a href="#__codelineno-53-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-53-12" name="__codelineno-53-12"></a><a href="#__codelineno-53-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="c1"># Obtener (o crear si no existe) el objeto a editar</span>
<a id="__codelineno-53-13" name="__codelineno-53-13"></a><a href="#__codelineno-53-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="n">profile</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">Profile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
<a id="__codelineno-53-14" name="__codelineno-53-14"></a><a href="#__codelineno-53-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="k">return</span> <span class="n">profile</span>
</code></pre></div>
<p><code>&lt;app&gt;/templates/&lt;app&gt;/&lt;template_name&gt;</code> -&gt; Modifica el formulario a pelo a tu gusto. En este ejemplo se ha puesto una imagen por defecto <code>no-avatar.jpg</code> en <code>&lt;app&gt;/static/&lt;app&gt;/img/no-avatar.jpg</code> para cuando el usuario no tenga, o borre la imagen, aparezca esta.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><a href="#__codelineno-54-1"><span class="linenos" data-linenos=" 1 "></span></a>{% extends 'core/base.html' %}
<a id="__codelineno-54-2" name="__codelineno-54-2"></a><a href="#__codelineno-54-2"><span class="linenos" data-linenos=" 2 "></span></a>{% load static %}
<a id="__codelineno-54-3" name="__codelineno-54-3"></a><a href="#__codelineno-54-3"><span class="linenos" data-linenos=" 3 "></span></a>{% block title %}Perfil{% endblock %}
<a id="__codelineno-54-4" name="__codelineno-54-4"></a><a href="#__codelineno-54-4"><span class="linenos" data-linenos=" 4 "></span></a>{% block content %}
<a id="__codelineno-54-5" name="__codelineno-54-5"></a><a href="#__codelineno-54-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;.</span><span class="nc">errorlist</span><span class="p">{</span><span class="k">color</span><span class="p">:</span><span class="kc">red</span><span class="p">;}</span><span class="w"> </span><span class="nt">label</span><span class="p">{</span><span class="k">display</span><span class="p">:</span><span class="kc">none</span><span class="p">}&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<a id="__codelineno-54-6" name="__codelineno-54-6"></a><a href="#__codelineno-54-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="p">&lt;</span><span class="nt">main</span> <span class="na">role</span><span class="o">=</span><span class="s">"main"</span><span class="p">&gt;</span>
<a id="__codelineno-54-7" name="__codelineno-54-7"></a><a href="#__codelineno-54-7"><span class="linenos" data-linenos=" 7 "></span></a>  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"container"</span><span class="p">&gt;</span>
<a id="__codelineno-54-8" name="__codelineno-54-8"></a><a href="#__codelineno-54-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"row mt-3"</span><span class="p">&gt;</span>
<a id="__codelineno-54-9" name="__codelineno-54-9"></a><a href="#__codelineno-54-9"><span class="linenos" data-linenos=" 9 "></span></a>      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"col-md-9 mx-auto mb-5"</span><span class="p">&gt;</span>
<a id="__codelineno-54-10" name="__codelineno-54-10"></a><a href="#__codelineno-54-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">""</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span> <span class="na">enctype</span><span class="o">=</span><span class="s">"multipart/form-data"</span><span class="p">&gt;</span>{% csrf_token %}
<a id="__codelineno-54-11" name="__codelineno-54-11"></a><a href="#__codelineno-54-11"><span class="linenos" data-linenos="11 "></span></a>          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"row"</span><span class="p">&gt;</span>
<a id="__codelineno-54-12" name="__codelineno-54-12"></a><a href="#__codelineno-54-12"><span class="linenos" data-linenos="12 "></span></a>            <span class="cm">&lt;!-- Previa del avatar --&gt;</span>
<a id="__codelineno-54-13" name="__codelineno-54-13"></a><a href="#__codelineno-54-13"><span class="linenos" data-linenos="13 "></span></a>            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"col-md-2"</span><span class="p">&gt;</span>
<a id="__codelineno-54-14" name="__codelineno-54-14"></a><a href="#__codelineno-54-14"><span class="linenos" data-linenos="14 "></span></a>              {% if request.user.profile.avatar %}
<a id="__codelineno-54-15" name="__codelineno-54-15"></a><a href="#__codelineno-54-15"><span class="linenos" data-linenos="15 "></span></a>                <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"{{request.user.profile.avatar.url}}"</span> <span class="na">class</span><span class="o">=</span><span class="s">"img-fluid"</span><span class="p">&gt;</span>
<a id="__codelineno-54-16" name="__codelineno-54-16"></a><a href="#__codelineno-54-16"><span class="linenos" data-linenos="16 "></span></a>                <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">"mt-1"</span><span class="p">&gt;</span>¿Borrar? <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"checkbox"</span> <span class="na">id</span><span class="o">=</span><span class="s">"avatar-clear"</span> <span class="na">name</span><span class="o">=</span><span class="s">"avatar-clear"</span> <span class="p">/&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-54-17" name="__codelineno-54-17"></a><a href="#__codelineno-54-17"><span class="linenos" data-linenos="17 "></span></a>              {% else %}
<a id="__codelineno-54-18" name="__codelineno-54-18"></a><a href="#__codelineno-54-18"><span class="linenos" data-linenos="18 "></span></a>              <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"{% static 'registration/img/no-avatar.jpg' %}"</span> <span class="na">class</span><span class="o">=</span><span class="s">"img-fluid"</span><span class="p">&gt;</span>
<a id="__codelineno-54-19" name="__codelineno-54-19"></a><a href="#__codelineno-54-19"><span class="linenos" data-linenos="19 "></span></a>              {% endif %}
<a id="__codelineno-54-20" name="__codelineno-54-20"></a><a href="#__codelineno-54-20"><span class="linenos" data-linenos="20 "></span></a>            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-54-21" name="__codelineno-54-21"></a><a href="#__codelineno-54-21"><span class="linenos" data-linenos="21 "></span></a>            <span class="cm">&lt;!-- Formulario --&gt;</span>
<a id="__codelineno-54-22" name="__codelineno-54-22"></a><a href="#__codelineno-54-22"><span class="linenos" data-linenos="22 "></span></a>            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"col-md-10"</span><span class="p">&gt;</span>
<a id="__codelineno-54-23" name="__codelineno-54-23"></a><a href="#__codelineno-54-23"><span class="linenos" data-linenos="23 "></span></a>              <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Perfil<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<a id="__codelineno-54-24" name="__codelineno-54-24"></a><a href="#__codelineno-54-24"><span class="linenos" data-linenos="24 "></span></a>              <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"file"</span> <span class="na">name</span><span class="o">=</span><span class="s">"avatar"</span> <span class="na">class</span><span class="o">=</span><span class="s">"form-control-file mt-3"</span> <span class="na">id</span><span class="o">=</span><span class="s">"id_avatar"</span><span class="p">&gt;</span>
<a id="__codelineno-54-25" name="__codelineno-54-25"></a><a href="#__codelineno-54-25"><span class="linenos" data-linenos="25 "></span></a>              {{ form.bio }}
<a id="__codelineno-54-26" name="__codelineno-54-26"></a><a href="#__codelineno-54-26"><span class="linenos" data-linenos="26 "></span></a>              {{ form.link }}
<a id="__codelineno-54-27" name="__codelineno-54-27"></a><a href="#__codelineno-54-27"><span class="linenos" data-linenos="27 "></span></a>              <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">class</span><span class="o">=</span><span class="s">"btn btn-primary btn-block mt-3"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Actualizar"</span><span class="p">&gt;</span>
<a id="__codelineno-54-28" name="__codelineno-54-28"></a><a href="#__codelineno-54-28"><span class="linenos" data-linenos="28 "></span></a>            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-54-29" name="__codelineno-54-29"></a><a href="#__codelineno-54-29"><span class="linenos" data-linenos="29 "></span></a>          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-54-30" name="__codelineno-54-30"></a><a href="#__codelineno-54-30"><span class="linenos" data-linenos="30 "></span></a>        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<a id="__codelineno-54-31" name="__codelineno-54-31"></a><a href="#__codelineno-54-31"><span class="linenos" data-linenos="31 "></span></a>      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-54-32" name="__codelineno-54-32"></a><a href="#__codelineno-54-32"><span class="linenos" data-linenos="32 "></span></a>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-54-33" name="__codelineno-54-33"></a><a href="#__codelineno-54-33"><span class="linenos" data-linenos="33 "></span></a>  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-54-34" name="__codelineno-54-34"></a><a href="#__codelineno-54-34"><span class="linenos" data-linenos="34 "></span></a><span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>
<a id="__codelineno-54-35" name="__codelineno-54-35"></a><a href="#__codelineno-54-35"><span class="linenos" data-linenos="35 "></span></a>{% endblock %}
</code></pre></div>
<h3 id="email-editable">Email editable<a class="headerlink" href="#email-editable" title="Permanent link">¶</a></h3>
<p>Como es solo un campo, y para no tener que destrozar los modelos de formularios y vistas que ya estamos usando, lo mejor es que hagas un formulario solo para este campo.</p>
<p><code>&lt;app&gt;/templates/&lt;app&gt;/&lt;template_perfil&gt;</code> -&gt; Añades un enlace para editar el email.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><a href="#__codelineno-55-1"><span class="linenos" data-linenos="1 "></span></a>
</code></pre></div>
<p><code>&lt;app&gt;/forms.py</code> -&gt; Creas el nuevo formulario <code>EmailForm</code> basándote en uno anterior. Ahora lo que vas a recuperar es un objeto que ya existe y que debe permitir cambiarlo si no existe el nuevo valor.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><a href="#__codelineno-56-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<a id="__codelineno-56-2" name="__codelineno-56-2"></a><a href="#__codelineno-56-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span>
<a id="__codelineno-56-3" name="__codelineno-56-3"></a><a href="#__codelineno-56-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<a id="__codelineno-56-4" name="__codelineno-56-4"></a><a href="#__codelineno-56-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Profile</span>
<a id="__codelineno-56-5" name="__codelineno-56-5"></a><a href="#__codelineno-56-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-56-6" name="__codelineno-56-6"></a><a href="#__codelineno-56-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-56-7" name="__codelineno-56-7"></a><a href="#__codelineno-56-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">class</span> <span class="nc">UserCreationFormWithEmail</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="p">):</span>
<a id="__codelineno-56-8" name="__codelineno-56-8"></a><a href="#__codelineno-56-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">email</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span>
<a id="__codelineno-56-9" name="__codelineno-56-9"></a><a href="#__codelineno-56-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-56-10" name="__codelineno-56-10"></a><a href="#__codelineno-56-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="n">help_text</span><span class="o">=</span><span class="s1">'Requerido, 254 caracteres como máximo y que sea válido'</span><span class="p">)</span>
<a id="__codelineno-56-11" name="__codelineno-56-11"></a><a href="#__codelineno-56-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-56-12" name="__codelineno-56-12"></a><a href="#__codelineno-56-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<a id="__codelineno-56-13" name="__codelineno-56-13"></a><a href="#__codelineno-56-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
<a id="__codelineno-56-14" name="__codelineno-56-14"></a><a href="#__codelineno-56-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'username'</span><span class="p">,</span> <span class="s1">'email'</span><span class="p">,</span> <span class="s1">'password1'</span><span class="p">,</span> <span class="s1">'password2'</span><span class="p">)</span>
<a id="__codelineno-56-15" name="__codelineno-56-15"></a><a href="#__codelineno-56-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-56-16" name="__codelineno-56-16"></a><a href="#__codelineno-56-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="k">def</span> <span class="nf">clean_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-56-17" name="__codelineno-56-17"></a><a href="#__codelineno-56-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="n">email</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">'email'</span><span class="p">]</span>
<a id="__codelineno-56-18" name="__codelineno-56-18"></a><a href="#__codelineno-56-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="k">if</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-56-19" name="__codelineno-56-19"></a><a href="#__codelineno-56-19"><span class="linenos" data-linenos="19 "></span></a>            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">'El email ya existe, usa otro.'</span><span class="p">)</span>
<a id="__codelineno-56-20" name="__codelineno-56-20"></a><a href="#__codelineno-56-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="k">return</span> <span class="n">email</span>
<a id="__codelineno-56-21" name="__codelineno-56-21"></a><a href="#__codelineno-56-21"><span class="linenos" data-linenos="21 "></span></a>
<a id="__codelineno-56-22" name="__codelineno-56-22"></a><a href="#__codelineno-56-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-56-23" name="__codelineno-56-23"></a><a href="#__codelineno-56-23"><span class="linenos" data-linenos="23 "></span></a><span class="k">class</span> <span class="nc">ProfileForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
<a id="__codelineno-56-24" name="__codelineno-56-24"></a><a href="#__codelineno-56-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<a id="__codelineno-56-25" name="__codelineno-56-25"></a><a href="#__codelineno-56-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">Profile</span>
<a id="__codelineno-56-26" name="__codelineno-56-26"></a><a href="#__codelineno-56-26"><span class="linenos" data-linenos="26 "></span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'avatar'</span><span class="p">,</span> <span class="s1">'bio'</span><span class="p">,</span> <span class="s1">'link'</span><span class="p">]</span>
<a id="__codelineno-56-27" name="__codelineno-56-27"></a><a href="#__codelineno-56-27"><span class="linenos" data-linenos="27 "></span></a>        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-56-28" name="__codelineno-56-28"></a><a href="#__codelineno-56-28"><span class="linenos" data-linenos="28 "></span></a>            <span class="s1">'avatar'</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">ClearableFileInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-56-29" name="__codelineno-56-29"></a><a href="#__codelineno-56-29"><span class="linenos" data-linenos="29 "></span></a>                <span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control-file mt-3'</span>
<a id="__codelineno-56-30" name="__codelineno-56-30"></a><a href="#__codelineno-56-30"><span class="linenos" data-linenos="30 "></span></a>            <span class="p">}),</span>
<a id="__codelineno-56-31" name="__codelineno-56-31"></a><a href="#__codelineno-56-31"><span class="linenos" data-linenos="31 "></span></a>            <span class="s1">'bio'</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Textarea</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-56-32" name="__codelineno-56-32"></a><a href="#__codelineno-56-32"><span class="linenos" data-linenos="32 "></span></a>                <span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mt-3'</span><span class="p">,</span>
<a id="__codelineno-56-33" name="__codelineno-56-33"></a><a href="#__codelineno-56-33"><span class="linenos" data-linenos="33 "></span></a>                <span class="s1">'rows'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-56-34" name="__codelineno-56-34"></a><a href="#__codelineno-56-34"><span class="linenos" data-linenos="34 "></span></a>                <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Biografia'</span>
<a id="__codelineno-56-35" name="__codelineno-56-35"></a><a href="#__codelineno-56-35"><span class="linenos" data-linenos="35 "></span></a>            <span class="p">}),</span>
<a id="__codelineno-56-36" name="__codelineno-56-36"></a><a href="#__codelineno-56-36"><span class="linenos" data-linenos="36 "></span></a>            <span class="s1">'link'</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">URLInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-56-37" name="__codelineno-56-37"></a><a href="#__codelineno-56-37"><span class="linenos" data-linenos="37 "></span></a>                <span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mt-3'</span><span class="p">,</span>
<a id="__codelineno-56-38" name="__codelineno-56-38"></a><a href="#__codelineno-56-38"><span class="linenos" data-linenos="38 "></span></a>                <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Enlace'</span>
<a id="__codelineno-56-39" name="__codelineno-56-39"></a><a href="#__codelineno-56-39"><span class="linenos" data-linenos="39 "></span></a>            <span class="p">}),</span>
<a id="__codelineno-56-40" name="__codelineno-56-40"></a><a href="#__codelineno-56-40"><span class="linenos" data-linenos="40 "></span></a>        <span class="p">}</span>
<a id="__codelineno-56-41" name="__codelineno-56-41"></a><a href="#__codelineno-56-41"><span class="linenos" data-linenos="41 "></span></a>
<a id="__codelineno-56-42" name="__codelineno-56-42"></a><a href="#__codelineno-56-42"><span class="linenos" data-linenos="42 "></span></a>
<a id="__codelineno-56-43" name="__codelineno-56-43"></a><a href="#__codelineno-56-43"><span class="linenos" data-linenos="43 "></span></a><span class="k">class</span> <span class="nc">EmailForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
<a id="__codelineno-56-44" name="__codelineno-56-44"></a><a href="#__codelineno-56-44"><span class="linenos" data-linenos="44 "></span></a>    <span class="n">email</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span>
<a id="__codelineno-56-45" name="__codelineno-56-45"></a><a href="#__codelineno-56-45"><span class="linenos" data-linenos="45 "></span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-56-46" name="__codelineno-56-46"></a><a href="#__codelineno-56-46"><span class="linenos" data-linenos="46 "></span></a>        <span class="n">help_text</span><span class="o">=</span><span class="s1">'Requerido, 254 caracteres como máximo y que sea válido'</span><span class="p">)</span>
<a id="__codelineno-56-47" name="__codelineno-56-47"></a><a href="#__codelineno-56-47"><span class="linenos" data-linenos="47 "></span></a>
<a id="__codelineno-56-48" name="__codelineno-56-48"></a><a href="#__codelineno-56-48"><span class="linenos" data-linenos="48 "></span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<a id="__codelineno-56-49" name="__codelineno-56-49"></a><a href="#__codelineno-56-49"><span class="linenos" data-linenos="49 "></span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
<a id="__codelineno-56-50" name="__codelineno-56-50"></a><a href="#__codelineno-56-50"><span class="linenos" data-linenos="50 "></span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'email'</span><span class="p">]</span>
<a id="__codelineno-56-51" name="__codelineno-56-51"></a><a href="#__codelineno-56-51"><span class="linenos" data-linenos="51 "></span></a>
<a id="__codelineno-56-52" name="__codelineno-56-52"></a><a href="#__codelineno-56-52"><span class="linenos" data-linenos="52 "></span></a>    <span class="k">def</span> <span class="nf">clean_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-56-53" name="__codelineno-56-53"></a><a href="#__codelineno-56-53"><span class="linenos" data-linenos="53 "></span></a>        <span class="n">email</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">'email'</span><span class="p">]</span>
<a id="__codelineno-56-54" name="__codelineno-56-54"></a><a href="#__codelineno-56-54"><span class="linenos" data-linenos="54 "></span></a>        <span class="k">if</span> <span class="s1">'email'</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">changed_data</span><span class="p">:</span>
<a id="__codelineno-56-55" name="__codelineno-56-55"></a><a href="#__codelineno-56-55"><span class="linenos" data-linenos="55 "></span></a>            <span class="k">if</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-56-56" name="__codelineno-56-56"></a><a href="#__codelineno-56-56"><span class="linenos" data-linenos="56 "></span></a>                <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">'El email ya existe, usa otro.'</span><span class="p">)</span>
<a id="__codelineno-56-57" name="__codelineno-56-57"></a><a href="#__codelineno-56-57"><span class="linenos" data-linenos="57 "></span></a>        <span class="k">return</span> <span class="n">email</span>
</code></pre></div>
<p><code>&lt;app&gt;/views.py</code> -&gt; Creas su vista <code>EmailUpdate</code> y lo obtienes (el email) de la propia <code>request</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><a href="#__codelineno-57-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">UserCreationFormWithEmail</span><span class="p">,</span> <span class="n">ProfileForm</span><span class="p">,</span> <span class="n">EmailForm</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a><a href="#__codelineno-57-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">CreateView</span>
<a id="__codelineno-57-3" name="__codelineno-57-3"></a><a href="#__codelineno-57-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse_lazy</span>
<a id="__codelineno-57-4" name="__codelineno-57-4"></a><a href="#__codelineno-57-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<a id="__codelineno-57-5" name="__codelineno-57-5"></a><a href="#__codelineno-57-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">from</span> <span class="nn">django.utils.decorators</span> <span class="kn">import</span> <span class="n">method_decorator</span>
<a id="__codelineno-57-6" name="__codelineno-57-6"></a><a href="#__codelineno-57-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
<a id="__codelineno-57-7" name="__codelineno-57-7"></a><a href="#__codelineno-57-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="kn">from</span> <span class="nn">django.views.generic.edit</span> <span class="kn">import</span> <span class="n">UpdateView</span>
<a id="__codelineno-57-8" name="__codelineno-57-8"></a><a href="#__codelineno-57-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Profile</span>
<a id="__codelineno-57-9" name="__codelineno-57-9"></a><a href="#__codelineno-57-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-57-10" name="__codelineno-57-10"></a><a href="#__codelineno-57-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-57-11" name="__codelineno-57-11"></a><a href="#__codelineno-57-11"><span class="linenos" data-linenos="11 "></span></a><span class="c1"># Create your views here.</span>
<a id="__codelineno-57-12" name="__codelineno-57-12"></a><a href="#__codelineno-57-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">class</span> <span class="nc">SignUpView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
<a id="__codelineno-57-13" name="__codelineno-57-13"></a><a href="#__codelineno-57-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">UserCreationFormWithEmail</span>
<a id="__codelineno-57-14" name="__codelineno-57-14"></a><a href="#__codelineno-57-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'registration/signup.html'</span>
<a id="__codelineno-57-15" name="__codelineno-57-15"></a><a href="#__codelineno-57-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-57-16" name="__codelineno-57-16"></a><a href="#__codelineno-57-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="k">def</span> <span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-57-17" name="__codelineno-57-17"></a><a href="#__codelineno-57-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="k">return</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'login'</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'?register'</span>
<a id="__codelineno-57-18" name="__codelineno-57-18"></a><a href="#__codelineno-57-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-57-19" name="__codelineno-57-19"></a><a href="#__codelineno-57-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="k">def</span> <span class="nf">get_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-57-20" name="__codelineno-57-20"></a><a href="#__codelineno-57-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="n">form</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SignUpView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_form</span><span class="p">()</span>
<a id="__codelineno-57-21" name="__codelineno-57-21"></a><a href="#__codelineno-57-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="c1"># Customización en tiempo real</span>
<a id="__codelineno-57-22" name="__codelineno-57-22"></a><a href="#__codelineno-57-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span>
<a id="__codelineno-57-23" name="__codelineno-57-23"></a><a href="#__codelineno-57-23"><span class="linenos" data-linenos="23 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-57-24" name="__codelineno-57-24"></a><a href="#__codelineno-57-24"><span class="linenos" data-linenos="24 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Nombre de usuario'</span><span class="p">})</span>
<a id="__codelineno-57-25" name="__codelineno-57-25"></a><a href="#__codelineno-57-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'email'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailInput</span><span class="p">(</span>
<a id="__codelineno-57-26" name="__codelineno-57-26"></a><a href="#__codelineno-57-26"><span class="linenos" data-linenos="26 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-57-27" name="__codelineno-57-27"></a><a href="#__codelineno-57-27"><span class="linenos" data-linenos="27 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Email'</span><span class="p">})</span>
<a id="__codelineno-57-28" name="__codelineno-57-28"></a><a href="#__codelineno-57-28"><span class="linenos" data-linenos="28 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'password1'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">(</span>
<a id="__codelineno-57-29" name="__codelineno-57-29"></a><a href="#__codelineno-57-29"><span class="linenos" data-linenos="29 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-57-30" name="__codelineno-57-30"></a><a href="#__codelineno-57-30"><span class="linenos" data-linenos="30 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Contraseña'</span><span class="p">})</span>
<a id="__codelineno-57-31" name="__codelineno-57-31"></a><a href="#__codelineno-57-31"><span class="linenos" data-linenos="31 "></span></a>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'password2'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">(</span>
<a id="__codelineno-57-32" name="__codelineno-57-32"></a><a href="#__codelineno-57-32"><span class="linenos" data-linenos="32 "></span></a>            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'form-control mb2'</span><span class="p">,</span>
<a id="__codelineno-57-33" name="__codelineno-57-33"></a><a href="#__codelineno-57-33"><span class="linenos" data-linenos="33 "></span></a>                   <span class="s1">'placeholder'</span><span class="p">:</span> <span class="s1">'Repite la contraseña'</span><span class="p">})</span>
<a id="__codelineno-57-34" name="__codelineno-57-34"></a><a href="#__codelineno-57-34"><span class="linenos" data-linenos="34 "></span></a>        <span class="k">return</span> <span class="n">form</span>
<a id="__codelineno-57-35" name="__codelineno-57-35"></a><a href="#__codelineno-57-35"><span class="linenos" data-linenos="35 "></span></a>
<a id="__codelineno-57-36" name="__codelineno-57-36"></a><a href="#__codelineno-57-36"><span class="linenos" data-linenos="36 "></span></a>
<a id="__codelineno-57-37" name="__codelineno-57-37"></a><a href="#__codelineno-57-37"><span class="linenos" data-linenos="37 "></span></a><span class="nd">@method_decorator</span><span class="p">(</span><span class="n">login_required</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'dispatch'</span><span class="p">)</span>
<a id="__codelineno-57-38" name="__codelineno-57-38"></a><a href="#__codelineno-57-38"><span class="linenos" data-linenos="38 "></span></a><span class="k">class</span> <span class="nc">ProfileUpdate</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>
<a id="__codelineno-57-39" name="__codelineno-57-39"></a><a href="#__codelineno-57-39"><span class="linenos" data-linenos="39 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">ProfileForm</span>
<a id="__codelineno-57-40" name="__codelineno-57-40"></a><a href="#__codelineno-57-40"><span class="linenos" data-linenos="40 "></span></a>    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'profile'</span><span class="p">)</span>
<a id="__codelineno-57-41" name="__codelineno-57-41"></a><a href="#__codelineno-57-41"><span class="linenos" data-linenos="41 "></span></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'registration/profile_form.html'</span>
<a id="__codelineno-57-42" name="__codelineno-57-42"></a><a href="#__codelineno-57-42"><span class="linenos" data-linenos="42 "></span></a>
<a id="__codelineno-57-43" name="__codelineno-57-43"></a><a href="#__codelineno-57-43"><span class="linenos" data-linenos="43 "></span></a>    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-57-44" name="__codelineno-57-44"></a><a href="#__codelineno-57-44"><span class="linenos" data-linenos="44 "></span></a>        <span class="c1"># Obtener (o crear si no existe) el objeto a editar</span>
<a id="__codelineno-57-45" name="__codelineno-57-45"></a><a href="#__codelineno-57-45"><span class="linenos" data-linenos="45 "></span></a>        <span class="n">profile</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">Profile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
<a id="__codelineno-57-46" name="__codelineno-57-46"></a><a href="#__codelineno-57-46"><span class="linenos" data-linenos="46 "></span></a>        <span class="k">return</span> <span class="n">profile</span>
<a id="__codelineno-57-47" name="__codelineno-57-47"></a><a href="#__codelineno-57-47"><span class="linenos" data-linenos="47 "></span></a>
<a id="__codelineno-57-48" name="__codelineno-57-48"></a><a href="#__codelineno-57-48"><span class="linenos" data-linenos="48 "></span></a>
<a id="__codelineno-57-49" name="__codelineno-57-49"></a><a href="#__codelineno-57-49"><span class="linenos" data-linenos="49 "></span></a><span class="nd">@method_decorator</span><span class="p">(</span><span class="n">login_required</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'dispatch'</span><span class="p">)</span>
<a id="__codelineno-57-50" name="__codelineno-57-50"></a><a href="#__codelineno-57-50"><span class="linenos" data-linenos="50 "></span></a><span class="k">class</span> <span class="nc">EmailUpdate</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>
<a id="__codelineno-57-51" name="__codelineno-57-51"></a><a href="#__codelineno-57-51"><span class="linenos" data-linenos="51 "></span></a>    <span class="n">form_class</span> <span class="o">=</span> <span class="n">EmailForm</span>
<a id="__codelineno-57-52" name="__codelineno-57-52"></a><a href="#__codelineno-57-52"><span class="linenos" data-linenos="52 "></span></a>    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">'profile'</span><span class="p">)</span>
<a id="__codelineno-57-53" name="__codelineno-57-53"></a><a href="#__codelineno-57-53"><span class="linenos" data-linenos="53 "></span></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'registration/profile_email_form.html'</span>
<a id="__codelineno-57-54" name="__codelineno-57-54"></a><a href="#__codelineno-57-54"><span class="linenos" data-linenos="54 "></span></a>
<a id="__codelineno-57-55" name="__codelineno-57-55"></a><a href="#__codelineno-57-55"><span class="linenos" data-linenos="55 "></span></a>    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-57-56" name="__codelineno-57-56"></a><a href="#__codelineno-57-56"><span class="linenos" data-linenos="56 "></span></a>        <span class="c1"># Obtener el objeto a editar</span>
<a id="__codelineno-57-57" name="__codelineno-57-57"></a><a href="#__codelineno-57-57"><span class="linenos" data-linenos="57 "></span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
</code></pre></div>
<p><code>&lt;app&gt;/urls.py</code> -&gt; Creas su endpoint / url asociada a su vista.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><a href="#__codelineno-58-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a><a href="#__codelineno-58-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">SignUpView</span><span class="p">,</span> <span class="n">ProfileUpdate</span><span class="p">,</span> <span class="n">EmailUpdate</span>
<a id="__codelineno-58-3" name="__codelineno-58-3"></a><a href="#__codelineno-58-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-58-4" name="__codelineno-58-4"></a><a href="#__codelineno-58-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-58-5" name="__codelineno-58-5"></a><a href="#__codelineno-58-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'signup/'</span><span class="p">,</span> <span class="n">SignUpView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'signup'</span><span class="p">),</span>
<a id="__codelineno-58-6" name="__codelineno-58-6"></a><a href="#__codelineno-58-6"><span class="linenos" data-linenos="6 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'profile/'</span><span class="p">,</span> <span class="n">ProfileUpdate</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'profile'</span><span class="p">),</span>
<a id="__codelineno-58-7" name="__codelineno-58-7"></a><a href="#__codelineno-58-7"><span class="linenos" data-linenos="7 "></span></a>    <span class="n">path</span><span class="p">(</span><span class="s1">'profile/email/'</span><span class="p">,</span> <span class="n">EmailUpdate</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'profile_email'</span><span class="p">),</span>
<a id="__codelineno-58-8" name="__codelineno-58-8"></a><a href="#__codelineno-58-8"><span class="linenos" data-linenos="8 "></span></a><span class="p">]</span>
</code></pre></div>
<p><code>&lt;app&gt;/templates/&lt;app&gt;/template_name</code> -&gt; Por último creas la template.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><a href="#__codelineno-59-1"><span class="linenos" data-linenos=" 1 "></span></a>{% extends 'core/base.html' %}
<a id="__codelineno-59-2" name="__codelineno-59-2"></a><a href="#__codelineno-59-2"><span class="linenos" data-linenos=" 2 "></span></a>{% load static %}
<a id="__codelineno-59-3" name="__codelineno-59-3"></a><a href="#__codelineno-59-3"><span class="linenos" data-linenos=" 3 "></span></a>{% block title %}Email{% endblock %}
<a id="__codelineno-59-4" name="__codelineno-59-4"></a><a href="#__codelineno-59-4"><span class="linenos" data-linenos=" 4 "></span></a>{% block content %}
<a id="__codelineno-59-5" name="__codelineno-59-5"></a><a href="#__codelineno-59-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;.</span><span class="nc">errorlist</span><span class="p">{</span><span class="k">color</span><span class="p">:</span><span class="kc">red</span><span class="p">;}</span><span class="w"> </span><span class="nt">label</span><span class="p">{</span><span class="k">display</span><span class="p">:</span><span class="kc">none</span><span class="p">}&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<a id="__codelineno-59-6" name="__codelineno-59-6"></a><a href="#__codelineno-59-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="p">&lt;</span><span class="nt">main</span> <span class="na">role</span><span class="o">=</span><span class="s">"main"</span><span class="p">&gt;</span>
<a id="__codelineno-59-7" name="__codelineno-59-7"></a><a href="#__codelineno-59-7"><span class="linenos" data-linenos=" 7 "></span></a>  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"container"</span><span class="p">&gt;</span>
<a id="__codelineno-59-8" name="__codelineno-59-8"></a><a href="#__codelineno-59-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"row mt-3"</span><span class="p">&gt;</span>
<a id="__codelineno-59-9" name="__codelineno-59-9"></a><a href="#__codelineno-59-9"><span class="linenos" data-linenos=" 9 "></span></a>      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"col-md-9 mx-auto mb-5"</span><span class="p">&gt;</span>
<a id="__codelineno-59-10" name="__codelineno-59-10"></a><a href="#__codelineno-59-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">""</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span><span class="p">&gt;</span>{% csrf_token %}
<a id="__codelineno-59-11" name="__codelineno-59-11"></a><a href="#__codelineno-59-11"><span class="linenos" data-linenos="11 "></span></a>          <span class="p">&lt;</span><span class="nt">h3</span> <span class="na">class</span><span class="o">=</span><span class="s">"mb-4"</span><span class="p">&gt;</span>Email<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<a id="__codelineno-59-12" name="__codelineno-59-12"></a><a href="#__codelineno-59-12"><span class="linenos" data-linenos="12 "></span></a>          {{form.as_p}}
<a id="__codelineno-59-13" name="__codelineno-59-13"></a><a href="#__codelineno-59-13"><span class="linenos" data-linenos="13 "></span></a>          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">class</span><span class="o">=</span><span class="s">"btn btn-primary btn-block"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Actualizar"</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-59-14" name="__codelineno-59-14"></a><a href="#__codelineno-59-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<a id="__codelineno-59-15" name="__codelineno-59-15"></a><a href="#__codelineno-59-15"><span class="linenos" data-linenos="15 "></span></a>      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-59-16" name="__codelineno-59-16"></a><a href="#__codelineno-59-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-59-17" name="__codelineno-59-17"></a><a href="#__codelineno-59-17"><span class="linenos" data-linenos="17 "></span></a>  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-59-18" name="__codelineno-59-18"></a><a href="#__codelineno-59-18"><span class="linenos" data-linenos="18 "></span></a><span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>
<a id="__codelineno-59-19" name="__codelineno-59-19"></a><a href="#__codelineno-59-19"><span class="linenos" data-linenos="19 "></span></a>{% endblock %}
</code></pre></div>
<h3 id="contrasena-editable">Contraseña Editable<a class="headerlink" href="#contrasena-editable" title="Permanent link">¶</a></h3>
<p>Al igual que sucedía anteriormente cuando querías cambiar la contraseña (Recuperar Contraseña), Django tiene urls de Admin para editar la contraseña. Tu vas a usar:</p>
<ul>
<li><code>password_change/</code> -&gt; Vista con nombre <code>password_change</code> y template que usa un formulario <code>password_change_form-html</code>.</li>
<li><code>password_change/done</code> -&gt; Vista con nombre <code>password_change_done</code> y template <code>password_change_done.html</code>.</li>
</ul>
<p>Solo tienes que crear estos dos templates</p>
<p><code>&lt;app&gt;/templates/&lt;app&gt;/password_change_form.html</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><a href="#__codelineno-60-1"><span class="linenos" data-linenos=" 1 "></span></a>{% extends 'core/base.html' %}
<a id="__codelineno-60-2" name="__codelineno-60-2"></a><a href="#__codelineno-60-2"><span class="linenos" data-linenos=" 2 "></span></a>{% load static %}
<a id="__codelineno-60-3" name="__codelineno-60-3"></a><a href="#__codelineno-60-3"><span class="linenos" data-linenos=" 3 "></span></a>{% block title %}Cambio de contraseña{% endblock %}
<a id="__codelineno-60-4" name="__codelineno-60-4"></a><a href="#__codelineno-60-4"><span class="linenos" data-linenos=" 4 "></span></a>{% block content %}
<a id="__codelineno-60-5" name="__codelineno-60-5"></a><a href="#__codelineno-60-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;.</span><span class="nc">errorlist</span><span class="p">{</span><span class="k">color</span><span class="p">:</span><span class="kc">red</span><span class="p">;}&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<a id="__codelineno-60-6" name="__codelineno-60-6"></a><a href="#__codelineno-60-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="p">&lt;</span><span class="nt">main</span> <span class="na">role</span><span class="o">=</span><span class="s">"main"</span><span class="p">&gt;</span>
<a id="__codelineno-60-7" name="__codelineno-60-7"></a><a href="#__codelineno-60-7"><span class="linenos" data-linenos=" 7 "></span></a>  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"container"</span><span class="p">&gt;</span>
<a id="__codelineno-60-8" name="__codelineno-60-8"></a><a href="#__codelineno-60-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"row mt-3"</span><span class="p">&gt;</span>
<a id="__codelineno-60-9" name="__codelineno-60-9"></a><a href="#__codelineno-60-9"><span class="linenos" data-linenos=" 9 "></span></a>      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"col-md-9 mx-auto mb-5"</span><span class="p">&gt;</span>
<a id="__codelineno-60-10" name="__codelineno-60-10"></a><a href="#__codelineno-60-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">""</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span><span class="p">&gt;</span>{% csrf_token %}
<a id="__codelineno-60-11" name="__codelineno-60-11"></a><a href="#__codelineno-60-11"><span class="linenos" data-linenos="11 "></span></a>            <span class="p">&lt;</span><span class="nt">h3</span> <span class="na">class</span><span class="o">=</span><span class="s">"mb-4"</span><span class="p">&gt;</span>Cambio de contraseña<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<a id="__codelineno-60-12" name="__codelineno-60-12"></a><a href="#__codelineno-60-12"><span class="linenos" data-linenos="12 "></span></a>            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Por favor, introduzca su contraseña antigua por seguridad, y después introduzca dos veces la nueva contraseña para verificar que la ha escrito correctamente.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-60-13" name="__codelineno-60-13"></a><a href="#__codelineno-60-13"><span class="linenos" data-linenos="13 "></span></a>            {{form.old_password.errors}}
<a id="__codelineno-60-14" name="__codelineno-60-14"></a><a href="#__codelineno-60-14"><span class="linenos" data-linenos="14 "></span></a>            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"password"</span> <span class="na">name</span><span class="o">=</span><span class="s">"old_password"</span> <span class="na">autofocus</span><span class="o">=</span><span class="s">""</span> <span class="na">required</span><span class="o">=</span><span class="s">""</span> <span class="na">id</span><span class="o">=</span><span class="s">"id_old_password"</span><span class="na">class</span><span class="o">=</span><span class="s">"form-control"</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">"Contraseña antigua"</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-60-15" name="__codelineno-60-15"></a><a href="#__codelineno-60-15"><span class="linenos" data-linenos="15 "></span></a>            {{form.new_password1.errors}}
<a id="__codelineno-60-16" name="__codelineno-60-16"></a><a href="#__codelineno-60-16"><span class="linenos" data-linenos="16 "></span></a>            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"password"</span> <span class="na">name</span><span class="o">=</span><span class="s">"new_password1"</span> <span class="na">required</span><span class="o">=</span><span class="s">""</span> <span class="na">id</span><span class="o">=</span><span class="s">"id_new_password1"</span> <span class="na">class</span><span class="o">=</span><span class="s">"form-control"</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">"Contraseña nueva"</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-60-17" name="__codelineno-60-17"></a><a href="#__codelineno-60-17"><span class="linenos" data-linenos="17 "></span></a>            {{form.new_password2.errors}}
<a id="__codelineno-60-18" name="__codelineno-60-18"></a><a href="#__codelineno-60-18"><span class="linenos" data-linenos="18 "></span></a>            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"password"</span> <span class="na">name</span><span class="o">=</span><span class="s">"new_password2"</span> <span class="na">required</span><span class="o">=</span><span class="s">""</span> <span class="na">id</span><span class="o">=</span><span class="s">"id_new_password2"</span> <span class="na">class</span><span class="o">=</span><span class="s">"form-control"</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">"Contraseña nueva (confirmación)"</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-60-19" name="__codelineno-60-19"></a><a href="#__codelineno-60-19"><span class="linenos" data-linenos="19 "></span></a>            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">class</span><span class="o">=</span><span class="s">"btn btn-primary btn-block"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Cambiar mi contraseña"</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-60-20" name="__codelineno-60-20"></a><a href="#__codelineno-60-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<a id="__codelineno-60-21" name="__codelineno-60-21"></a><a href="#__codelineno-60-21"><span class="linenos" data-linenos="21 "></span></a>      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-60-22" name="__codelineno-60-22"></a><a href="#__codelineno-60-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-60-23" name="__codelineno-60-23"></a><a href="#__codelineno-60-23"><span class="linenos" data-linenos="23 "></span></a>  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-60-24" name="__codelineno-60-24"></a><a href="#__codelineno-60-24"><span class="linenos" data-linenos="24 "></span></a><span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>
<a id="__codelineno-60-25" name="__codelineno-60-25"></a><a href="#__codelineno-60-25"><span class="linenos" data-linenos="25 "></span></a>{% endblock %}
</code></pre></div>
<p><code>&lt;app&gt;/templates/&lt;app&gt;/password_change_done.html</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><a href="#__codelineno-61-1"><span class="linenos" data-linenos=" 1 "></span></a>{% extends 'core/base.html' %}
<a id="__codelineno-61-2" name="__codelineno-61-2"></a><a href="#__codelineno-61-2"><span class="linenos" data-linenos=" 2 "></span></a>{% load static %}
<a id="__codelineno-61-3" name="__codelineno-61-3"></a><a href="#__codelineno-61-3"><span class="linenos" data-linenos=" 3 "></span></a>{% block title %}Contraseña cambiada correctamente{% endblock %}
<a id="__codelineno-61-4" name="__codelineno-61-4"></a><a href="#__codelineno-61-4"><span class="linenos" data-linenos=" 4 "></span></a>{% block content %}
<a id="__codelineno-61-5" name="__codelineno-61-5"></a><a href="#__codelineno-61-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="p">&lt;</span><span class="nt">main</span> <span class="na">role</span><span class="o">=</span><span class="s">"main"</span><span class="p">&gt;</span>
<a id="__codelineno-61-6" name="__codelineno-61-6"></a><a href="#__codelineno-61-6"><span class="linenos" data-linenos=" 6 "></span></a>  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"container"</span><span class="p">&gt;</span>
<a id="__codelineno-61-7" name="__codelineno-61-7"></a><a href="#__codelineno-61-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"row mt-3"</span><span class="p">&gt;</span>
<a id="__codelineno-61-8" name="__codelineno-61-8"></a><a href="#__codelineno-61-8"><span class="linenos" data-linenos=" 8 "></span></a>      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"col-md-9 mx-auto mb-5"</span><span class="p">&gt;</span>
<a id="__codelineno-61-9" name="__codelineno-61-9"></a><a href="#__codelineno-61-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="p">&lt;</span><span class="nt">h3</span> <span class="na">class</span><span class="o">=</span><span class="s">"mb-4"</span><span class="p">&gt;</span>Contraseña cambiada correctamente<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<a id="__codelineno-61-10" name="__codelineno-61-10"></a><a href="#__codelineno-61-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Puedes volver a tu perfil haciendo clic <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"{% url 'profile' %}"</span><span class="p">&gt;</span>aquí<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-61-11" name="__codelineno-61-11"></a><a href="#__codelineno-61-11"><span class="linenos" data-linenos="11 "></span></a>      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-61-12" name="__codelineno-61-12"></a><a href="#__codelineno-61-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-61-13" name="__codelineno-61-13"></a><a href="#__codelineno-61-13"><span class="linenos" data-linenos="13 "></span></a>  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-61-14" name="__codelineno-61-14"></a><a href="#__codelineno-61-14"><span class="linenos" data-linenos="14 "></span></a><span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>
<a id="__codelineno-61-15" name="__codelineno-61-15"></a><a href="#__codelineno-61-15"><span class="linenos" data-linenos="15 "></span></a>{% endblock %}
</code></pre></div>
<h3 id="optimizar-guardado-de-avatar">Optimizar guardado de avatar<a class="headerlink" href="#optimizar-guardado-de-avatar" title="Permanent link">¶</a></h3>
<p>Si se guardan todas las imágenes a pelo de un usuario, esto es impracticable a la larga. Lo ideal es que cuando el usuario cargue una imagen nueva, borres la anterior y la sustituyas por la nueva. Para hacer esto tienes que:</p>
<p><code>&lt;app&gt;/models.py</code> -&gt; En la app donde tengas la gestión del perfil, en el campo <code>avatar</code> le pasas al argumento <code>upload_to</code> una función, en este caso <code>custom_upload_to</code>. A esa función tienes que pasarle primero la instancia el perfil, y luego el nombre del fichero del nuevo avatar. Una vez dentro recuperas el perfil y borras su avatar. Por último devuelves el path con el nombre donde se va a guardar la nueva imagen.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><a href="#__codelineno-62-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<a id="__codelineno-62-2" name="__codelineno-62-2"></a><a href="#__codelineno-62-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<a id="__codelineno-62-3" name="__codelineno-62-3"></a><a href="#__codelineno-62-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">django.dispatch</span> <span class="kn">import</span> <span class="n">receiver</span>
<a id="__codelineno-62-4" name="__codelineno-62-4"></a><a href="#__codelineno-62-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">django.db.models.signals</span> <span class="kn">import</span> <span class="n">post_save</span>
<a id="__codelineno-62-5" name="__codelineno-62-5"></a><a href="#__codelineno-62-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-62-6" name="__codelineno-62-6"></a><a href="#__codelineno-62-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-62-7" name="__codelineno-62-7"></a><a href="#__codelineno-62-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">def</span> <span class="nf">custom_upload_to</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-62-8" name="__codelineno-62-8"></a><a href="#__codelineno-62-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">old_instance</span> <span class="o">=</span> <span class="n">Profile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
<a id="__codelineno-62-9" name="__codelineno-62-9"></a><a href="#__codelineno-62-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">old_instance</span><span class="o">.</span><span class="n">avatar</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
<a id="__codelineno-62-10" name="__codelineno-62-10"></a><a href="#__codelineno-62-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">return</span> <span class="s1">'profiles/'</span> <span class="o">+</span> <span class="n">filename</span>
<a id="__codelineno-62-11" name="__codelineno-62-11"></a><a href="#__codelineno-62-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-62-12" name="__codelineno-62-12"></a><a href="#__codelineno-62-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-62-13" name="__codelineno-62-13"></a><a href="#__codelineno-62-13"><span class="linenos" data-linenos="13 "></span></a><span class="c1"># Create your models here.</span>
<a id="__codelineno-62-14" name="__codelineno-62-14"></a><a href="#__codelineno-62-14"><span class="linenos" data-linenos="14 "></span></a><span class="k">class</span> <span class="nc">Profile</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-62-15" name="__codelineno-62-15"></a><a href="#__codelineno-62-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
<a id="__codelineno-62-16" name="__codelineno-62-16"></a><a href="#__codelineno-62-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">avatar</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="n">custom_upload_to</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-62-17" name="__codelineno-62-17"></a><a href="#__codelineno-62-17"><span class="linenos" data-linenos="17 "></span></a>                               <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-62-18" name="__codelineno-62-18"></a><a href="#__codelineno-62-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">bio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-62-19" name="__codelineno-62-19"></a><a href="#__codelineno-62-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">link</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-62-20" name="__codelineno-62-20"></a><a href="#__codelineno-62-20"><span class="linenos" data-linenos="20 "></span></a>
<a id="__codelineno-62-21" name="__codelineno-62-21"></a><a href="#__codelineno-62-21"><span class="linenos" data-linenos="21 "></span></a>
<a id="__codelineno-62-22" name="__codelineno-62-22"></a><a href="#__codelineno-62-22"><span class="linenos" data-linenos="22 "></span></a><span class="nd">@receiver</span><span class="p">(</span><span class="n">post_save</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">User</span><span class="p">)</span>
<a id="__codelineno-62-23" name="__codelineno-62-23"></a><a href="#__codelineno-62-23"><span class="linenos" data-linenos="23 "></span></a><span class="k">def</span> <span class="nf">ensure_profile_exists</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-62-24" name="__codelineno-62-24"></a><a href="#__codelineno-62-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'created'</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-62-25" name="__codelineno-62-25"></a><a href="#__codelineno-62-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="n">Profile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
<a id="__codelineno-62-26" name="__codelineno-62-26"></a><a href="#__codelineno-62-26"><span class="linenos" data-linenos="26 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">'Se acaba de crear un usuario y su perfil enlazado'</span><span class="p">)</span>
</code></pre></div>
<h2 id="senales">Señales<a class="headerlink" href="#senales" title="Permanent link">¶</a></h2>
<p>Una señal es una función que se ejecuta después de que ocurra un evento. Por ejemplo, si quisieras saber cuando se ha creado un usuario correctamente, puedes hacer lo siguiente.</p>
<p><code>&lt;app&gt;/models.py</code> -&gt; Creas la función <code>ensure_profile_exists</code>. Importas el decorador <code>receiver</code> y también la señal <code>post_save</code>. Decoras la función indicándole el decorador, la señal, y quien la envía (en este caso <code>User</code>). De los <code>kwargs</code> compruebas si se acaba de crear el usuario y ya puedes operar con él.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><a href="#__codelineno-63-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a><a href="#__codelineno-63-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a><a href="#__codelineno-63-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">django.dispatch</span> <span class="kn">import</span> <span class="n">receiver</span>
<a id="__codelineno-63-4" name="__codelineno-63-4"></a><a href="#__codelineno-63-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span> <span class="nn">django.db.models.signals</span> <span class="kn">import</span> <span class="n">post_save</span>
<a id="__codelineno-63-5" name="__codelineno-63-5"></a><a href="#__codelineno-63-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-63-6" name="__codelineno-63-6"></a><a href="#__codelineno-63-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-63-7" name="__codelineno-63-7"></a><a href="#__codelineno-63-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="c1"># Create your models here.</span>
<a id="__codelineno-63-8" name="__codelineno-63-8"></a><a href="#__codelineno-63-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="k">class</span> <span class="nc">Profile</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-63-9" name="__codelineno-63-9"></a><a href="#__codelineno-63-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
<a id="__codelineno-63-10" name="__codelineno-63-10"></a><a href="#__codelineno-63-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">avatar</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s1">'profiles'</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-63-11" name="__codelineno-63-11"></a><a href="#__codelineno-63-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">bio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-63-12" name="__codelineno-63-12"></a><a href="#__codelineno-63-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">link</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-63-13" name="__codelineno-63-13"></a><a href="#__codelineno-63-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-63-14" name="__codelineno-63-14"></a><a href="#__codelineno-63-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-63-15" name="__codelineno-63-15"></a><a href="#__codelineno-63-15"><span class="linenos" data-linenos="15 "></span></a><span class="nd">@receiver</span><span class="p">(</span><span class="n">post_save</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">User</span><span class="p">)</span>
<a id="__codelineno-63-16" name="__codelineno-63-16"></a><a href="#__codelineno-63-16"><span class="linenos" data-linenos="16 "></span></a><span class="k">def</span> <span class="nf">ensure_profile_exists</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-63-17" name="__codelineno-63-17"></a><a href="#__codelineno-63-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'created'</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-63-18" name="__codelineno-63-18"></a><a href="#__codelineno-63-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="n">Profile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
<a id="__codelineno-63-19" name="__codelineno-63-19"></a><a href="#__codelineno-63-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">'Se acaba de crear un usuario y su perfil enlazado'</span><span class="p">)</span>
</code></pre></div>
<h2 id="tdd">TDD<a class="headerlink" href="#tdd" title="Permanent link">¶</a></h2>
<h3 id="tests-simples">Tests Simples<a class="headerlink" href="#tests-simples" title="Permanent link">¶</a></h3>
<p>Los tests de cada app se crean en <code>&lt;app&gt;/test.py</code>. Un ejemplo fácil para que te quedes con la copla, sería testear el ejemplo de la señal.</p>
<p><code>&lt;app&gt;/test.py</code> -&gt; Tienes que importar el modelo que vayas a testear, <code>Profile</code>, y en este caso vas a necesitar de <code>User</code> también. Creas una clase para pasar los tests de tu modelo. Con el método <code>setUp</code> generas los datos que necesites para hacer los tests. Luego generas un método por cada test y que siga el patrón <code>test_&lt;cosa_a_probar&gt;</code>. En este caso pruebas que se haya creado un perfil después de haber creado un usuario. En tu ejemplo obtienes el perfil que se acaba de crear por <code>setUp</code> y lanzas un <code>assert</code> si coincide.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><a href="#__codelineno-64-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<a id="__codelineno-64-2" name="__codelineno-64-2"></a><a href="#__codelineno-64-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<a id="__codelineno-64-3" name="__codelineno-64-3"></a><a href="#__codelineno-64-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Profile</span>
<a id="__codelineno-64-4" name="__codelineno-64-4"></a><a href="#__codelineno-64-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-64-5" name="__codelineno-64-5"></a><a href="#__codelineno-64-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-64-6" name="__codelineno-64-6"></a><a href="#__codelineno-64-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="c1"># Create your tests here.</span>
<a id="__codelineno-64-7" name="__codelineno-64-7"></a><a href="#__codelineno-64-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">class</span> <span class="nc">ProfileTestCase</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
<a id="__codelineno-64-8" name="__codelineno-64-8"></a><a href="#__codelineno-64-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-64-9" name="__codelineno-64-9"></a><a href="#__codelineno-64-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s1">'test'</span><span class="p">,</span> <span class="s1">'test@test.com'</span><span class="p">,</span> <span class="s1">'test1234'</span><span class="p">)</span>
<a id="__codelineno-64-10" name="__codelineno-64-10"></a><a href="#__codelineno-64-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-64-11" name="__codelineno-64-11"></a><a href="#__codelineno-64-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="k">def</span> <span class="nf">test_profile_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-64-12" name="__codelineno-64-12"></a><a href="#__codelineno-64-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="n">exists</span> <span class="o">=</span> <span class="n">Profile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user__username</span><span class="o">=</span><span class="s1">'test'</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<a id="__codelineno-64-13" name="__codelineno-64-13"></a><a href="#__codelineno-64-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">exists</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p>Para que se ejecuten el test debes hacer</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><a href="#__codelineno-65-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># Testear todo</span>
<a id="__codelineno-65-2" name="__codelineno-65-2"></a><a href="#__codelineno-65-2"><span class="linenos" data-linenos="2 "></span></a>python manage.py <span class="nb">test</span>
<a id="__codelineno-65-3" name="__codelineno-65-3"></a><a href="#__codelineno-65-3"><span class="linenos" data-linenos="3 "></span></a><span class="c1"># Testear la &lt;app&gt;</span>
<a id="__codelineno-65-4" name="__codelineno-65-4"></a><a href="#__codelineno-65-4"><span class="linenos" data-linenos="4 "></span></a>python manage.py <span class="nb">test</span> &lt;app&gt;
<a id="__codelineno-65-5" name="__codelineno-65-5"></a><a href="#__codelineno-65-5"><span class="linenos" data-linenos="5 "></span></a><span class="c1"># Testear la &lt;clase&gt; de la &lt;app&gt;</span>
<a id="__codelineno-65-6" name="__codelineno-65-6"></a><a href="#__codelineno-65-6"><span class="linenos" data-linenos="6 "></span></a>python manage.py <span class="nb">test</span> &lt;app&gt;.&lt;clase&gt;
<a id="__codelineno-65-7" name="__codelineno-65-7"></a><a href="#__codelineno-65-7"><span class="linenos" data-linenos="7 "></span></a><span class="c1"># Teastear el &lt;método&gt; de la &lt;clase&gt; de la &lt;app&gt;</span>
<a id="__codelineno-65-8" name="__codelineno-65-8"></a><a href="#__codelineno-65-8"><span class="linenos" data-linenos="8 "></span></a>python manage.py <span class="nb">test</span> &lt;app&gt;.&lt;clase&gt;.&lt;método&gt;
</code></pre></div>
<p>Cada vez que acaba de ejecutarse un método se borra la bbdd temporal y vuelve a ejecutarse <code>setUp</code> y luego el siguiente método.</p>
<h3 id="ejemplo-de-test-con-senales">Ejemplo de Test con señales<a class="headerlink" href="#ejemplo-de-test-con-senales" title="Permanent link">¶</a></h3>
<p>Suponte una app <code>messenger</code> con dos modelos:</p>
<p><code>messenger/models.py</code> -&gt; <code>Message</code> tiene un usuario, contenido y fecha de creacion. <code>Thread</code> tiene usuarios, mensajes.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><a href="#__codelineno-66-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<a id="__codelineno-66-2" name="__codelineno-66-2"></a><a href="#__codelineno-66-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<a id="__codelineno-66-3" name="__codelineno-66-3"></a><a href="#__codelineno-66-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-66-4" name="__codelineno-66-4"></a><a href="#__codelineno-66-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-66-5" name="__codelineno-66-5"></a><a href="#__codelineno-66-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="c1"># Create your models here.</span>
<a id="__codelineno-66-6" name="__codelineno-66-6"></a><a href="#__codelineno-66-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-66-7" name="__codelineno-66-7"></a><a href="#__codelineno-66-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
<a id="__codelineno-66-8" name="__codelineno-66-8"></a><a href="#__codelineno-66-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
<a id="__codelineno-66-9" name="__codelineno-66-9"></a><a href="#__codelineno-66-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-66-10" name="__codelineno-66-10"></a><a href="#__codelineno-66-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-66-11" name="__codelineno-66-11"></a><a href="#__codelineno-66-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<a id="__codelineno-66-12" name="__codelineno-66-12"></a><a href="#__codelineno-66-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'created'</span><span class="p">]</span>
<a id="__codelineno-66-13" name="__codelineno-66-13"></a><a href="#__codelineno-66-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-66-14" name="__codelineno-66-14"></a><a href="#__codelineno-66-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-66-15" name="__codelineno-66-15"></a><a href="#__codelineno-66-15"><span class="linenos" data-linenos="15 "></span></a><span class="k">class</span> <span class="nc">ThreadManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
<a id="__codelineno-66-16" name="__codelineno-66-16"></a><a href="#__codelineno-66-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user1</span><span class="p">,</span> <span class="n">user2</span><span class="p">):</span>
<a id="__codelineno-66-17" name="__codelineno-66-17"></a><a href="#__codelineno-66-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="c1"># self es lo mismo que Thread.objects.all()</span>
<a id="__codelineno-66-18" name="__codelineno-66-18"></a><a href="#__codelineno-66-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="n">queryset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">users</span><span class="o">=</span><span class="n">user1</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">users</span><span class="o">=</span><span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-66-19" name="__codelineno-66-19"></a><a href="#__codelineno-66-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">queryset</span><span class="p">):</span>
<a id="__codelineno-66-20" name="__codelineno-66-20"></a><a href="#__codelineno-66-20"><span class="linenos" data-linenos="20 "></span></a>            <span class="k">return</span> <span class="n">queryset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-66-21" name="__codelineno-66-21"></a><a href="#__codelineno-66-21"><span class="linenos" data-linenos="21 "></span></a>
<a id="__codelineno-66-22" name="__codelineno-66-22"></a><a href="#__codelineno-66-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="k">def</span> <span class="nf">find_or_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user1</span><span class="p">,</span> <span class="n">user2</span><span class="p">):</span>
<a id="__codelineno-66-23" name="__codelineno-66-23"></a><a href="#__codelineno-66-23"><span class="linenos" data-linenos="23 "></span></a>        <span class="n">thread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">user1</span><span class="p">,</span> <span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-66-24" name="__codelineno-66-24"></a><a href="#__codelineno-66-24"><span class="linenos" data-linenos="24 "></span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">thread</span><span class="p">:</span>
<a id="__codelineno-66-25" name="__codelineno-66-25"></a><a href="#__codelineno-66-25"><span class="linenos" data-linenos="25 "></span></a>            <span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<a id="__codelineno-66-26" name="__codelineno-66-26"></a><a href="#__codelineno-66-26"><span class="linenos" data-linenos="26 "></span></a>            <span class="n">thread</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user1</span><span class="p">,</span> <span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-66-27" name="__codelineno-66-27"></a><a href="#__codelineno-66-27"><span class="linenos" data-linenos="27 "></span></a>        <span class="k">return</span> <span class="n">thread</span>
<a id="__codelineno-66-28" name="__codelineno-66-28"></a><a href="#__codelineno-66-28"><span class="linenos" data-linenos="28 "></span></a>
<a id="__codelineno-66-29" name="__codelineno-66-29"></a><a href="#__codelineno-66-29"><span class="linenos" data-linenos="29 "></span></a>
<a id="__codelineno-66-30" name="__codelineno-66-30"></a><a href="#__codelineno-66-30"><span class="linenos" data-linenos="30 "></span></a><span class="k">class</span> <span class="nc">Thread</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-66-31" name="__codelineno-66-31"></a><a href="#__codelineno-66-31"><span class="linenos" data-linenos="31 "></span></a>    <span class="n">users</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">'threads'</span><span class="p">)</span>
<a id="__codelineno-66-32" name="__codelineno-66-32"></a><a href="#__codelineno-66-32"><span class="linenos" data-linenos="32 "></span></a>    <span class="n">messages</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Message</span><span class="p">)</span>
<a id="__codelineno-66-33" name="__codelineno-66-33"></a><a href="#__codelineno-66-33"><span class="linenos" data-linenos="33 "></span></a>    <span class="c1"># Model Manager</span>
<a id="__codelineno-66-34" name="__codelineno-66-34"></a><a href="#__codelineno-66-34"><span class="linenos" data-linenos="34 "></span></a>    <span class="n">objects</span> <span class="o">=</span> <span class="n">ThreadManager</span><span class="p">()</span>
</code></pre></div>
<p><code>messenger/test.py</code> -&gt; Abajo tienes el código, pero fíjate en el método <code>test_add_message_from_user_not_in_thread</code>. Quieres testear si un usuario que no está en un hilo, y el test falla.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><a href="#__codelineno-67-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<a id="__codelineno-67-2" name="__codelineno-67-2"></a><a href="#__codelineno-67-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<a id="__codelineno-67-3" name="__codelineno-67-3"></a><a href="#__codelineno-67-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Message</span><span class="p">,</span> <span class="n">Thread</span>
<a id="__codelineno-67-4" name="__codelineno-67-4"></a><a href="#__codelineno-67-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-67-5" name="__codelineno-67-5"></a><a href="#__codelineno-67-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-67-6" name="__codelineno-67-6"></a><a href="#__codelineno-67-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="c1"># Create your tests here.</span>
<a id="__codelineno-67-7" name="__codelineno-67-7"></a><a href="#__codelineno-67-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">class</span> <span class="nc">ThreadTestCase</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
<a id="__codelineno-67-8" name="__codelineno-67-8"></a><a href="#__codelineno-67-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-67-9" name="__codelineno-67-9"></a><a href="#__codelineno-67-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user1</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s1">'user1'</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">'test1234'</span><span class="p">)</span>
<a id="__codelineno-67-10" name="__codelineno-67-10"></a><a href="#__codelineno-67-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user2</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s1">'user2'</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">'test1234'</span><span class="p">)</span>
<a id="__codelineno-67-11" name="__codelineno-67-11"></a><a href="#__codelineno-67-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user3</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s1">'user3'</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">'test1234'</span><span class="p">)</span>
<a id="__codelineno-67-12" name="__codelineno-67-12"></a><a href="#__codelineno-67-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<a id="__codelineno-67-13" name="__codelineno-67-13"></a><a href="#__codelineno-67-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-67-14" name="__codelineno-67-14"></a><a href="#__codelineno-67-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="k">def</span> <span class="nf">test_add_to_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-67-15" name="__codelineno-67-15"></a><a href="#__codelineno-67-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-67-16" name="__codelineno-67-16"></a><a href="#__codelineno-67-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">all</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-67-17" name="__codelineno-67-17"></a><a href="#__codelineno-67-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-67-18" name="__codelineno-67-18"></a><a href="#__codelineno-67-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="k">def</span> <span class="nf">test_filter_thread_by_users</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-67-19" name="__codelineno-67-19"></a><a href="#__codelineno-67-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-67-20" name="__codelineno-67-20"></a><a href="#__codelineno-67-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="n">threads</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">users</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user1</span><span class="p">)</span><span class="o">.</span>\
<a id="__codelineno-67-21" name="__codelineno-67-21"></a><a href="#__codelineno-67-21"><span class="linenos" data-linenos="21 "></span></a>            <span class="nb">filter</span><span class="p">(</span><span class="n">users</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-67-22" name="__codelineno-67-22"></a><a href="#__codelineno-67-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">,</span> <span class="n">threads</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-67-23" name="__codelineno-67-23"></a><a href="#__codelineno-67-23"><span class="linenos" data-linenos="23 "></span></a>
<a id="__codelineno-67-24" name="__codelineno-67-24"></a><a href="#__codelineno-67-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="k">def</span> <span class="nf">test_filter_non_existent_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-67-25" name="__codelineno-67-25"></a><a href="#__codelineno-67-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="n">threads</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">users</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user1</span><span class="p">)</span><span class="o">.</span>\
<a id="__codelineno-67-26" name="__codelineno-67-26"></a><a href="#__codelineno-67-26"><span class="linenos" data-linenos="26 "></span></a>            <span class="nb">filter</span><span class="p">(</span><span class="n">users</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-67-27" name="__codelineno-67-27"></a><a href="#__codelineno-67-27"><span class="linenos" data-linenos="27 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">threads</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-67-28" name="__codelineno-67-28"></a><a href="#__codelineno-67-28"><span class="linenos" data-linenos="28 "></span></a>
<a id="__codelineno-67-29" name="__codelineno-67-29"></a><a href="#__codelineno-67-29"><span class="linenos" data-linenos="29 "></span></a>    <span class="k">def</span> <span class="nf">test_add_message_to_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-67-30" name="__codelineno-67-30"></a><a href="#__codelineno-67-30"><span class="linenos" data-linenos="30 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-67-31" name="__codelineno-67-31"></a><a href="#__codelineno-67-31"><span class="linenos" data-linenos="31 "></span></a>        <span class="n">message1</span> <span class="o">=</span> <span class="n">Message</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user1</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s1">'Jelou'</span><span class="p">)</span>
<a id="__codelineno-67-32" name="__codelineno-67-32"></a><a href="#__codelineno-67-32"><span class="linenos" data-linenos="32 "></span></a>        <span class="n">message2</span> <span class="o">=</span> <span class="n">Message</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user2</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s1">'Hola'</span><span class="p">)</span>
<a id="__codelineno-67-33" name="__codelineno-67-33"></a><a href="#__codelineno-67-33"><span class="linenos" data-linenos="33 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">message1</span><span class="p">,</span> <span class="n">message2</span><span class="p">)</span>
<a id="__codelineno-67-34" name="__codelineno-67-34"></a><a href="#__codelineno-67-34"><span class="linenos" data-linenos="34 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">all</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-67-35" name="__codelineno-67-35"></a><a href="#__codelineno-67-35"><span class="linenos" data-linenos="35 "></span></a>
<a id="__codelineno-67-36" name="__codelineno-67-36"></a><a href="#__codelineno-67-36"><span class="linenos" data-linenos="36 "></span></a>        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
<a id="__codelineno-67-37" name="__codelineno-67-37"></a><a href="#__codelineno-67-37"><span class="linenos" data-linenos="37 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">user</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<a id="__codelineno-67-38" name="__codelineno-67-38"></a><a href="#__codelineno-67-38"><span class="linenos" data-linenos="38 "></span></a>
<a id="__codelineno-67-39" name="__codelineno-67-39"></a><a href="#__codelineno-67-39"><span class="linenos" data-linenos="39 "></span></a>    <span class="k">def</span> <span class="nf">test_add_message_from_user_not_in_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-67-40" name="__codelineno-67-40"></a><a href="#__codelineno-67-40"><span class="linenos" data-linenos="40 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-67-41" name="__codelineno-67-41"></a><a href="#__codelineno-67-41"><span class="linenos" data-linenos="41 "></span></a>        <span class="n">message1</span> <span class="o">=</span> <span class="n">Message</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user1</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s1">'Jelou'</span><span class="p">)</span>
<a id="__codelineno-67-42" name="__codelineno-67-42"></a><a href="#__codelineno-67-42"><span class="linenos" data-linenos="42 "></span></a>        <span class="n">message2</span> <span class="o">=</span> <span class="n">Message</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user2</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s1">'Hola'</span><span class="p">)</span>
<a id="__codelineno-67-43" name="__codelineno-67-43"></a><a href="#__codelineno-67-43"><span class="linenos" data-linenos="43 "></span></a>        <span class="n">message3</span> <span class="o">=</span> <span class="n">Message</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user3</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s1">'Shurmanos'</span><span class="p">)</span>
<a id="__codelineno-67-44" name="__codelineno-67-44"></a><a href="#__codelineno-67-44"><span class="linenos" data-linenos="44 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">message1</span><span class="p">,</span> <span class="n">message2</span><span class="p">,</span> <span class="n">message3</span><span class="p">)</span>
<a id="__codelineno-67-45" name="__codelineno-67-45"></a><a href="#__codelineno-67-45"><span class="linenos" data-linenos="45 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">all</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-67-46" name="__codelineno-67-46"></a><a href="#__codelineno-67-46"><span class="linenos" data-linenos="46 "></span></a>
<a id="__codelineno-67-47" name="__codelineno-67-47"></a><a href="#__codelineno-67-47"><span class="linenos" data-linenos="47 "></span></a>    <span class="k">def</span> <span class="nf">test_find_thread_with_custom_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-67-48" name="__codelineno-67-48"></a><a href="#__codelineno-67-48"><span class="linenos" data-linenos="48 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-67-49" name="__codelineno-67-49"></a><a href="#__codelineno-67-49"><span class="linenos" data-linenos="49 "></span></a>        <span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-67-50" name="__codelineno-67-50"></a><a href="#__codelineno-67-50"><span class="linenos" data-linenos="50 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">,</span> <span class="n">thread</span><span class="p">)</span>
<a id="__codelineno-67-51" name="__codelineno-67-51"></a><a href="#__codelineno-67-51"><span class="linenos" data-linenos="51 "></span></a>
<a id="__codelineno-67-52" name="__codelineno-67-52"></a><a href="#__codelineno-67-52"><span class="linenos" data-linenos="52 "></span></a>    <span class="k">def</span> <span class="nf">test_find_or_create_thread_with_custom_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-67-53" name="__codelineno-67-53"></a><a href="#__codelineno-67-53"><span class="linenos" data-linenos="53 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-67-54" name="__codelineno-67-54"></a><a href="#__codelineno-67-54"><span class="linenos" data-linenos="54 "></span></a>        <span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">find_or_create</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-67-55" name="__codelineno-67-55"></a><a href="#__codelineno-67-55"><span class="linenos" data-linenos="55 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">,</span> <span class="n">thread</span><span class="p">)</span>
<a id="__codelineno-67-56" name="__codelineno-67-56"></a><a href="#__codelineno-67-56"><span class="linenos" data-linenos="56 "></span></a>        <span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">find_or_create</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user3</span><span class="p">)</span>
<a id="__codelineno-67-57" name="__codelineno-67-57"></a><a href="#__codelineno-67-57"><span class="linenos" data-linenos="57 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">,</span> <span class="n">thread</span><span class="p">)</span>
</code></pre></div>
<p>Para solucionar esto, la manera de hacerlo es capturar con una señal cuando se va a introducir un mensaje a un hilo, y no hacerlo. Cuando se añade un elemento a la bbdd, saltan al menos dos eventos, <code>pre_add</code> y <code>post_add</code>. Te interesa captar el primero con una señal y borrar lo que no vaya a ser guardado</p>
<p><code>messenger/models.py</code> -&gt; Usa la señal <code>m2m_changed</code> para captar cuando se va a introducir un elemento. Creas la función <code>messages_changed</code> para manipular ese evento, con un bucle recorres todos elementos <code>pk_set</code> y los guardas en un conjunto a parte los que no quieres <code>false_pk_set</code> y eliminas del conjunto los elementos que no deben estar. Por último a <code>m2m_changed</code> le conectas la función <code>messages_changed</code> y le pones como <code>sender</code> (emisor) el flujo/caudal de mensajes de los hilos, <code>Thread.messages.through</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><a href="#__codelineno-68-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<a id="__codelineno-68-2" name="__codelineno-68-2"></a><a href="#__codelineno-68-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<a id="__codelineno-68-3" name="__codelineno-68-3"></a><a href="#__codelineno-68-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span> <span class="nn">django.db.models.signals</span> <span class="kn">import</span> <span class="n">m2m_changed</span>
<a id="__codelineno-68-4" name="__codelineno-68-4"></a><a href="#__codelineno-68-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-68-5" name="__codelineno-68-5"></a><a href="#__codelineno-68-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-68-6" name="__codelineno-68-6"></a><a href="#__codelineno-68-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="c1"># Create your models here.</span>
<a id="__codelineno-68-7" name="__codelineno-68-7"></a><a href="#__codelineno-68-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-68-8" name="__codelineno-68-8"></a><a href="#__codelineno-68-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
<a id="__codelineno-68-9" name="__codelineno-68-9"></a><a href="#__codelineno-68-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
<a id="__codelineno-68-10" name="__codelineno-68-10"></a><a href="#__codelineno-68-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-68-11" name="__codelineno-68-11"></a><a href="#__codelineno-68-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-68-12" name="__codelineno-68-12"></a><a href="#__codelineno-68-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<a id="__codelineno-68-13" name="__codelineno-68-13"></a><a href="#__codelineno-68-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'created'</span><span class="p">]</span>
<a id="__codelineno-68-14" name="__codelineno-68-14"></a><a href="#__codelineno-68-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-68-15" name="__codelineno-68-15"></a><a href="#__codelineno-68-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-68-16" name="__codelineno-68-16"></a><a href="#__codelineno-68-16"><span class="linenos" data-linenos="16 "></span></a><span class="k">class</span> <span class="nc">ThreadManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
<a id="__codelineno-68-17" name="__codelineno-68-17"></a><a href="#__codelineno-68-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user1</span><span class="p">,</span> <span class="n">user2</span><span class="p">):</span>
<a id="__codelineno-68-18" name="__codelineno-68-18"></a><a href="#__codelineno-68-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="c1"># self es lo mismo que Thread.objects.all()</span>
<a id="__codelineno-68-19" name="__codelineno-68-19"></a><a href="#__codelineno-68-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="n">queryset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">users</span><span class="o">=</span><span class="n">user1</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">users</span><span class="o">=</span><span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-68-20" name="__codelineno-68-20"></a><a href="#__codelineno-68-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">queryset</span><span class="p">):</span>
<a id="__codelineno-68-21" name="__codelineno-68-21"></a><a href="#__codelineno-68-21"><span class="linenos" data-linenos="21 "></span></a>            <span class="k">return</span> <span class="n">queryset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-68-22" name="__codelineno-68-22"></a><a href="#__codelineno-68-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-68-23" name="__codelineno-68-23"></a><a href="#__codelineno-68-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="k">def</span> <span class="nf">find_or_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user1</span><span class="p">,</span> <span class="n">user2</span><span class="p">):</span>
<a id="__codelineno-68-24" name="__codelineno-68-24"></a><a href="#__codelineno-68-24"><span class="linenos" data-linenos="24 "></span></a>        <span class="n">thread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">user1</span><span class="p">,</span> <span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-68-25" name="__codelineno-68-25"></a><a href="#__codelineno-68-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">thread</span><span class="p">:</span>
<a id="__codelineno-68-26" name="__codelineno-68-26"></a><a href="#__codelineno-68-26"><span class="linenos" data-linenos="26 "></span></a>            <span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<a id="__codelineno-68-27" name="__codelineno-68-27"></a><a href="#__codelineno-68-27"><span class="linenos" data-linenos="27 "></span></a>            <span class="n">thread</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user1</span><span class="p">,</span> <span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-68-28" name="__codelineno-68-28"></a><a href="#__codelineno-68-28"><span class="linenos" data-linenos="28 "></span></a>        <span class="k">return</span> <span class="n">thread</span>
<a id="__codelineno-68-29" name="__codelineno-68-29"></a><a href="#__codelineno-68-29"><span class="linenos" data-linenos="29 "></span></a>
<a id="__codelineno-68-30" name="__codelineno-68-30"></a><a href="#__codelineno-68-30"><span class="linenos" data-linenos="30 "></span></a>
<a id="__codelineno-68-31" name="__codelineno-68-31"></a><a href="#__codelineno-68-31"><span class="linenos" data-linenos="31 "></span></a><span class="k">class</span> <span class="nc">Thread</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-68-32" name="__codelineno-68-32"></a><a href="#__codelineno-68-32"><span class="linenos" data-linenos="32 "></span></a>    <span class="n">users</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">'threads'</span><span class="p">)</span>
<a id="__codelineno-68-33" name="__codelineno-68-33"></a><a href="#__codelineno-68-33"><span class="linenos" data-linenos="33 "></span></a>    <span class="n">messages</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Message</span><span class="p">)</span>
<a id="__codelineno-68-34" name="__codelineno-68-34"></a><a href="#__codelineno-68-34"><span class="linenos" data-linenos="34 "></span></a>    <span class="c1"># Model Manager</span>
<a id="__codelineno-68-35" name="__codelineno-68-35"></a><a href="#__codelineno-68-35"><span class="linenos" data-linenos="35 "></span></a>    <span class="n">objects</span> <span class="o">=</span> <span class="n">ThreadManager</span><span class="p">()</span>
<a id="__codelineno-68-36" name="__codelineno-68-36"></a><a href="#__codelineno-68-36"><span class="linenos" data-linenos="36 "></span></a>
<a id="__codelineno-68-37" name="__codelineno-68-37"></a><a href="#__codelineno-68-37"><span class="linenos" data-linenos="37 "></span></a>
<a id="__codelineno-68-38" name="__codelineno-68-38"></a><a href="#__codelineno-68-38"><span class="linenos" data-linenos="38 "></span></a><span class="k">def</span> <span class="nf">messages_changed</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-68-39" name="__codelineno-68-39"></a><a href="#__codelineno-68-39"><span class="linenos" data-linenos="39 "></span></a>    <span class="n">instance</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'instance'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-68-40" name="__codelineno-68-40"></a><a href="#__codelineno-68-40"><span class="linenos" data-linenos="40 "></span></a>    <span class="n">action</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'action'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-68-41" name="__codelineno-68-41"></a><a href="#__codelineno-68-41"><span class="linenos" data-linenos="41 "></span></a>    <span class="n">pk_set</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'pk_set'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-68-42" name="__codelineno-68-42"></a><a href="#__codelineno-68-42"><span class="linenos" data-linenos="42 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">pk_set</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<a id="__codelineno-68-43" name="__codelineno-68-43"></a><a href="#__codelineno-68-43"><span class="linenos" data-linenos="43 "></span></a>    <span class="c1"># Busca los mensajes que no deben de estar en el hilo</span>
<a id="__codelineno-68-44" name="__codelineno-68-44"></a><a href="#__codelineno-68-44"><span class="linenos" data-linenos="44 "></span></a>    <span class="n">false_pk_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-68-45" name="__codelineno-68-45"></a><a href="#__codelineno-68-45"><span class="linenos" data-linenos="45 "></span></a>    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">'pre_add'</span><span class="p">:</span>
<a id="__codelineno-68-46" name="__codelineno-68-46"></a><a href="#__codelineno-68-46"><span class="linenos" data-linenos="46 "></span></a>        <span class="k">for</span> <span class="n">msg_pk</span> <span class="ow">in</span> <span class="n">pk_set</span><span class="p">:</span>
<a id="__codelineno-68-47" name="__codelineno-68-47"></a><a href="#__codelineno-68-47"><span class="linenos" data-linenos="47 "></span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">msg_pk</span><span class="p">)</span>
<a id="__codelineno-68-48" name="__codelineno-68-48"></a><a href="#__codelineno-68-48"><span class="linenos" data-linenos="48 "></span></a>            <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">user</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
<a id="__codelineno-68-49" name="__codelineno-68-49"></a><a href="#__codelineno-68-49"><span class="linenos" data-linenos="49 "></span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">user</span><span class="si">}</span><span class="s1"> no forma parte del hilo'</span><span class="p">)</span>
<a id="__codelineno-68-50" name="__codelineno-68-50"></a><a href="#__codelineno-68-50"><span class="linenos" data-linenos="50 "></span></a>                <span class="n">false_pk_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg_pk</span><span class="p">)</span>
<a id="__codelineno-68-51" name="__codelineno-68-51"></a><a href="#__codelineno-68-51"><span class="linenos" data-linenos="51 "></span></a>    <span class="c1"># Borra del hilo los mensajes que no deben de estar</span>
<a id="__codelineno-68-52" name="__codelineno-68-52"></a><a href="#__codelineno-68-52"><span class="linenos" data-linenos="52 "></span></a>    <span class="n">pk_set</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span><span class="n">false_pk_set</span><span class="p">)</span>
<a id="__codelineno-68-53" name="__codelineno-68-53"></a><a href="#__codelineno-68-53"><span class="linenos" data-linenos="53 "></span></a>
<a id="__codelineno-68-54" name="__codelineno-68-54"></a><a href="#__codelineno-68-54"><span class="linenos" data-linenos="54 "></span></a>
<a id="__codelineno-68-55" name="__codelineno-68-55"></a><a href="#__codelineno-68-55"><span class="linenos" data-linenos="55 "></span></a><span class="n">m2m_changed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">messages_changed</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">Thread</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">through</span><span class="p">)</span>
</code></pre></div>
<h2 id="model-manager">Model Manager<a class="headerlink" href="#model-manager" title="Permanent link">¶</a></h2>
<p>Para trabajar con bases de datos, Django tiene su propio ORM que llevas usando todo el rato. Cada vez que trabajas con un modelo, como con <code>User</code>, tienes atributos y métodos ya definidos. Si quisieras extenderlos, lo que debes crear es un Model Manager.</p>
<p><code>&lt;app&gt;/models.py</code> -&gt; En el <code>models.py</code> de tu app, debes de crear una clase que herede de</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a><a href="#__codelineno-69-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<a id="__codelineno-69-2" name="__codelineno-69-2"></a><a href="#__codelineno-69-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<a id="__codelineno-69-3" name="__codelineno-69-3"></a><a href="#__codelineno-69-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-69-4" name="__codelineno-69-4"></a><a href="#__codelineno-69-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-69-5" name="__codelineno-69-5"></a><a href="#__codelineno-69-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">class</span> <span class="nc">ThreadManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
<a id="__codelineno-69-6" name="__codelineno-69-6"></a><a href="#__codelineno-69-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user1</span><span class="p">,</span> <span class="n">user2</span><span class="p">):</span>
<a id="__codelineno-69-7" name="__codelineno-69-7"></a><a href="#__codelineno-69-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="c1"># self es lo mismo que Thread.objects.all()</span>
<a id="__codelineno-69-8" name="__codelineno-69-8"></a><a href="#__codelineno-69-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="n">queryset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">users</span><span class="o">=</span><span class="n">user1</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">users</span><span class="o">=</span><span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-69-9" name="__codelineno-69-9"></a><a href="#__codelineno-69-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">queryset</span><span class="p">):</span>
<a id="__codelineno-69-10" name="__codelineno-69-10"></a><a href="#__codelineno-69-10"><span class="linenos" data-linenos="10 "></span></a>            <span class="k">return</span> <span class="n">queryset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-69-11" name="__codelineno-69-11"></a><a href="#__codelineno-69-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-69-12" name="__codelineno-69-12"></a><a href="#__codelineno-69-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="k">def</span> <span class="nf">find_or_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user1</span><span class="p">,</span> <span class="n">user2</span><span class="p">):</span>
<a id="__codelineno-69-13" name="__codelineno-69-13"></a><a href="#__codelineno-69-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="n">thread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">user1</span><span class="p">,</span> <span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-69-14" name="__codelineno-69-14"></a><a href="#__codelineno-69-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">thread</span><span class="p">:</span>
<a id="__codelineno-69-15" name="__codelineno-69-15"></a><a href="#__codelineno-69-15"><span class="linenos" data-linenos="15 "></span></a>            <span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<a id="__codelineno-69-16" name="__codelineno-69-16"></a><a href="#__codelineno-69-16"><span class="linenos" data-linenos="16 "></span></a>            <span class="n">thread</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user1</span><span class="p">,</span> <span class="n">user2</span><span class="p">)</span>
<a id="__codelineno-69-17" name="__codelineno-69-17"></a><a href="#__codelineno-69-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="k">return</span> <span class="n">thread</span>
<a id="__codelineno-69-18" name="__codelineno-69-18"></a><a href="#__codelineno-69-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-69-19" name="__codelineno-69-19"></a><a href="#__codelineno-69-19"><span class="linenos" data-linenos="19 "></span></a>
<a id="__codelineno-69-20" name="__codelineno-69-20"></a><a href="#__codelineno-69-20"><span class="linenos" data-linenos="20 "></span></a><span class="k">class</span> <span class="nc">Thread</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-69-21" name="__codelineno-69-21"></a><a href="#__codelineno-69-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="n">users</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">'threads'</span><span class="p">)</span>
<a id="__codelineno-69-22" name="__codelineno-69-22"></a><a href="#__codelineno-69-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="n">messages</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Message</span><span class="p">)</span>
<a id="__codelineno-69-23" name="__codelineno-69-23"></a><a href="#__codelineno-69-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="c1"># Model Manager</span>
<a id="__codelineno-69-24" name="__codelineno-69-24"></a><a href="#__codelineno-69-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="n">objects</span> <span class="o">=</span> <span class="n">ThreadManager</span><span class="p">()</span>
</code></pre></div>
<h2 id="js-peticiones-asincronas">JS - Peticiones asíncronas<a class="headerlink" href="#js-peticiones-asincronas" title="Permanent link">¶</a></h2>
<p>TODO:</p>
<h2 id="deploy">Deploy<a class="headerlink" href="#deploy" title="Permanent link">¶</a></h2>
<p>TODO:</p>
<p>recolectar los staticos con <code>python manage.py collecstatic</code></p>
<h2 id="customizar-el-admin">Customizar el Admin<a class="headerlink" href="#customizar-el-admin" title="Permanent link">¶</a></h2>
<p>TODO:</p>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" hidden="" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
            Volver al principio
          </a>
</main>
<footer class="md-footer">
<nav aria-label="Pie" class="md-footer__inner md-grid">
<a aria-label="Anterior: Intermedio" class="md-footer__link md-footer__link--prev" href="../intermedio/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Anterior
              </span>
              Intermedio
            </div>
</div>
</a>
<a aria-label="Siguiente: Protocolos Serie" class="md-footer__link md-footer__link--next" href="../../../../../hw/serie/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Siguiente
              </span>
              Protocolos Serie
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2019 - 2022 Cristóbal Contreras
    </div>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/crisconru" rel="noopener" target="_blank" title="Github de Cristo">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-social__link" href="https://twitter.com/crisconru" rel="noopener" target="_blank" title="Github de Cristo">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
</a>
<a class="md-social__link" href="https://linkedin.com/in/cristobalcontrerasrubio" rel="noopener" target="_blank" title="Github de Cristo">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "search.share"], "search": "../../../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.config.lang": "es", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "B\u00fasqueda", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version.title": "Seleccionar versi\u00f3n"}}</script>
<script src="../../../../../assets/javascripts/bundle.d6c3db9e.min.js"></script>
<script src="../../../../../plugins/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>